{
  "version": 3,
  "sources": ["../../../../client/node_modules/@eleven-am/pondsocket-common/subjects/subject.js", "../../../../client/node_modules/@eleven-am/pondsocket-common/subjects/behaviorSubject.js", "../../../../client/node_modules/@eleven-am/pondsocket-common/subjects/index.js", "../../../../client/node_modules/@eleven-am/pondsocket-common/enums.js", "../../../../client/node_modules/@eleven-am/pondsocket-common/misc/uuid.js", "../../../../client/node_modules/@eleven-am/pondsocket-common/misc/types.js", "../../../../client/node_modules/@eleven-am/pondsocket-common/misc/index.js", "../../../../client/node_modules/@eleven-am/pondsocket-common/schema.js", "../../../../client/node_modules/@eleven-am/pondsocket-common/index.js", "../../../../client/node_modules/@eleven-am/pondsocket-client/core/channel.js", "../../../../client/node_modules/@eleven-am/pondsocket-client/browser/client.js", "../../../../client/node_modules/es5-ext/global.js", "../../../../client/node_modules/websocket/package.json", "../../../../client/node_modules/websocket/lib/version.js", "../../../../client/node_modules/websocket/lib/browser.js", "../../../../client/node_modules/@eleven-am/pondsocket-client/node/node.js", "../../../../client/node_modules/@eleven-am/pondsocket-client/index.js", "../../../../client/src/entry.ts", "../../../../client/src/index.ts", "../../../../client/src/dom-index.ts", "../../../../client/src/refs.ts", "../../../../client/src/dom.ts", "../../../../client/src/events.ts", "../../../../client/src/componentRanges.ts", "../../../../client/src/manifest.ts", "../../../../client/src/patcher.ts", "../../../../client/src/uploads.ts", "../../../../client/src/reactive.ts", "../../../../client/src/emitter.ts", "../../../../client/src/optimistic.ts", "../../../../client/src/boot.ts"],
  "sourcesContent": ["\"use strict\";\nvar __classPrivateFieldSet = (this && this.__classPrivateFieldSet) || function (receiver, state, value, kind, f) {\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n};\nvar __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (receiver, state, kind, f) {\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar _Subject_isClosed, _Subject_observers;\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Subject = void 0;\nclass Subject {\n    constructor() {\n        _Subject_isClosed.set(this, void 0);\n        _Subject_observers.set(this, void 0);\n        __classPrivateFieldSet(this, _Subject_isClosed, false, \"f\");\n        __classPrivateFieldSet(this, _Subject_observers, new Set(), \"f\");\n    }\n    /**\n     * @desc Returns the number of subscribers\n     */\n    get size() {\n        return __classPrivateFieldGet(this, _Subject_observers, \"f\").size;\n    }\n    /**\n     * @desc Subscribes to a subject\n     * @param observer - The observer to subscribe\n     */\n    subscribe(observer) {\n        if (__classPrivateFieldGet(this, _Subject_isClosed, \"f\")) {\n            throw new Error('Cannot subscribe to a closed subject');\n        }\n        __classPrivateFieldGet(this, _Subject_observers, \"f\").add(observer);\n        return () => __classPrivateFieldGet(this, _Subject_observers, \"f\").delete(observer);\n    }\n    /**\n     * @desc Publishes a message to all subscribers\n     * @param message - The message to publish\n     */\n    publish(message) {\n        __classPrivateFieldGet(this, _Subject_observers, \"f\").forEach((observer) => observer(message));\n    }\n    /**\n     * @desc Closes the subject\n     */\n    close() {\n        __classPrivateFieldGet(this, _Subject_observers, \"f\").clear();\n        __classPrivateFieldSet(this, _Subject_isClosed, true, \"f\");\n    }\n}\nexports.Subject = Subject;\n_Subject_isClosed = new WeakMap(), _Subject_observers = new WeakMap();\n", "\"use strict\";\nvar __classPrivateFieldSet = (this && this.__classPrivateFieldSet) || function (receiver, state, value, kind, f) {\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n};\nvar __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (receiver, state, kind, f) {\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar _BehaviorSubject_lastMessage;\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.BehaviorSubject = void 0;\nconst subject_1 = require(\"./subject\");\nclass BehaviorSubject extends subject_1.Subject {\n    constructor(initialValue) {\n        super();\n        _BehaviorSubject_lastMessage.set(this, void 0);\n        __classPrivateFieldSet(this, _BehaviorSubject_lastMessage, initialValue, \"f\");\n    }\n    /**\n     * @desc Returns the last message published\n     */\n    get value() {\n        return __classPrivateFieldGet(this, _BehaviorSubject_lastMessage, \"f\");\n    }\n    /**\n     * @desc Publishes a message to all subscribers\n     * @param message - The message to publish\n     */\n    publish(message) {\n        __classPrivateFieldSet(this, _BehaviorSubject_lastMessage, message, \"f\");\n        super.publish(message);\n    }\n    /**\n     * @desc Subscribes to a subject\n     * @param observer - The observer to subscribe\n     */\n    subscribe(observer) {\n        if (__classPrivateFieldGet(this, _BehaviorSubject_lastMessage, \"f\")) {\n            observer(__classPrivateFieldGet(this, _BehaviorSubject_lastMessage, \"f\"));\n        }\n        return super.subscribe(observer);\n    }\n}\nexports.BehaviorSubject = BehaviorSubject;\n_BehaviorSubject_lastMessage = new WeakMap();\n", "\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__exportStar(require(\"./behaviorSubject\"), exports);\n__exportStar(require(\"./subject\"), exports);\n", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.PubSubEvents = exports.Events = exports.ChannelReceiver = exports.SystemSender = exports.ErrorTypes = exports.ChannelState = exports.ClientActions = exports.ServerActions = exports.PresenceEventTypes = void 0;\nvar PresenceEventTypes;\n(function (PresenceEventTypes) {\n    PresenceEventTypes[\"JOIN\"] = \"JOIN\";\n    PresenceEventTypes[\"LEAVE\"] = \"LEAVE\";\n    PresenceEventTypes[\"UPDATE\"] = \"UPDATE\";\n})(PresenceEventTypes || (exports.PresenceEventTypes = PresenceEventTypes = {}));\nvar ServerActions;\n(function (ServerActions) {\n    ServerActions[\"PRESENCE\"] = \"PRESENCE\";\n    ServerActions[\"SYSTEM\"] = \"SYSTEM\";\n    ServerActions[\"BROADCAST\"] = \"BROADCAST\";\n    ServerActions[\"ERROR\"] = \"ERROR\";\n    ServerActions[\"CONNECT\"] = \"CONNECT\";\n})(ServerActions || (exports.ServerActions = ServerActions = {}));\nvar ClientActions;\n(function (ClientActions) {\n    ClientActions[\"JOIN_CHANNEL\"] = \"JOIN_CHANNEL\";\n    ClientActions[\"LEAVE_CHANNEL\"] = \"LEAVE_CHANNEL\";\n    ClientActions[\"BROADCAST\"] = \"BROADCAST\";\n})(ClientActions || (exports.ClientActions = ClientActions = {}));\nvar ChannelState;\n(function (ChannelState) {\n    ChannelState[\"IDLE\"] = \"IDLE\";\n    ChannelState[\"JOINING\"] = \"JOINING\";\n    ChannelState[\"JOINED\"] = \"JOINED\";\n    ChannelState[\"STALLED\"] = \"STALLED\";\n    ChannelState[\"CLOSED\"] = \"CLOSED\";\n})(ChannelState || (exports.ChannelState = ChannelState = {}));\nvar ErrorTypes;\n(function (ErrorTypes) {\n    ErrorTypes[\"UNAUTHORIZED_CONNECTION\"] = \"UNAUTHORIZED_CONNECTION\";\n    ErrorTypes[\"UNAUTHORIZED_JOIN_REQUEST\"] = \"UNAUTHORIZED_JOIN_REQUEST\";\n    ErrorTypes[\"UNAUTHORIZED_BROADCAST\"] = \"UNAUTHORIZED_BROADCAST\";\n    ErrorTypes[\"INVALID_MESSAGE\"] = \"INVALID_MESSAGE\";\n    ErrorTypes[\"HANDLER_NOT_FOUND\"] = \"HANDLER_NOT_FOUND\";\n    ErrorTypes[\"PRESENCE_ERROR\"] = \"PRESENCE_ERROR\";\n    ErrorTypes[\"CHANNEL_ERROR\"] = \"CHANNEL_ERROR\";\n    ErrorTypes[\"ENDPOINT_ERROR\"] = \"ENDPOINT_ERROR\";\n    ErrorTypes[\"INTERNAL_SERVER_ERROR\"] = \"INTERNAL_SERVER_ERROR\";\n})(ErrorTypes || (exports.ErrorTypes = ErrorTypes = {}));\nvar SystemSender;\n(function (SystemSender) {\n    SystemSender[\"ENDPOINT\"] = \"ENDPOINT\";\n    SystemSender[\"CHANNEL\"] = \"CHANNEL\";\n})(SystemSender || (exports.SystemSender = SystemSender = {}));\nvar ChannelReceiver;\n(function (ChannelReceiver) {\n    ChannelReceiver[\"ALL_USERS\"] = \"ALL_USERS\";\n    ChannelReceiver[\"ALL_EXCEPT_SENDER\"] = \"ALL_EXCEPT_SENDER\";\n})(ChannelReceiver || (exports.ChannelReceiver = ChannelReceiver = {}));\nvar Events;\n(function (Events) {\n    Events[\"ACKNOWLEDGE\"] = \"ACKNOWLEDGE\";\n    Events[\"CONNECTION\"] = \"CONNECTION\";\n})(Events || (exports.Events = Events = {}));\nvar PubSubEvents;\n(function (PubSubEvents) {\n    PubSubEvents[\"MESSAGE\"] = \"MESSAGE\";\n    PubSubEvents[\"PRESENCE\"] = \"PRESENCE\";\n    PubSubEvents[\"GET_PRESENCE\"] = \"GET_PRESENCE\";\n})(PubSubEvents || (exports.PubSubEvents = PubSubEvents = {}));\n", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.uuid = uuid;\nfunction uuid() {\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'\n        .replace(/[xy]/g, (c) => {\n        const r = Math.random() * 16 | 0;\n        const v = c === 'x' ? r : (r & 0x3 | 0x8);\n        return v.toString(16);\n    });\n}\n", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n", "\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__exportStar(require(\"./uuid\"), exports);\n__exportStar(require(\"./types\"), exports);\n", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.channelEventSchema = exports.serverMessageSchema = exports.presenceMessageSchema = exports.clientMessageSchema = exports.ValidationError = void 0;\nconst enums_1 = require(\"./enums\");\n// ============================================================================\n// Validation Error\n// ============================================================================\nclass ValidationError extends Error {\n    constructor(message, path) {\n        super(path ? `${path}: ${message}` : message);\n        this.path = path;\n        this.name = 'ValidationError';\n    }\n}\nexports.ValidationError = ValidationError;\n// ============================================================================\n// Validation Utilities\n// ============================================================================\nfunction isObject(value) {\n    return typeof value === 'object' && value !== null && !Array.isArray(value);\n}\nfunction isString(value) {\n    return typeof value === 'string';\n}\nfunction isArray(value) {\n    return Array.isArray(value);\n}\nfunction isRecord(value) {\n    if (!isObject(value)) {\n        return false;\n    }\n    return Object.keys(value)\n        .every((key) => typeof key === 'string');\n}\nfunction validateString(value, fieldName) {\n    if (!isString(value)) {\n        throw new ValidationError(`Expected string, got ${typeof value}`, fieldName);\n    }\n}\nfunction validateObject(value, fieldName) {\n    if (!isObject(value)) {\n        throw new ValidationError(`Expected object, got ${typeof value}`, fieldName);\n    }\n}\nfunction validateRecord(value, fieldName) {\n    if (!isRecord(value)) {\n        throw new ValidationError(`Expected record with string keys, got ${typeof value}`, fieldName);\n    }\n}\nfunction validateArray(value, fieldName) {\n    if (!isArray(value)) {\n        throw new ValidationError(`Expected array, got ${typeof value}`, fieldName);\n    }\n}\nfunction validateEnum(value, enumObj, fieldName) {\n    const validValues = Object.values(enumObj);\n    if (!validValues.includes(value)) {\n        throw new ValidationError(`Expected one of [${validValues.join(', ')}], got ${JSON.stringify(value)}`, fieldName);\n    }\n}\n// ============================================================================\n// Schema Validators\n// ============================================================================\nexports.clientMessageSchema = {\n    parse(data) {\n        validateObject(data, 'clientMessage');\n        const obj = data;\n        // Validate required fields\n        if (!('event' in obj)) {\n            throw new ValidationError('Missing required field', 'event');\n        }\n        if (!('requestId' in obj)) {\n            throw new ValidationError('Missing required field', 'requestId');\n        }\n        if (!('channelName' in obj)) {\n            throw new ValidationError('Missing required field', 'channelName');\n        }\n        if (!('payload' in obj)) {\n            throw new ValidationError('Missing required field', 'payload');\n        }\n        if (!('action' in obj)) {\n            throw new ValidationError('Missing required field', 'action');\n        }\n        // Validate types\n        validateString(obj.event, 'event');\n        validateString(obj.requestId, 'requestId');\n        validateString(obj.channelName, 'channelName');\n        validateRecord(obj.payload, 'payload');\n        validateEnum(obj.action, enums_1.ClientActions, 'action');\n        return {\n            event: obj.event,\n            requestId: obj.requestId,\n            channelName: obj.channelName,\n            payload: obj.payload,\n            action: obj.action,\n        };\n    },\n};\nexports.presenceMessageSchema = {\n    parse(data) {\n        validateObject(data, 'presenceMessage');\n        const obj = data;\n        // Validate required fields\n        if (!('requestId' in obj)) {\n            throw new ValidationError('Missing required field', 'requestId');\n        }\n        if (!('channelName' in obj)) {\n            throw new ValidationError('Missing required field', 'channelName');\n        }\n        if (!('event' in obj)) {\n            throw new ValidationError('Missing required field', 'event');\n        }\n        if (!('action' in obj)) {\n            throw new ValidationError('Missing required field', 'action');\n        }\n        if (!('payload' in obj)) {\n            throw new ValidationError('Missing required field', 'payload');\n        }\n        // Validate types\n        validateString(obj.requestId, 'requestId');\n        validateString(obj.channelName, 'channelName');\n        validateEnum(obj.event, enums_1.PresenceEventTypes, 'event');\n        // Validate action is exactly PRESENCE\n        if (obj.action !== enums_1.ServerActions.PRESENCE) {\n            throw new ValidationError(`Expected ${enums_1.ServerActions.PRESENCE}, got ${JSON.stringify(obj.action)}`, 'action');\n        }\n        // Validate payload structure\n        validateObject(obj.payload, 'payload');\n        const payload = obj.payload;\n        if (!('presence' in payload)) {\n            throw new ValidationError('Missing required field', 'payload.presence');\n        }\n        if (!('changed' in payload)) {\n            throw new ValidationError('Missing required field', 'payload.changed');\n        }\n        validateArray(payload.presence, 'payload.presence');\n        // Validate each presence item is a record\n        payload.presence.forEach((item, index) => {\n            validateRecord(item, `payload.presence[${index}]`);\n        });\n        validateRecord(payload.changed, 'payload.changed');\n        return {\n            requestId: obj.requestId,\n            channelName: obj.channelName,\n            event: obj.event,\n            action: enums_1.ServerActions.PRESENCE,\n            payload: {\n                presence: payload.presence,\n                changed: payload.changed,\n            },\n        };\n    },\n};\nexports.serverMessageSchema = {\n    parse(data) {\n        validateObject(data, 'serverMessage');\n        const obj = data;\n        // Validate required fields\n        if (!('event' in obj)) {\n            throw new ValidationError('Missing required field', 'event');\n        }\n        if (!('requestId' in obj)) {\n            throw new ValidationError('Missing required field', 'requestId');\n        }\n        if (!('channelName' in obj)) {\n            throw new ValidationError('Missing required field', 'channelName');\n        }\n        if (!('payload' in obj)) {\n            throw new ValidationError('Missing required field', 'payload');\n        }\n        if (!('action' in obj)) {\n            throw new ValidationError('Missing required field', 'action');\n        }\n        // Validate types\n        validateString(obj.event, 'event');\n        validateString(obj.requestId, 'requestId');\n        validateString(obj.channelName, 'channelName');\n        validateRecord(obj.payload, 'payload');\n        // Validate action is one of the allowed server actions\n        const validActions = [\n            enums_1.ServerActions.BROADCAST,\n            enums_1.ServerActions.CONNECT,\n            enums_1.ServerActions.ERROR,\n            enums_1.ServerActions.SYSTEM,\n        ];\n        if (!validActions.includes(obj.action)) {\n            throw new ValidationError(`Expected one of [${validActions.join(', ')}], got ${JSON.stringify(obj.action)}`, 'action');\n        }\n        return {\n            event: obj.event,\n            requestId: obj.requestId,\n            channelName: obj.channelName,\n            payload: obj.payload,\n            action: obj.action,\n        };\n    },\n};\nexports.channelEventSchema = {\n    parse(data) {\n        validateObject(data, 'channelEvent');\n        const obj = data;\n        // Check action to determine which schema to use\n        if (!('action' in obj)) {\n            throw new ValidationError('Missing required field', 'action');\n        }\n        // Discriminate based on action field\n        if (obj.action === enums_1.ServerActions.PRESENCE) {\n            return exports.presenceMessageSchema.parse(data);\n        }\n        return exports.serverMessageSchema.parse(data);\n    },\n};\n", "\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__exportStar(require(\"./subjects\"), exports);\n__exportStar(require(\"./enums\"), exports);\n__exportStar(require(\"./misc\"), exports);\n__exportStar(require(\"./schema\"), exports);\n", "\"use strict\";\nvar __classPrivateFieldSet = (this && this.__classPrivateFieldSet) || function (receiver, state, value, kind, f) {\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n};\nvar __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (receiver, state, kind, f) {\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar _Channel_instances, _Channel_name, _Channel_queue, _Channel_presence, _Channel_presenceSub, _Channel_publisher, _Channel_joinParams, _Channel_receiver, _Channel_clientState, _Channel_joinState, _Channel_emptyQueue, _Channel_init, _Channel_onMessage, _Channel_publish, _Channel_subscribeToPresence;\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Channel = void 0;\nconst pondsocket_common_1 = require(\"@eleven-am/pondsocket-common\");\nclass Channel {\n    constructor(publisher, clientState, name, params) {\n        _Channel_instances.add(this);\n        _Channel_name.set(this, void 0);\n        _Channel_queue.set(this, void 0);\n        _Channel_presence.set(this, void 0);\n        _Channel_presenceSub.set(this, void 0);\n        _Channel_publisher.set(this, void 0);\n        _Channel_joinParams.set(this, void 0);\n        _Channel_receiver.set(this, void 0);\n        _Channel_clientState.set(this, void 0);\n        _Channel_joinState.set(this, void 0);\n        __classPrivateFieldSet(this, _Channel_name, name, \"f\");\n        __classPrivateFieldSet(this, _Channel_queue, [], \"f\");\n        __classPrivateFieldSet(this, _Channel_presence, [], \"f\");\n        __classPrivateFieldSet(this, _Channel_joinParams, params, \"f\");\n        __classPrivateFieldSet(this, _Channel_publisher, publisher, \"f\");\n        __classPrivateFieldSet(this, _Channel_clientState, clientState, \"f\");\n        __classPrivateFieldSet(this, _Channel_receiver, new pondsocket_common_1.Subject(), \"f\");\n        __classPrivateFieldSet(this, _Channel_joinState, new pondsocket_common_1.BehaviorSubject(pondsocket_common_1.ChannelState.IDLE), \"f\");\n        __classPrivateFieldSet(this, _Channel_presenceSub, () => {\n            // do nothing\n        }, \"f\");\n    }\n    /**\n     * @desc Gets the current connection state of the channel.\n     */\n    get channelState() {\n        return __classPrivateFieldGet(this, _Channel_joinState, \"f\").value;\n    }\n    /**\n     * @desc Gets the current presence of the channel.\n     */\n    get presence() {\n        return __classPrivateFieldGet(this, _Channel_presence, \"f\");\n    }\n    /**\n     * @desc Acknowledges the channel has been joined on the server.\n     * @param receiver - The receiver to subscribe to.\n     */\n    acknowledge(receiver) {\n        __classPrivateFieldGet(this, _Channel_joinState, \"f\").publish(pondsocket_common_1.ChannelState.JOINED);\n        __classPrivateFieldGet(this, _Channel_instances, \"m\", _Channel_init).call(this, receiver);\n        __classPrivateFieldGet(this, _Channel_instances, \"m\", _Channel_emptyQueue).call(this);\n    }\n    /**\n     * @desc Connects to the channel.\n     */\n    join() {\n        const message = {\n            action: pondsocket_common_1.ClientActions.JOIN_CHANNEL,\n            event: pondsocket_common_1.ClientActions.JOIN_CHANNEL,\n            payload: __classPrivateFieldGet(this, _Channel_joinParams, \"f\"),\n            channelName: __classPrivateFieldGet(this, _Channel_name, \"f\"),\n            requestId: (0, pondsocket_common_1.uuid)(),\n        };\n        if (__classPrivateFieldGet(this, _Channel_joinState, \"f\").value === pondsocket_common_1.ChannelState.JOINED) {\n            return;\n        }\n        __classPrivateFieldGet(this, _Channel_joinState, \"f\").publish(pondsocket_common_1.ChannelState.JOINING);\n        if (__classPrivateFieldGet(this, _Channel_clientState, \"f\").value) {\n            __classPrivateFieldGet(this, _Channel_publisher, \"f\").call(this, message);\n        }\n        else {\n            const unsubscribe = __classPrivateFieldGet(this, _Channel_clientState, \"f\").subscribe((state) => {\n                if (state) {\n                    unsubscribe();\n                    if (__classPrivateFieldGet(this, _Channel_joinState, \"f\").value === pondsocket_common_1.ChannelState.JOINING) {\n                        __classPrivateFieldGet(this, _Channel_publisher, \"f\").call(this, message);\n                    }\n                }\n            });\n        }\n    }\n    /**\n     * @desc Disconnects from the channel.\n     */\n    leave() {\n        const message = {\n            action: pondsocket_common_1.ClientActions.LEAVE_CHANNEL,\n            event: pondsocket_common_1.ClientActions.LEAVE_CHANNEL,\n            channelName: __classPrivateFieldGet(this, _Channel_name, \"f\"),\n            requestId: (0, pondsocket_common_1.uuid)(),\n            payload: {},\n        };\n        __classPrivateFieldGet(this, _Channel_instances, \"m\", _Channel_publish).call(this, message);\n        __classPrivateFieldGet(this, _Channel_joinState, \"f\").publish(pondsocket_common_1.ChannelState.CLOSED);\n        __classPrivateFieldGet(this, _Channel_presenceSub, \"f\").call(this);\n    }\n    /**\n     * @desc Monitors the channel state of the channel.\n     * @param callback - The callback to call when the connection state changes.\n     */\n    onChannelStateChange(callback) {\n        return __classPrivateFieldGet(this, _Channel_joinState, \"f\").subscribe((data) => {\n            callback(data);\n        });\n    }\n    /**\n     * @desc Detects when clients join the channel.\n     * @param callback - The callback to call when a client joins the channel.\n     */\n    onJoin(callback) {\n        return __classPrivateFieldGet(this, _Channel_instances, \"m\", _Channel_subscribeToPresence).call(this, (event, payload) => {\n            if (event === pondsocket_common_1.PresenceEventTypes.JOIN) {\n                return callback(payload.changed);\n            }\n        });\n    }\n    /**\n     * @desc Detects when clients leave the channel.\n     * @param callback - The callback to call when a client leaves the channel.\n     */\n    onLeave(callback) {\n        return __classPrivateFieldGet(this, _Channel_instances, \"m\", _Channel_subscribeToPresence).call(this, (event, payload) => {\n            if (event === pondsocket_common_1.PresenceEventTypes.LEAVE) {\n                return callback(payload.changed);\n            }\n        });\n    }\n    /**\n     * @desc Monitors the channel for messages.\n     * @param callback - The callback to call when a message is received.\n     */\n    onMessage(callback) {\n        return __classPrivateFieldGet(this, _Channel_instances, \"m\", _Channel_onMessage).call(this, (event, message) => {\n            callback(event, message);\n        });\n    }\n    /**\n     * @desc Monitors the channel for messages.\n     * @param event - The event to monitor.\n     * @param callback - The callback to call when a message is received.\n     */\n    onMessageEvent(event, callback) {\n        return this.onMessage((eventReceived, message) => {\n            if (eventReceived === event) {\n                return callback(message);\n            }\n        });\n    }\n    /**\n     * @desc Detects when clients change their presence in the channel.\n     * @param callback - The callback to call when a client changes their presence in the channel.\n     */\n    onPresenceChange(callback) {\n        return __classPrivateFieldGet(this, _Channel_instances, \"m\", _Channel_subscribeToPresence).call(this, (event, payload) => {\n            if (event === pondsocket_common_1.PresenceEventTypes.UPDATE) {\n                return callback(payload);\n            }\n        });\n    }\n    /**\n     * @desc Monitors the presence of the channel.\n     * @param callback - The callback to call when the presence changes.\n     */\n    onUsersChange(callback) {\n        return __classPrivateFieldGet(this, _Channel_instances, \"m\", _Channel_subscribeToPresence).call(this, (_event, payload) => callback(payload.presence));\n    }\n    /**\n     * @desc Sends a message to specific clients in the channel.\n     * @param event - The event to send.\n     * @param payload - The message to send.\n     */\n    sendMessage(event, payload) {\n        const requestId = (0, pondsocket_common_1.uuid)();\n        const message = {\n            action: pondsocket_common_1.ClientActions.BROADCAST,\n            channelName: __classPrivateFieldGet(this, _Channel_name, \"f\"),\n            requestId,\n            event,\n            payload,\n        };\n        __classPrivateFieldGet(this, _Channel_instances, \"m\", _Channel_publish).call(this, message);\n    }\n    /**\n     * @desc Sends a message to the server and waits for a response.\n     * @param sentEvent - The event to send.\n     * @param payload - The message to send.\n     */\n    sendForResponse(sentEvent, payload) {\n        const requestId = (0, pondsocket_common_1.uuid)();\n        return new Promise((resolve) => {\n            const unsub = __classPrivateFieldGet(this, _Channel_instances, \"m\", _Channel_onMessage).call(this, (_, message, responseId) => {\n                if (requestId === responseId) {\n                    resolve(message);\n                    unsub();\n                }\n            });\n            const message = {\n                action: pondsocket_common_1.ClientActions.BROADCAST,\n                channelName: __classPrivateFieldGet(this, _Channel_name, \"f\"),\n                requestId,\n                event: sentEvent,\n                payload,\n            };\n            __classPrivateFieldGet(this, _Channel_instances, \"m\", _Channel_publish).call(this, message);\n        });\n    }\n}\nexports.Channel = Channel;\n_Channel_name = new WeakMap(), _Channel_queue = new WeakMap(), _Channel_presence = new WeakMap(), _Channel_presenceSub = new WeakMap(), _Channel_publisher = new WeakMap(), _Channel_joinParams = new WeakMap(), _Channel_receiver = new WeakMap(), _Channel_clientState = new WeakMap(), _Channel_joinState = new WeakMap(), _Channel_instances = new WeakSet(), _Channel_emptyQueue = function _Channel_emptyQueue() {\n    __classPrivateFieldGet(this, _Channel_queue, \"f\")\n        .forEach((message) => __classPrivateFieldGet(this, _Channel_publisher, \"f\").call(this, message));\n    __classPrivateFieldSet(this, _Channel_queue, [], \"f\");\n}, _Channel_init = function _Channel_init(receiver) {\n    __classPrivateFieldGet(this, _Channel_presenceSub, \"f\").call(this);\n    const unsubMessages = receiver.subscribe((data) => {\n        if (data.channelName === __classPrivateFieldGet(this, _Channel_name, \"f\") && this.channelState === pondsocket_common_1.ChannelState.JOINED) {\n            __classPrivateFieldGet(this, _Channel_receiver, \"f\").publish(data);\n        }\n    });\n    const unsubStateChange = __classPrivateFieldGet(this, _Channel_clientState, \"f\").subscribe((state) => {\n        if (state && __classPrivateFieldGet(this, _Channel_joinState, \"f\").value === pondsocket_common_1.ChannelState.STALLED) {\n            const message = {\n                action: pondsocket_common_1.ClientActions.JOIN_CHANNEL,\n                event: pondsocket_common_1.ClientActions.JOIN_CHANNEL,\n                payload: __classPrivateFieldGet(this, _Channel_joinParams, \"f\"),\n                channelName: __classPrivateFieldGet(this, _Channel_name, \"f\"),\n                requestId: (0, pondsocket_common_1.uuid)(),\n            };\n            __classPrivateFieldGet(this, _Channel_publisher, \"f\").call(this, message);\n        }\n        else if (!state && __classPrivateFieldGet(this, _Channel_joinState, \"f\").value === pondsocket_common_1.ChannelState.JOINED) {\n            __classPrivateFieldGet(this, _Channel_joinState, \"f\").publish(pondsocket_common_1.ChannelState.STALLED);\n        }\n    });\n    const unsubPresence = __classPrivateFieldGet(this, _Channel_instances, \"m\", _Channel_subscribeToPresence).call(this, (_, payload) => {\n        __classPrivateFieldSet(this, _Channel_presence, payload.presence, \"f\");\n    });\n    __classPrivateFieldSet(this, _Channel_presenceSub, () => {\n        unsubMessages();\n        unsubStateChange();\n        unsubPresence();\n    }, \"f\");\n}, _Channel_onMessage = function _Channel_onMessage(callback) {\n    return __classPrivateFieldGet(this, _Channel_receiver, \"f\").subscribe((data) => {\n        if (data.action !== pondsocket_common_1.ServerActions.PRESENCE) {\n            return callback(data.event, data.payload, data.requestId);\n        }\n    });\n}, _Channel_publish = function _Channel_publish(data) {\n    if (__classPrivateFieldGet(this, _Channel_joinState, \"f\").value === pondsocket_common_1.ChannelState.JOINED) {\n        return __classPrivateFieldGet(this, _Channel_publisher, \"f\").call(this, data);\n    }\n    __classPrivateFieldGet(this, _Channel_queue, \"f\").push(data);\n}, _Channel_subscribeToPresence = function _Channel_subscribeToPresence(callback) {\n    return __classPrivateFieldGet(this, _Channel_receiver, \"f\").subscribe((data) => {\n        if (data.action === pondsocket_common_1.ServerActions.PRESENCE) {\n            return callback(data.event, data.payload);\n        }\n    });\n};\n", "\"use strict\";\nvar __classPrivateFieldSet = (this && this.__classPrivateFieldSet) || function (receiver, state, value, kind, f) {\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\n};\nvar __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (receiver, state, kind, f) {\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar _PondClient_instances, _PondClient_channels, _PondClient_createPublisher, _PondClient_handleAcknowledge, _PondClient_init;\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.PondClient = void 0;\nconst pondsocket_common_1 = require(\"@eleven-am/pondsocket-common\");\nconst channel_1 = require(\"../core/channel\");\nclass PondClient {\n    constructor(endpoint, params = {}) {\n        _PondClient_instances.add(this);\n        _PondClient_channels.set(this, void 0);\n        let address;\n        try {\n            address = new URL(endpoint);\n        }\n        catch (e) {\n            address = new URL(window.location.toString());\n            address.pathname = endpoint;\n        }\n        this._disconnecting = false;\n        const query = new URLSearchParams(params);\n        address.search = query.toString();\n        const protocol = address.protocol === 'https:' ? 'wss:' : 'ws:';\n        if (address.protocol !== 'wss:' && address.protocol !== 'ws:') {\n            address.protocol = protocol;\n        }\n        this._address = address;\n        __classPrivateFieldSet(this, _PondClient_channels, new Map(), \"f\");\n        this._broadcaster = new pondsocket_common_1.Subject();\n        this._connectionState = new pondsocket_common_1.BehaviorSubject(false);\n        __classPrivateFieldGet(this, _PondClient_instances, \"m\", _PondClient_init).call(this);\n    }\n    /**\n     * @desc Connects to the server and returns the socket.\n     */\n    connect() {\n        this._disconnecting = false;\n        const socket = new WebSocket(this._address.toString());\n        socket.onmessage = (message) => {\n            const lines = message.data.trim().split('\\n');\n            for (const line of lines) {\n                if (line.trim()) {\n                    const data = JSON.parse(line);\n                    const event = pondsocket_common_1.channelEventSchema.parse(data);\n                    this._broadcaster.publish(event);\n                }\n            }\n        };\n        socket.onerror = () => socket.close();\n        socket.onclose = () => {\n            this._connectionState.publish(false);\n            if (this._disconnecting) {\n                return;\n            }\n            setTimeout(() => {\n                this.connect();\n            }, 1000);\n        };\n        this._socket = socket;\n    }\n    /**\n     * @desc Returns the current state of the socket.\n     */\n    getState() {\n        return this._connectionState.value;\n    }\n    /**\n     * @desc Disconnects the socket.\n     */\n    disconnect() {\n        var _a;\n        this._connectionState.publish(false);\n        this._disconnecting = true;\n        (_a = this._socket) === null || _a === void 0 ? void 0 : _a.close();\n        __classPrivateFieldGet(this, _PondClient_channels, \"f\").clear();\n    }\n    /**\n     * @desc Creates a channel with the given name and params.\n     * @param name - The name of the channel.\n     * @param params - The params to send to the server.\n     */\n    createChannel(name, params) {\n        const channel = __classPrivateFieldGet(this, _PondClient_channels, \"f\").get(name);\n        if (channel && channel.channelState !== pondsocket_common_1.ChannelState.CLOSED) {\n            return channel;\n        }\n        const publisher = __classPrivateFieldGet(this, _PondClient_instances, \"m\", _PondClient_createPublisher).call(this);\n        const newChannel = new channel_1.Channel(publisher, this._connectionState, name, params || {});\n        __classPrivateFieldGet(this, _PondClient_channels, \"f\").set(name, newChannel);\n        return newChannel;\n    }\n    /**\n     * @desc Subscribes to the connection state.\n     * @param callback - The callback to call when the state changes.\n     */\n    onConnectionChange(callback) {\n        return this._connectionState.subscribe(callback);\n    }\n}\nexports.PondClient = PondClient;\n_PondClient_channels = new WeakMap(), _PondClient_instances = new WeakSet(), _PondClient_createPublisher = function _PondClient_createPublisher() {\n    return (message) => {\n        if (this._connectionState.value) {\n            this._socket.send(JSON.stringify(message));\n        }\n    };\n}, _PondClient_handleAcknowledge = function _PondClient_handleAcknowledge(message) {\n    var _a;\n    const channel = (_a = __classPrivateFieldGet(this, _PondClient_channels, \"f\").get(message.channelName)) !== null && _a !== void 0 ? _a : new channel_1.Channel(__classPrivateFieldGet(this, _PondClient_instances, \"m\", _PondClient_createPublisher).call(this), this._connectionState, message.channelName, {});\n    __classPrivateFieldGet(this, _PondClient_channels, \"f\").set(message.channelName, channel);\n    channel.acknowledge(this._broadcaster);\n}, _PondClient_init = function _PondClient_init() {\n    this._broadcaster.subscribe((message) => {\n        if (message.event === pondsocket_common_1.Events.ACKNOWLEDGE) {\n            __classPrivateFieldGet(this, _PondClient_instances, \"m\", _PondClient_handleAcknowledge).call(this, message);\n        }\n        else if (message.event === pondsocket_common_1.Events.CONNECTION && message.action === pondsocket_common_1.ServerActions.CONNECT) {\n            this._connectionState.publish(true);\n        }\n    });\n};\n", "var naiveFallback = function () {\n\tif (typeof self === \"object\" && self) return self;\n\tif (typeof window === \"object\" && window) return window;\n\tthrow new Error(\"Unable to resolve global `this`\");\n};\n\nmodule.exports = (function () {\n\tif (this) return this;\n\n\t// Unexpected strict mode (may happen if e.g. bundled into ESM module)\n\n\t// Fallback to standard globalThis if available\n\tif (typeof globalThis === \"object\" && globalThis) return globalThis;\n\n\t// Thanks @mathiasbynens -> https://mathiasbynens.be/notes/globalthis\n\t// In all ES5+ engines global object inherits from Object.prototype\n\t// (if you approached one that doesn't please report)\n\ttry {\n\t\tObject.defineProperty(Object.prototype, \"__global__\", {\n\t\t\tget: function () { return this; },\n\t\t\tconfigurable: true\n\t\t});\n\t} catch (error) {\n\t\t// Unfortunate case of updates to Object.prototype being restricted\n\t\t// via preventExtensions, seal or freeze\n\t\treturn naiveFallback();\n\t}\n\ttry {\n\t\t// Safari case (window.__global__ works, but __global__ does not)\n\t\tif (!__global__) return naiveFallback();\n\t\treturn __global__;\n\t} finally {\n\t\tdelete Object.prototype.__global__;\n\t}\n})();\n", "{\n  \"name\": \"websocket\",\n  \"description\": \"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.\",\n  \"keywords\": [\n    \"websocket\",\n    \"websockets\",\n    \"socket\",\n    \"networking\",\n    \"comet\",\n    \"push\",\n    \"RFC-6455\",\n    \"realtime\",\n    \"server\",\n    \"client\"\n  ],\n  \"author\": \"Brian McKelvey <theturtle32@gmail.com> (https://github.com/theturtle32)\",\n  \"contributors\": [\n    \"I\u00F1aki Baz Castillo <ibc@aliax.net> (http://dev.sipdoc.net)\"\n  ],\n  \"version\": \"1.0.35\",\n  \"repository\": {\n    \"type\": \"git\",\n    \"url\": \"https://github.com/theturtle32/WebSocket-Node.git\"\n  },\n  \"homepage\": \"https://github.com/theturtle32/WebSocket-Node\",\n  \"engines\": {\n    \"node\": \">=4.0.0\"\n  },\n  \"dependencies\": {\n    \"bufferutil\": \"^4.0.1\",\n    \"debug\": \"^2.2.0\",\n    \"es5-ext\": \"^0.10.63\",\n    \"typedarray-to-buffer\": \"^3.1.5\",\n    \"utf-8-validate\": \"^5.0.2\",\n    \"yaeti\": \"^0.0.6\"\n  },\n  \"devDependencies\": {\n    \"buffer-equal\": \"^1.0.0\",\n    \"gulp\": \"^4.0.2\",\n    \"gulp-jshint\": \"^2.0.4\",\n    \"jshint-stylish\": \"^2.2.1\",\n    \"jshint\": \"^2.0.0\",\n    \"tape\": \"^4.9.1\"\n  },\n  \"config\": {\n    \"verbose\": false\n  },\n  \"scripts\": {\n    \"test\": \"tape test/unit/*.js\",\n    \"gulp\": \"gulp\"\n  },\n  \"main\": \"index\",\n  \"directories\": {\n    \"lib\": \"./lib\"\n  },\n  \"browser\": \"lib/browser.js\",\n  \"license\": \"Apache-2.0\"\n}\n", "module.exports = require('../package.json').version;\n", "var _globalThis;\nif (typeof globalThis === 'object') {\n\t_globalThis = globalThis;\n} else {\n\ttry {\n\t\t_globalThis = require('es5-ext/global');\n\t} catch (error) {\n\t} finally {\n\t\tif (!_globalThis && typeof window !== 'undefined') { _globalThis = window; }\n\t\tif (!_globalThis) { throw new Error('Could not determine global this'); }\n\t}\n}\n\nvar NativeWebSocket = _globalThis.WebSocket || _globalThis.MozWebSocket;\nvar websocket_version = require('./version');\n\n\n/**\n * Expose a W3C WebSocket class with just one or two arguments.\n */\nfunction W3CWebSocket(uri, protocols) {\n\tvar native_instance;\n\n\tif (protocols) {\n\t\tnative_instance = new NativeWebSocket(uri, protocols);\n\t}\n\telse {\n\t\tnative_instance = new NativeWebSocket(uri);\n\t}\n\n\t/**\n\t * 'native_instance' is an instance of nativeWebSocket (the browser's WebSocket\n\t * class). Since it is an Object it will be returned as it is when creating an\n\t * instance of W3CWebSocket via 'new W3CWebSocket()'.\n\t *\n\t * ECMAScript 5: http://bclary.com/2004/11/07/#a-13.2.2\n\t */\n\treturn native_instance;\n}\nif (NativeWebSocket) {\n\t['CONNECTING', 'OPEN', 'CLOSING', 'CLOSED'].forEach(function(prop) {\n\t\tObject.defineProperty(W3CWebSocket, prop, {\n\t\t\tget: function() { return NativeWebSocket[prop]; }\n\t\t});\n\t});\n}\n\n/**\n * Module exports.\n */\nmodule.exports = {\n    'w3cwebsocket' : NativeWebSocket ? W3CWebSocket : null,\n    'version'      : websocket_version\n};\n", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.PondClient = void 0;\nconst pondsocket_common_1 = require(\"@eleven-am/pondsocket-common\");\nconst client_1 = require(\"../browser/client\");\n// eslint-disable-next-line @typescript-eslint/no-var-requires,@typescript-eslint/no-require-imports\nconst WebSocket = require('websocket').w3cwebsocket;\nclass PondClient extends client_1.PondClient {\n    /**\n     * @desc Connects to the server and returns the socket.\n     */\n    connect(backoff = 1) {\n        this._disconnecting = false;\n        const socket = new WebSocket(this._address.toString());\n        socket.onopen = () => this._connectionState.publish(true);\n        socket.onmessage = (message) => {\n            const lines = message.data.trim().split('\\n');\n            for (const line of lines) {\n                if (line.trim()) {\n                    const data = JSON.parse(line);\n                    const event = pondsocket_common_1.channelEventSchema.parse(data);\n                    this._broadcaster.publish(event);\n                }\n            }\n        };\n        socket.onerror = () => socket.close();\n        socket.onclose = () => {\n            this._connectionState.publish(false);\n            if (this._disconnecting) {\n                return;\n            }\n            setTimeout(() => {\n                this.connect();\n            }, 1000);\n        };\n    }\n}\nexports.PondClient = PondClient;\n", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.PondClient = exports.ChannelState = void 0;\nconst pondsocket_common_1 = require(\"@eleven-am/pondsocket-common\");\nObject.defineProperty(exports, \"ChannelState\", { enumerable: true, get: function () { return pondsocket_common_1.ChannelState; } });\nconst client_1 = require(\"./browser/client\");\nconst node_1 = require(\"./node/node\");\nconst PondClient = typeof window === 'undefined' ? node_1.PondClient : client_1.PondClient;\nexports.PondClient = PondClient;\n", "import LiveUI, {\n  applyOps,\n  clearPatcherCaches,\n  configurePatcher,\n  dom,\n  getPatcherConfig,\n  getPatcherStats,\n  morphElement,\n} from './index';\nimport type { BootPayload, LiveUIOptions } from './types';\n\ntype LiveUIInstance = InstanceType<typeof LiveUI>;\n\ntype LiveUIPatcherExports = {\n  configure: typeof configurePatcher;\n  getConfig: typeof getPatcherConfig;\n  clearCaches: typeof clearPatcherCaches;\n  getStats: typeof getPatcherStats;\n  morphElement: typeof morphElement;\n};\n\ntype LiveUIAugmented = typeof LiveUI & {\n  instance?: LiveUIInstance;\n  dom?: typeof dom;\n  applyOps?: typeof applyOps;\n  patcher?: LiveUIPatcherExports;\n  boot?: typeof bootClient;\n};\n\ntype DevtoolsHook = {\n  installed?: boolean;\n  instance?: LiveUIInstance;\n};\n\ntype LiveUIWindow = Window & {\n  LiveUI?: LiveUIAugmented;\n  LiveUIInstance?: LiveUIInstance;\n  __LIVEUI_BOOT__?: BootPayload;\n  __LIVEUI_OPTIONS__?: LiveUIOptions;\n  __LIVEUI_DEVTOOLS__?: DevtoolsHook;\n};\n\nlet bootPromise: Promise<LiveUIInstance> | null = null;\n\nfunction getWindow(): LiveUIWindow | null {\n  if (typeof window === 'undefined') {\n    return null;\n  }\n  return window as LiveUIWindow;\n}\n\nfunction detectBootPayload(target: LiveUIWindow): BootPayload | null {\n  const existing = target.__LIVEUI_BOOT__;\n  if (existing && typeof existing === 'object' && typeof existing.sid === 'string') {\n    return existing;\n  }\n\n  if (typeof document === 'undefined') {\n    return null;\n  }\n\n  const script = document.getElementById('live-boot');\n  const content = script?.textContent;\n  if (!content) {\n    return null;\n  }\n\n  try {\n    const payload = JSON.parse(content) as BootPayload;\n    target.__LIVEUI_BOOT__ = payload;\n    return payload;\n  } catch (error) {\n    console.error('[LiveUI] Failed to parse boot payload', error);\n    return null;\n  }\n}\n\nfunction attachGlobals(target: LiveUIWindow, instance: LiveUIInstance): void {\n  const augmented = (LiveUI as LiveUIAugmented);\n\n  Object.assign(augmented, {\n    instance,\n    dom,\n    applyOps,\n    patcher: {\n      configure: configurePatcher,\n      getConfig: getPatcherConfig,\n      clearCaches: clearPatcherCaches,\n      getStats: getPatcherStats,\n      morphElement,\n    } satisfies LiveUIPatcherExports,\n    boot: bootClient,\n  });\n\n  target.LiveUI = augmented;\n  target.LiveUIInstance = instance;\n\n  if (target.__LIVEUI_DEVTOOLS__) {\n    target.__LIVEUI_DEVTOOLS__.installed = true;\n    target.__LIVEUI_DEVTOOLS__.instance = instance;\n  }\n}\n\nfunction createClient(target: LiveUIWindow): LiveUIInstance {\n  const inlineOptions = { ...(target.__LIVEUI_OPTIONS__ ?? {}) } as LiveUIOptions;\n  const bootPayload = detectBootPayload(target);\n  const inlineBoot = inlineOptions.boot;\n  const resolvedBootPayload = bootPayload ?? inlineBoot ?? null;\n  const shouldAutoConnect = inlineOptions.autoConnect !== false;\n\n  const options: LiveUIOptions = { ...inlineOptions, autoConnect: false };\n  const bootDebug =\n    typeof resolvedBootPayload?.client?.debug === 'boolean'\n      ? resolvedBootPayload.client.debug\n      : undefined;\n\n  if (typeof bootDebug !== 'undefined') {\n    options.debug = bootDebug;\n  } else if (typeof options.debug === 'undefined') {\n    options.debug = true;\n  }\n  if (resolvedBootPayload) {\n    options.boot = resolvedBootPayload;\n    if (!bootPayload) {\n      target.__LIVEUI_BOOT__ = resolvedBootPayload;\n    }\n  }\n\n  const client = new LiveUI(options);\n  attachGlobals(target, client);\n\n  if (shouldAutoConnect) {\n    if (resolvedBootPayload) {\n      void client.connect().catch((error) => {\n        console.error('[LiveUI] Failed to connect during boot', error);\n      });\n    } else {\n      console.warn('[LiveUI] Boot payload missing; auto-connect skipped.');\n    }\n  }\n\n  return client;\n}\n\nfunction scheduleBoot(target: LiveUIWindow): Promise<LiveUIInstance> {\n  return new Promise((resolve, reject) => {\n    const start = () => {\n      try {\n        const instance = createClient(target);\n        resolve(instance);\n      } catch (error) {\n        console.error('[LiveUI] Boot failed', error);\n        reject(error);\n      }\n    };\n\n    if (typeof document !== 'undefined' && document.readyState === 'loading') {\n      const handler = () => {\n        document.removeEventListener('DOMContentLoaded', handler);\n        start();\n      };\n      document.addEventListener('DOMContentLoaded', handler);\n    } else {\n      start();\n    }\n  });\n}\n\nexport function bootClient({ force = false }: { force?: boolean } = {}): Promise<LiveUIInstance> {\n  const globalWindow = getWindow();\n  if (!globalWindow) {\n    return Promise.reject(new Error('LiveUI: window is not available for bootstrapping.'));\n  }\n\n  if (force) {\n    bootPromise = null;\n  }\n\n  if (!bootPromise) {\n    bootPromise = scheduleBoot(globalWindow);\n  }\n\n  return bootPromise;\n}\n\nif (typeof window !== 'undefined') {\n  void bootClient().catch(() => {\n    /* Error already logged in scheduleBoot */\n  });\n}\n\nexport * from './index';\nexport { default } from './index';\n", "/**\n * LiveUI Client\n *\n * Main entry point that connects to the server via PondSocket,\n * applies patches, and manages event delegation.\n */\n\nimport { PondClient } from \"@eleven-am/pondsocket-client\";\nimport * as dom from \"./dom-index\";\nimport {\n  callElementMethod,\n  domGetSync,\n  scrollElementIntoView,\n  setBooleanProperty,\n  setElementProperty,\n  toggleElementClass,\n} from \"./dom\";\nimport {\n  applyOps,\n  clearPatcherCaches,\n  configurePatcher,\n  getPatcherConfig,\n  getPatcherStats,\n  morphElement,\n} from \"./patcher\";\nimport {\n  UploadManager,\n  applyUploadBindings,\n  primeUploadBindings,\n  replaceUploadBindingsForComponent,\n} from \"./uploads\";\nimport {\n  clearHandlers,\n  primeHandlerBindings,\n  primeSlotBindings,\n  registerBindingsForSlot,\n  registerHandlers,\n  registerNavigationHandler,\n  setupEventDelegation,\n  syncEventListeners,\n  teardownEventDelegation,\n  unregisterHandlers,\n  unregisterNavigationHandler,\n} from \"./events\";\nimport {\n  bindRefsInTree,\n  clearRefs as clearRefRegistry,\n  getRefElement,\n  registerRefs as registerRefMetadata,\n  unregisterRefs as unregisterRefMetadata,\n} from \"./refs\";\nimport { ComputedSignal, Signal } from \"./reactive\";\nimport { EventEmitter } from \"./emitter\";\nimport { OptimisticUpdateManager } from \"./optimistic\";\nimport { BootHandler } from \"./boot\";\nimport { resolveListContainers, resolveSlotAnchors, applyComponentRanges } from \"./manifest\";\nimport { getComponentRange, registerComponentRange, resetComponentRanges } from \"./componentRanges\";\nimport type {\n  AlertEffect,\n  ComponentBootEffect,\n  BootPayload,\n  ConnectionState,\n  DiffOp,\n  DispatchEffect,\n  DOMActionEffect,\n  DOMCallEffect,\n  DOMRequestMessage,\n  DOMResponseMessage,\n  Effect,\n  ErrorDetails,\n  ErrorMessage,\n  EventPayload,\n  FocusEffect,\n  FrameMessage,\n  InitMessage,\n  JoinMessage,\n  LiveUIEventMap,\n  LiveUIEvents,\n  LiveUIOptions,\n  PerformanceMetrics,\n  PubsubControlMessage,\n  PushEffect,\n  ReplaceEffect,\n  ResumeMessage,\n  ScrollEffect,\n  ServerMessage,\n  TemplateMessage,\n  DiagnosticMessage,\n  ToastEffect,\n  MetadataEffect,\n  MetadataTagPayload,\n  MetadataLinkPayload,\n  MetadataScriptPayload,\n  CookieEffect,\n  UploadClientMessage,\n  UploadControlMessage,\n  UploadBindingDescriptor,\n  TemplatePayload,\n  TemplateScope,\n} from \"./types\";\n\ninterface RuntimeDiagnosticEntry {\n  key: string;\n  code: string;\n  message: string;\n  details?: ErrorDetails;\n  timestamp: number;\n}\n\ntype PondChannel = ReturnType<PondClient[\"createChannel\"]>;\n\ntype PubsubSubscription = {\n  channel: PondChannel;\n  dispose: () => void;\n};\n\nconst isServerMessage = (value: unknown): value is ServerMessage => {\n  if (value === null || typeof value !== \"object\") {\n    return false;\n  }\n  const candidate = value as { t?: unknown };\n  return typeof candidate.t === \"string\";\n};\n\nconst DEFAULT_COOKIE_ENDPOINT = \"/pondlive/cookie\";\n\nclass LiveUI extends EventEmitter<LiveUIEvents> {\n  private options: Required<Omit<LiveUIOptions, \"boot\">> & {\n    boot?: BootPayload;\n  };\n  private client: PondClient | null = null;\n  private channel: PondChannel | null = null;\n  private pubsubChannels: Map<string, PubsubSubscription> = new Map();\n\n  // Reactive state\n  private connectionState = new Signal<ConnectionState>({\n    status: \"disconnected\",\n  });\n  private sessionId = new Signal<string | null>(null);\n  private version = new Signal<number>(0);\n  private bootHandler: BootHandler;\n  private lastAck: number = 0;\n  private hasBootPayload = false;\n  private autoConnectCleanup: (() => void) | null = null;\n\n  // Frame sequence validation\n  private expectedSeq: number | null = null;\n  private frameBuffer: Map<number, FrameMessage> = new Map();\n  private readonly MAX_FRAME_BUFFER_SIZE = 50;\n\n  private eventQueue: Array<{ hid: string; payload: EventPayload }> = [];\n\n  // Frame batching for patch operations\n  private patchQueue: DiffOp[] = [];\n  private batchScheduled: boolean = false;\n  private rafHandle: number | ReturnType<typeof setTimeout> | null = null;\n  private rafUsesTimeoutFallback = false;\n  private pendingUploadBindings: UploadBindingDescriptor[][] = [];\n\n  private cookieRequests = new Set<string>();\n\n  private templateCache: Map<string, string> = new Map();\n  private readonly MAX_TEMPLATE_CACHE_SIZE = 100;\n\n  // Reconnection\n  private reconnectAttempts: number = 0;\n  private reconnectTimer: ReturnType<typeof setTimeout> | null = null;\n  private isReconnecting: boolean = false;\n\n  // Runtime diagnostics\n  private diagnostics: RuntimeDiagnosticEntry[] = [];\n  private errorOverlay: HTMLElement | null = null;\n  private errorListEl: HTMLElement | null = null;\n  private errorOverlayVisible = false;\n  private readonly handleDebugKeydown = (event: KeyboardEvent) =>\n    this.onDebugKeydown(event);\n\n  // Performance metrics\n  private metrics: PerformanceMetrics = {\n    patchesApplied: 0,\n    averagePatchTime: 0,\n    framesReceived: 0,\n    eventsProcessed: 0,\n    reconnections: 0,\n    uptime: 0,\n    effectsMs: 0,\n    maxEffectMs: 0,\n    slowEffects: 0,\n    framesBuffered: 0,\n    framesDropped: 0,\n    sequenceGaps: 0,\n  };\n  private startTime: number = 0;\n  private patchTimes: number[] = [];\n  private patchTimeTotal = 0;\n\n  // Optimistic updates\n  private optimistic: OptimisticUpdateManager;\n  private uploads: UploadManager | null = null;\n\n  // Navigation tracking (to prevent double pushState)\n  private lastOptimisticNavTime: number = 0;\n  private readonly OPTIMISTIC_NAV_WINDOW = 100; // ms\n\n  // Event debouncing\n  private eventDebouncer = new Map<string, ReturnType<typeof setTimeout>>();\n\n  constructor(options: LiveUIOptions = {}) {\n    super();\n\n    // Initialize boot handler\n    this.bootHandler = new BootHandler({ debug: options.debug || false });\n\n    // Initialize optimistic update manager\n    this.optimistic = new OptimisticUpdateManager({\n      onRollback: (id, patches) => this.emit(\"rollback\", { id, patches }),\n      onError: (error, context) => this.emit(\"error\", { error, context }),\n      debug: options.debug || false,\n    });\n\n    this.uploads = new UploadManager({\n      getSessionId: () => this.sessionId.get(),\n      getEndpoint: () => this.options.uploadEndpoint ?? null,\n      send: (payload) => this.sendUploadMessage(payload),\n      isConnected: () =>\n        this.connectionState.get().status === \"connected\" &&\n        this.channel !== null,\n    });\n\n    const baseOptions = { ...(options ?? {}) } as LiveUIOptions;\n    const providedBoot = baseOptions.boot ?? null;\n    delete (baseOptions as any).boot;\n\n    this.options = {\n      endpoint: baseOptions.endpoint ?? \"/live\",\n      uploadEndpoint: baseOptions.uploadEndpoint ?? \"/pondlive/upload/\",\n      autoConnect: baseOptions.autoConnect !== false,\n      debug: baseOptions.debug ?? false,\n      reconnect: baseOptions.reconnect !== false,\n      maxReconnectAttempts: baseOptions.maxReconnectAttempts ?? 5,\n      reconnectDelay: baseOptions.reconnectDelay ?? 1000,\n      ...baseOptions,\n    } as Required<Omit<LiveUIOptions, \"boot\">> & { boot?: BootPayload };\n\n    if (providedBoot) {\n      this.options.boot = providedBoot;\n    }\n\n    // Load boot payload\n    const boot = this.bootHandler.load(providedBoot);\n    this.hasBootPayload = !!boot;\n    if (boot) {\n      if (boot.client?.endpoint && typeof boot.client.endpoint === \"string\") {\n        this.options.endpoint = boot.client.endpoint;\n      }\n      if (boot.client?.upload && typeof boot.client.upload === \"string\") {\n        this.options.uploadEndpoint = boot.client.upload;\n      }\n      if (typeof boot.client?.debug === \"boolean\") {\n        this.options.debug = boot.client.debug;\n      }\n      this.sessionId.set(boot.sid);\n      this.version.set(boot.ver ?? 0);\n      this.lastAck = boot.seq ?? 0;\n      if (boot.errors && boot.errors.length > 0) {\n        for (const err of boot.errors) {\n          this.recordDiagnostic(err);\n        }\n      }\n    }\n\n    // Subscribe to connection state changes\n    this.connectionState.subscribe((state) => {\n      this.log(\"Connection state changed:\", state);\n    });\n\n    if (this.options.debug && typeof window !== \"undefined\") {\n      window.addEventListener(\"keydown\", this.handleDebugKeydown);\n    }\n\n    this.setupAutoConnect();\n  }\n\n  /**\n   * Initialize and connect to the server\n   */\n  async connect(): Promise<void> {\n    this.clearAutoConnect();\n    const currentState = this.connectionState.get();\n    if (\n      currentState.status === \"connected\" ||\n      currentState.status === \"connecting\"\n    ) {\n      this.log(\"Already connected or connecting\");\n      return;\n    }\n\n    let boot: BootPayload;\n    try {\n      boot = this.bootHandler.ensure();\n    } catch (error) {\n      this.log(\"Boot payload error:\", error);\n      this.setState({ status: \"error\", error: error as Error });\n      this.emit(\"error\", { error: error as Error, context: \"boot\" });\n      return;\n    }\n\n    if (boot.client?.endpoint && typeof boot.client.endpoint === \"string\") {\n      this.options.endpoint = boot.client.endpoint;\n    }\n    if (boot.client?.upload && typeof boot.client.upload === \"string\") {\n      this.options.uploadEndpoint = boot.client.upload;\n    }\n\n    this.setState({ status: \"connecting\" });\n    this.startTime = Date.now();\n\n    try {\n      this.log(\"Connecting to\", this.options.endpoint);\n      const sid = boot.sid;\n      const joinLocation = this.bootHandler.getJoinLocation();\n      const joinPayload = {\n        sid,\n        ver: boot.ver ?? 0,\n        ack: this.lastAck ?? boot.seq ?? 0,\n        loc: {\n          path: joinLocation.path,\n          q: joinLocation.q,\n          hash: joinLocation.hash,\n        },\n      };\n\n      // Create PondSocket client\n      this.client = new PondClient(this.options.endpoint);\n\n      // Set up event delegation\n      if (typeof document !== \"undefined\") {\n        setupEventDelegation((event) => this.sendEvent(event));\n      }\n\n      // Set up navigation interception\n      if (typeof document !== \"undefined\") {\n        registerNavigationHandler((path, query, hash) =>\n          this.sendNavigation(path, query, hash),\n        );\n      }\n\n      // Set up popstate handler for browser back/forward\n      if (typeof window !== \"undefined\") {\n        window.addEventListener(\"popstate\", this.handlePopState);\n      }\n\n      // Create channel\n      const topic = `live/${sid}`;\n      this.channel = this.client.createChannel<LiveUIEventMap>(\n        topic,\n        joinPayload,\n      );\n\n      this.channel.onChannelStateChange((state) => {\n        this.log(\"Channel state changed:\", state);\n        if (state === \"JOINED\") {\n          this.onConnected();\n        }\n      });\n\n      // Handle messages\n      this.channel.onMessage((event, message) => {\n        if (isServerMessage(message)) {\n          this.handleMessage(message);\n        } else {\n          this.log(\"Ignoring non-server payload\", event, message);\n        }\n      });\n\n      // Handle leave\n      this.channel.onLeave(() => {\n        this.log(\"Channel left\");\n        this.onDisconnected();\n      });\n\n      // Connect and join\n      this.client.connect();\n      this.channel.join();\n    } catch (error) {\n      this.log(\"Connection error:\", error);\n      this.setState({ status: \"error\", error: error as Error });\n      this.emit(\"error\", { error: error as Error, context: \"connect\" });\n\n      if (this.options.reconnect && !this.isReconnecting) {\n        this.scheduleReconnect();\n      }\n    }\n  }\n\n  /**\n   * Disconnect from the server\n   */\n  disconnect(): void {\n    this.clearReconnectTimer();\n    this.isReconnecting = false;\n\n    // Cancel any pending batches\n    this.cancelScheduledBatch();\n    this.patchQueue = [];\n    this.pendingUploadBindings = [];\n\n    for (const entry of this.pubsubChannels.values()) {\n      try {\n        entry.dispose();\n        entry.channel.leave();\n      } catch (err) {\n        this.log(\"Error leaving pubsub channel\", err);\n      }\n    }\n    this.pubsubChannels.clear();\n\n    if (this.channel) {\n      this.channel.leave();\n      this.channel = null;\n    }\n    if (this.client) {\n      this.client.disconnect();\n      this.client = null;\n    }\n\n    // Remove popstate handler\n    if (typeof window !== \"undefined\") {\n      window.removeEventListener(\"popstate\", this.handlePopState);\n    }\n\n    this.setState({ status: \"disconnected\" });\n    this.sessionId.set(null);\n    this.version.set(0);\n    clearHandlers();\n    clearRefRegistry();\n    teardownEventDelegation();\n    unregisterNavigationHandler();\n    this.uploads?.onDisconnect();\n    this.emit(\"disconnected\", undefined);\n  }\n\n  private setupAutoConnect(): void {\n    if (!this.options.autoConnect) {\n      return;\n    }\n\n    if (!this.hasBootPayload) {\n      this.log(\"Auto-connect skipped: no boot payload detected\");\n      return;\n    }\n\n    const connectSafely = () => {\n      this.clearAutoConnect();\n      this.log(\"Auto-connecting after DOM ready\");\n      this.connect().catch((error) => {\n        this.log(\"Auto-connect failed:\", error);\n      });\n    };\n\n    if (typeof document === \"undefined\") {\n      connectSafely();\n      return;\n    }\n\n    if (document.readyState === \"loading\") {\n      const onReady = () => {\n        document.removeEventListener(\"DOMContentLoaded\", onReady);\n        connectSafely();\n      };\n      document.addEventListener(\"DOMContentLoaded\", onReady);\n      this.autoConnectCleanup = () => {\n        document.removeEventListener(\"DOMContentLoaded\", onReady);\n      };\n      return;\n    }\n\n    if (typeof queueMicrotask === \"function\") {\n      queueMicrotask(connectSafely);\n    } else {\n      Promise.resolve().then(connectSafely);\n    }\n  }\n\n  private clearAutoConnect(): void {\n    if (this.autoConnectCleanup) {\n      this.autoConnectCleanup();\n      this.autoConnectCleanup = null;\n    }\n  }\n\n  /**\n   * Get current connection state\n   */\n  getConnectionState(): ConnectionState {\n    return this.connectionState.get();\n  }\n\n  /**\n   * Get current metrics\n   */\n  getMetrics(): PerformanceMetrics {\n    return {\n      ...this.metrics,\n      uptime: this.startTime ? Date.now() - this.startTime : 0,\n    };\n  }\n\n  /**\n   * Subscribe to connection state changes\n   */\n  onStateChange(callback: (state: ConnectionState) => void): () => void {\n    return this.connectionState.subscribe(callback);\n  }\n\n  /**\n   * Subscribe to session ID changes\n   */\n  onSessionIdChange(callback: (sessionId: string | null) => void): () => void {\n    return this.sessionId.subscribe(callback);\n  }\n\n  /**\n   * Subscribe to version changes\n   */\n  onVersionChange(callback: (version: number) => void): () => void {\n    return this.version.subscribe(callback);\n  }\n\n  /**\n   * Send event with optional debouncing\n   */\n  sendEventDebounced(\n    event: { hid: string; payload: EventPayload },\n    delay: number = 300,\n  ): void {\n    const existing = this.eventDebouncer.get(event.hid);\n    if (existing) {\n      clearTimeout(existing);\n    }\n\n    const timer = setTimeout(() => {\n      this.sendEvent(event);\n      this.eventDebouncer.delete(event.hid);\n    }, delay);\n\n    this.eventDebouncer.set(event.hid, timer);\n  }\n\n  /**\n   * Apply optimistic update\n   */\n  applyOptimistic(patches: DiffOp[]): string {\n    return this.optimistic.apply(patches);\n  }\n\n  /**\n   * Commit optimistic update (server confirmed)\n   */\n  commitOptimistic(id: string): void {\n    this.optimistic.commit(id);\n  }\n\n  /**\n   * Rollback optimistic update (server rejected)\n   */\n  rollbackOptimistic(id: string): void {\n    this.optimistic.rollback(id);\n  }\n\n  // ========================================================================\n  // Private methods\n  // ========================================================================\n\n  private setState(newState: ConnectionState): void {\n    const oldState = this.connectionState.get();\n    if (!this.hasStateChanged(oldState, newState)) {\n      return;\n    }\n\n    this.connectionState.set(newState);\n    this.emit(\"stateChanged\", { from: oldState, to: newState });\n  }\n\n  private onConnected(): void {\n    const sid = this.sessionId.get();\n    const ver = this.version.get();\n\n    if (sid) {\n      if (this.isReconnecting) {\n        this.isReconnecting = false;\n        this.reconnectAttempts = 0;\n        this.emit(\"reconnected\", { sessionId: sid });\n      }\n\n      this.setState({ status: \"connected\", sessionId: sid, version: ver });\n      this.emit(\"connected\", { sessionId: sid, version: ver });\n      this.flushEventQueue();\n    }\n  }\n\n  private onDisconnected(): void {\n    this.setState({ status: \"disconnected\" });\n\n    if (this.options.reconnect && !this.isReconnecting) {\n      this.scheduleReconnect();\n    }\n    this.uploads?.onDisconnect();\n  }\n\n  private scheduleReconnect(): void {\n    if (this.reconnectAttempts >= this.options.maxReconnectAttempts) {\n      this.log(\"Max reconnect attempts reached\");\n      this.emit(\"error\", {\n        error: new Error(\"Max reconnect attempts reached\"),\n        context: \"reconnect\",\n      });\n      return;\n    }\n\n    this.isReconnecting = true;\n    this.reconnectAttempts++;\n\n    const delay =\n      this.options.reconnectDelay * Math.pow(2, this.reconnectAttempts - 1);\n    this.log(\n      `Reconnecting in ${delay}ms (attempt ${this.reconnectAttempts}/${this.options.maxReconnectAttempts})`,\n    );\n\n    this.setState({ status: \"reconnecting\", attempt: this.reconnectAttempts });\n    this.emit(\"reconnecting\", { attempt: this.reconnectAttempts });\n\n    this.reconnectTimer = setTimeout(() => {\n      this.metrics.reconnections++;\n      this.connect();\n    }, delay);\n  }\n\n  private clearReconnectTimer(): void {\n    if (this.reconnectTimer) {\n      clearTimeout(this.reconnectTimer);\n      this.reconnectTimer = null;\n    }\n  }\n\n  /**\n   * Handle incoming messages from the server\n   */\n  private handleMessage(msg: ServerMessage): void {\n    if (!msg || !msg.t) {\n      this.log(\"Invalid message\", msg);\n      return;\n    }\n\n    this.log(\"Received message:\", msg.t, msg);\n\n    switch (msg.t) {\n      case \"init\":\n        this.handleInit(msg as InitMessage);\n        break;\n      case \"frame\":\n        this.handleFrame(msg as FrameMessage);\n        break;\n      case \"template\":\n        this.handleTemplate(msg as TemplateMessage);\n        break;\n      case \"join\":\n        this.handleJoin(msg as JoinMessage);\n        break;\n      case \"resume\":\n        this.handleResume(msg as ResumeMessage);\n        break;\n      case \"error\":\n        this.handleError(msg as ErrorMessage);\n        break;\n      case \"diagnostic\":\n        this.handleDiagnostic(msg as DiagnosticMessage);\n        break;\n      case \"pubsub\":\n        this.handlePubsub(msg as PubsubControlMessage);\n        break;\n      case \"upload\":\n        this.uploads?.handleControl(msg as UploadControlMessage);\n        break;\n      case \"domreq\":\n        this.handleDOMRequest(msg as DOMRequestMessage);\n        break;\n      default:\n        this.log(\"Unknown message type:\", (msg as any).t);\n    }\n  }\n\n  /**\n   * Handle init message\n   */\n  private handleInit(msg: InitMessage): void {\n    this.sessionId.set(msg.sid);\n    this.version.set(msg.ver);\n\n    // Reset sequence tracking for new session\n    this.expectedSeq = msg.seq !== undefined ? msg.seq + 1 : null;\n    this.frameBuffer.clear();\n\n    if (Array.isArray(msg.errors) && msg.errors.length > 0) {\n      for (const err of msg.errors) {\n        this.recordDiagnostic(err);\n      }\n    }\n\n    // Register handlers\n    if (msg.handlers) {\n      registerHandlers(msg.handlers);\n      syncEventListeners();\n    }\n\n    primeSlotBindings(msg.bindings?.slots ?? null);\n\n    clearRefRegistry();\n    if (msg.refs?.add) {\n      registerRefMetadata(msg.refs.add);\n    }\n    let initOverrides: Map<string, import(\"./componentRanges\").ComponentRange> | undefined;\n    if (typeof document !== \"undefined\") {\n      bindRefsInTree(document);\n      primeHandlerBindings(document);\n      initOverrides = applyComponentRanges(msg.componentPaths, { root: document });\n    }\n\n    primeUploadBindings(msg.bindings?.uploads ?? null, initOverrides);\n\n    // Acknowledge if needed\n    if (msg.seq !== undefined) {\n      this.lastAck = msg.seq;\n      this.sendAck(msg.seq);\n    }\n\n    this.log(\"Session initialized:\", msg.sid, \"version:\", msg.ver);\n    this.onConnected();\n  }\n\n  /**\n   * Handle frame message with sequence validation\n   */\n  private handleFrame(msg: FrameMessage): void {\n    const sid = this.sessionId.get();\n    if (msg.sid !== sid) {\n      this.log(\"Session mismatch, ignoring frame\");\n      return;\n    }\n\n    this.metrics.framesReceived++;\n\n    // Sequence validation and buffering\n    if (msg.seq !== undefined) {\n      // First frame - establish expected sequence\n      if (this.expectedSeq === null) {\n        this.expectedSeq = msg.seq + 1;\n        this.applyFrame(msg);\n        this.drainFrameBuffer();\n        return;\n      }\n\n      // Frame arrives in expected order - process immediately\n      if (msg.seq === this.expectedSeq) {\n        this.expectedSeq = msg.seq + 1;\n        this.applyFrame(msg);\n        this.drainFrameBuffer();\n        return;\n      }\n\n      // Out-of-order frame (arrived early) - buffer it\n      if (msg.seq > this.expectedSeq) {\n        this.metrics.sequenceGaps++;\n        this.log(\"Frame arrived out of order\", {\n          expected: this.expectedSeq,\n          received: msg.seq,\n          gap: msg.seq - this.expectedSeq,\n        });\n\n        // Check buffer size limit\n        if (this.frameBuffer.size >= this.MAX_FRAME_BUFFER_SIZE) {\n          this.metrics.framesDropped++;\n          this.log(\"Frame buffer full, dropping oldest frame\");\n          // Drop the oldest buffered frame\n          const oldestSeq = Math.min(...this.frameBuffer.keys());\n          this.frameBuffer.delete(oldestSeq);\n        }\n\n        this.frameBuffer.set(msg.seq, msg);\n        this.metrics.framesBuffered++;\n        return;\n      }\n\n      // Duplicate or late frame (already processed) - drop it\n      if (msg.seq < this.expectedSeq) {\n        this.metrics.framesDropped++;\n        this.log(\"Dropping duplicate/late frame\", {\n          expected: this.expectedSeq,\n          received: msg.seq,\n        });\n        return;\n      }\n    } else {\n      // Frame without sequence number - process immediately (shouldn't happen)\n      this.applyFrame(msg);\n    }\n  }\n\n  /**\n   * Apply a frame's contents (extracted for reuse)\n   */\n  private applyFrame(msg: FrameMessage): void {\n    this.version.set(msg.ver);\n\n    // Queue patches for batched application\n    if (msg.patch && msg.patch.length > 0) {\n      this.log(\"Queueing\", msg.patch.length, \"operations\");\n      this.patchQueue.push(...msg.patch);\n      this.scheduleBatch();\n    }\n\n    // Update handlers\n    if (msg.handlers) {\n      if (msg.handlers.add) {\n        registerHandlers(msg.handlers.add);\n      }\n      if (msg.handlers.del) {\n        unregisterHandlers(msg.handlers.del);\n      }\n      // Sync event listeners based on new handlers\n      syncEventListeners();\n    }\n\n    if (msg.bindings?.slots) {\n      for (const [slotKey, specs] of Object.entries(msg.bindings.slots)) {\n        const slotId = Number(slotKey);\n        if (!Number.isInteger(slotId) || slotId < 0) {\n          continue;\n        }\n        if (Array.isArray(specs)) {\n          registerBindingsForSlot(slotId, specs);\n        } else {\n          registerBindingsForSlot(slotId, []);\n        }\n      }\n    }\n\n    if (Array.isArray(msg.bindings?.uploads)) {\n      if (this.batchScheduled || this.patchQueue.length > 0) {\n        this.pendingUploadBindings.push(msg.bindings.uploads);\n      } else {\n        applyUploadBindings(msg.bindings.uploads);\n      }\n    }\n\n    if (msg.refs) {\n      if (msg.refs.del) {\n        unregisterRefMetadata(msg.refs.del);\n      }\n      if (msg.refs.add) {\n        registerRefMetadata(msg.refs.add);\n      }\n    }\n\n    // Handle navigation\n    if (msg.nav) {\n      const now = Date.now();\n      const wasOptimistic =\n        now - this.lastOptimisticNavTime < this.OPTIMISTIC_NAV_WINDOW;\n\n      if (msg.nav.push) {\n        // If we just did an optimistic navigation, use replaceState to avoid duplicate history entries\n        if (wasOptimistic) {\n          window.history.replaceState({}, \"\", msg.nav.push);\n        } else {\n          window.history.pushState({}, \"\", msg.nav.push);\n        }\n      } else if (msg.nav.replace) {\n        window.history.replaceState({}, \"\", msg.nav.replace);\n      }\n\n      // Reset optimistic nav tracking\n      this.lastOptimisticNavTime = 0;\n    }\n\n    // Apply effects\n    if (msg.effects && msg.effects.length > 0) {\n      this.applyEffects(msg.effects);\n    }\n\n    // Acknowledge if needed\n    if (msg.seq !== undefined) {\n      this.sendAck(msg.seq);\n    }\n\n    if (msg.metrics) {\n      this.log(\"Frame metrics:\", msg.metrics);\n      if (typeof msg.metrics.effectsMs === \"number\") {\n        this.metrics.effectsMs = msg.metrics.effectsMs;\n      }\n      if (typeof msg.metrics.maxEffectMs === \"number\") {\n        this.metrics.maxEffectMs = msg.metrics.maxEffectMs;\n      }\n      if (typeof msg.metrics.slowEffects === \"number\") {\n        this.metrics.slowEffects = msg.metrics.slowEffects;\n      }\n    }\n  }\n\n  private handleTemplate(msg: TemplateMessage): void {\n    if (!msg) {\n      return;\n    }\n    const sid = this.sessionId.get();\n    if (msg.sid && sid && msg.sid !== sid) {\n      this.log(\"Template message for different session\", msg.sid);\n      return;\n    }\n    if (!msg.scope) {\n      this.applyRootTemplatePayload(msg);\n      return;\n    }\n    this.applyComponentTemplatePayload(msg, msg.scope);\n  }\n\n  private handleDiagnostic(msg: DiagnosticMessage): void {\n    if (!msg) {\n      return;\n    }\n    this.recordDiagnostic(msg);\n  }\n\n  /**\n   * Drain buffered frames that are now in sequence\n   */\n  private drainFrameBuffer(): void {\n    while (\n      this.expectedSeq !== null &&\n      this.frameBuffer.has(this.expectedSeq)\n    ) {\n      const bufferedFrame = this.frameBuffer.get(this.expectedSeq)!;\n      this.frameBuffer.delete(this.expectedSeq);\n      this.expectedSeq = bufferedFrame.seq! + 1;\n\n      this.log(\"Draining buffered frame\", { seq: bufferedFrame.seq });\n      this.applyFrame(bufferedFrame);\n    }\n  }\n\n  /**\n   * Apply effects from server\n   */\n  private applyEffects(effects: Effect[]): void {\n    for (const effect of effects) {\n      try {\n        this.log(\"Applying effect:\", effect);\n        this.emit(\"effect\", { effect });\n\n        const effectType =\n          typeof effect.type === \"string\" ? effect.type.toLowerCase() : \"\";\n        switch (effectType) {\n          case \"boot\":\n            this.applyBootEffect(effect as any);\n            break;\n          case \"componentboot\":\n            this.applyComponentBootEffect(effect as ComponentBootEffect);\n            break;\n          case \"dom\":\n            this.applyDOMActionEffect(effect as DOMActionEffect);\n            break;\n          case \"domcall\":\n            this.applyLegacyDOMCallEffect(effect as DOMCallEffect);\n            break;\n          case \"scroll\":\n          case \"scrolltop\":\n            this.applyScrollEffect(effect as ScrollEffect);\n            break;\n          case \"focus\":\n            this.applyFocusEffect(effect as FocusEffect);\n            break;\n          case \"alert\":\n            window.alert((effect as AlertEffect).message);\n            break;\n          case \"toast\":\n            this.applyToastEffect(effect as ToastEffect);\n            break;\n          case \"push\":\n            this.applyPushEffect(effect as PushEffect);\n            break;\n          case \"replace\":\n            this.applyReplaceEffect(effect as ReplaceEffect);\n            break;\n          case \"dispatch\":\n            this.dispatchCustomEvent(\n              (effect as DispatchEffect).eventName,\n              (effect as DispatchEffect).detail,\n            );\n            break;\n          case \"metadata\":\n            this.applyMetadataEffect(effect as MetadataEffect);\n            break;\n          case \"cookies\":\n            this.handleCookieEffect(effect as CookieEffect);\n            break;\n          case \"custom\":\n            // Custom effects are handled via the 'effect' event\n            break;\n          default:\n            // Unknown effect type - emit for custom handling\n            this.log(\"Unknown effect type:\", effect.type);\n            break;\n        }\n      } catch (error) {\n        this.log(\"Error applying effect:\", effect, error);\n        this.emit(\"error\", { error: error as Error, context: \"effect\" });\n      }\n    }\n  }\n\n  private applyRootTemplatePayload(payload: TemplatePayload): void {\n    if (typeof document === \"undefined\") {\n      return;\n    }\n\n    const markup = this.getTemplateMarkup(payload, \"__root__\");\n\n    clearPatcherCaches();\n    dom.reset();\n\n    if (document.body) {\n      document.body.innerHTML = markup;\n    } else if (document.documentElement) {\n      document.documentElement.innerHTML = markup;\n    }\n\n    const rootContainer: ParentNode = (document.body ?? document) as ParentNode;\n    primeHandlerBindings(rootContainer);\n\n    clearHandlers();\n    if (payload.handlers && Object.keys(payload.handlers).length > 0) {\n      registerHandlers(payload.handlers);\n    }\n    syncEventListeners();\n\n    primeSlotBindings(payload.bindings?.slots ?? null);\n\n    if (payload.refs?.del) {\n      unregisterRefMetadata(payload.refs.del);\n    }\n    if (payload.refs?.add) {\n      registerRefMetadata(payload.refs.add);\n    }\n\n    bindRefsInTree(document);\n\n    resetComponentRanges();\n    const childCount = rootContainer.childNodes.length;\n    const range: import(\"./componentRanges\").ComponentRange = {\n      container: rootContainer,\n      startIndex: 0,\n      endIndex: childCount > 0 ? childCount - 1 : -1,\n    };\n    const overrides = applyComponentRanges(payload.componentPaths, { root: document });\n    this.registerTemplateAnchors(range, payload, overrides);\n    primeUploadBindings(payload.bindings?.uploads ?? null, overrides);\n  }\n\n  private applyComponentTemplatePayload(\n    payload: TemplatePayload,\n    scope: TemplateScope,\n  ): void {\n    if (typeof document === \"undefined\") {\n      return;\n    }\n    if (!scope || !scope.componentId) {\n      return;\n    }\n\n    const range = this.findComponentRange(scope.componentId);\n    if (!range) {\n      if (this.options.debug) {\n        console.warn(\n          `liveui: component ${scope.componentId} range not found for template payload`,\n        );\n      }\n      return;\n    }\n\n    const slotIds = this.extractSlotIds(payload.slots);\n    for (const slot of slotIds) {\n      dom.unregisterSlot(slot);\n    }\n\n    const listSlotIds = this.extractListSlotIds(payload.listPaths);\n    for (const slot of listSlotIds) {\n      dom.unregisterList(slot);\n    }\n\n    clearPatcherCaches();\n\n    const template = document.createElement(\"template\");\n    const markup = this.getTemplateMarkup(payload, scope.componentId);\n    template.innerHTML = markup;\n    const fragment = template.content.cloneNode(true);\n    primeHandlerBindings(fragment);\n\n    const insertedNodes: Node[] = [];\n    for (let child = fragment.firstChild; child; child = child.nextSibling) {\n      insertedNodes.push(child);\n    }\n\n    const { container } = range;\n    const startIndex = range.startIndex;\n    const endIndex = range.endIndex;\n    const referenceNode =\n      endIndex + 1 < container.childNodes.length\n        ? container.childNodes.item(endIndex + 1)\n        : null;\n\n    for (let index = endIndex; index >= startIndex; index--) {\n      const node = container.childNodes.item(index);\n      if (node) {\n        container.removeChild(node);\n      }\n    }\n\n    container.insertBefore(fragment, referenceNode);\n\n    const insertedCount = insertedNodes.length;\n    let refreshed = registerComponentRange(scope.componentId, {\n      container,\n      startIndex,\n      endIndex: insertedCount > 0 ? startIndex + insertedCount - 1 : startIndex - 1,\n    });\n    if (!refreshed) {\n      refreshed = {\n        container,\n        startIndex,\n        endIndex: insertedCount > 0 ? startIndex + insertedCount - 1 : startIndex - 1,\n      };\n    }\n\n    const overrides = applyComponentRanges(payload.componentPaths, {\n      baseId: scope.componentId,\n      baseRange: refreshed,\n    });\n\n    this.registerTemplateAnchors(refreshed, payload, overrides);\n    replaceUploadBindingsForComponent(scope.componentId, payload.bindings?.uploads ?? null, overrides);\n\n    if (payload.handlers && Object.keys(payload.handlers).length > 0) {\n      registerHandlers(payload.handlers);\n      syncEventListeners();\n    }\n\n    if (payload.bindings?.slots) {\n      for (const [slotKey, specs] of Object.entries(payload.bindings.slots)) {\n        const slotId = Number(slotKey);\n        if (!Number.isInteger(slotId) || slotId < 0) {\n          continue;\n        }\n        registerBindingsForSlot(slotId, Array.isArray(specs) ? specs : []);\n      }\n    }\n\n    if (payload.refs?.del) {\n      unregisterRefMetadata(payload.refs.del);\n    }\n    if (payload.refs?.add) {\n      registerRefMetadata(payload.refs.add);\n    }\n\n    bindRefsInTree(container);\n  }\n\n  private handleDOMRequest(msg: DOMRequestMessage): void {\n    if (!msg || !msg.id) {\n      return;\n    }\n\n    const refId = msg.ref ?? \"\";\n    const selectors = Array.isArray(msg.props) ? msg.props : [];\n    const response: DOMResponseMessage = { t: \"domres\", id: msg.id };\n\n    if (!refId) {\n      response.error = \"missing_ref\";\n      this.sendDOMResponse(response);\n      return;\n    }\n\n    const element = getRefElement(refId);\n    if (!element) {\n      response.error = \"not_found\";\n      this.sendDOMResponse(response);\n      return;\n    }\n\n    // Handle method call if specified\n    if (msg.method) {\n      try {\n        const method = msg.method.trim();\n        if (!method) {\n          response.error = \"empty_method\";\n          this.sendDOMResponse(response);\n          return;\n        }\n\n        // Get the method from the element\n        const fn = (element as any)[method];\n        if (typeof fn !== \"function\") {\n          response.error = \"method_not_found\";\n          this.sendDOMResponse(response);\n          return;\n        }\n\n        // Call the method with provided arguments\n        const args = Array.isArray(msg.args) ? msg.args : [];\n        const result = fn.apply(element, args);\n        response.result = result;\n      } catch (error) {\n        response.error = error instanceof Error ? error.message : String(error);\n        this.sendDOMResponse(response);\n        return;\n      }\n    }\n\n    // Handle property selectors if specified\n    if (selectors.length > 0) {\n      try {\n        const values = domGetSync(selectors, {\n          event: null,\n          target: element,\n          handlerElement: element,\n          refElement: element,\n        });\n        if (values && Object.keys(values).length > 0) {\n          response.values = values;\n        } else {\n          response.values = {};\n        }\n      } catch (error) {\n        response.error = error instanceof Error ? error.message : String(error);\n        this.sendDOMResponse(response);\n        return;\n      }\n    }\n\n    this.sendDOMResponse(response);\n  }\n\n  private applyDOMActionEffect(effect: DOMActionEffect): void {\n    if (typeof document === \"undefined\") {\n      return;\n    }\n\n    const kind = (effect.kind ?? effect.Kind ?? \"\").toLowerCase();\n    const refId = (effect.ref ?? effect.Ref ?? \"\").trim();\n\n    if (!kind) {\n      this.reportDOMActionFailure(effect, \"missing_kind\");\n      return;\n    }\n    if (!refId) {\n      this.reportDOMActionFailure(effect, \"missing_ref\");\n      return;\n    }\n\n    switch (kind) {\n      case \"dom.call\": {\n        const method = (effect.method ?? effect.Method ?? \"\").trim();\n        if (!method) {\n          this.reportDOMActionFailure(effect, \"missing_method\");\n          return;\n        }\n        const args = this.normalizeDOMActionArgs(effect);\n        const result = callElementMethod(refId, method, args);\n        if (!result.ok) {\n          this.reportDOMActionFailure(\n            effect,\n            result.reason ?? \"call_failed\",\n            { method, argsLength: args.length },\n            result.error,\n          );\n        }\n        break;\n      }\n      case \"dom.set\": {\n        const prop = (effect.prop ?? effect.Prop ?? \"\").trim();\n        if (!prop) {\n          this.reportDOMActionFailure(effect, \"missing_property\");\n          return;\n        }\n        const value = effect.value ?? effect.Value;\n        const result = setElementProperty(refId, prop, value);\n        if (!result.ok) {\n          this.reportDOMActionFailure(\n            effect,\n            result.reason ?? \"set_failed\",\n            { prop },\n            result.error,\n          );\n        }\n        break;\n      }\n      case \"dom.toggle\": {\n        const prop = (effect.prop ?? effect.Prop ?? \"\").trim();\n        if (!prop) {\n          this.reportDOMActionFailure(effect, \"missing_property\");\n          return;\n        }\n        const value = effect.value ?? effect.Value;\n        if (typeof value !== \"boolean\") {\n          this.reportDOMActionFailure(effect, \"invalid_toggle_value\", { prop, value });\n          return;\n        }\n        const result = setBooleanProperty(refId, prop, value);\n        if (!result.ok) {\n          this.reportDOMActionFailure(\n            effect,\n            result.reason ?? \"toggle_failed\",\n            { prop, value },\n            result.error,\n          );\n        }\n        break;\n      }\n      case \"dom.class\": {\n        const className = (effect[\"class\"] ?? effect.Class ?? \"\").trim();\n        if (!className) {\n          this.reportDOMActionFailure(effect, \"missing_class\");\n          return;\n        }\n        const toggle = effect.on ?? effect.On;\n        const result = toggleElementClass(refId, className, toggle);\n        if (!result.ok) {\n          this.reportDOMActionFailure(\n            effect,\n            result.reason ?? \"class_failed\",\n            { className, toggle },\n            result.error,\n          );\n        }\n        break;\n      }\n      case \"dom.scroll\": {\n        const options: ScrollIntoViewOptions = {};\n        const behavior = effect.behavior ?? effect.Behavior;\n        const block = effect.block ?? effect.Block;\n        const inline = effect.inline ?? effect.Inline;\n        if (behavior) {\n          options.behavior = behavior;\n        }\n        if (block) {\n          options.block = block;\n        }\n        if (inline) {\n          options.inline = inline;\n        }\n        const result = scrollElementIntoView(\n          refId,\n          Object.keys(options).length > 0 ? options : null,\n        );\n        if (!result.ok) {\n          this.reportDOMActionFailure(\n            effect,\n            result.reason ?? \"scroll_failed\",\n            undefined,\n            result.error,\n          );\n        }\n        break;\n      }\n      default:\n        this.reportDOMActionFailure(effect, \"unknown_kind\", { kind });\n    }\n  }\n\n  private applyLegacyDOMCallEffect(effect: DOMCallEffect): void {\n    const normalizedArgs = Array.isArray(effect.args)\n      ? effect.args\n      : Array.isArray(effect.Args)\n      ? effect.Args\n      : effect.args !== undefined\n      ? [effect.args]\n      : effect.Args !== undefined\n      ? [effect.Args]\n      : undefined;\n\n    const normalized: DOMActionEffect = {\n      type: \"dom\",\n      kind: \"dom.call\",\n      ref: effect.ref ?? effect.Ref ?? undefined,\n      method: effect.method ?? effect.Method ?? undefined,\n      args: normalizedArgs,\n    };\n\n    this.applyDOMActionEffect(normalized);\n  }\n\n  private normalizeDOMActionArgs(effect: DOMActionEffect): any[] {\n    if (Array.isArray(effect.args)) {\n      return effect.args;\n    }\n    if (Array.isArray(effect.Args)) {\n      return effect.Args;\n    }\n    if (effect.args !== undefined) {\n      return [effect.args];\n    }\n    if (effect.Args !== undefined) {\n      return [effect.Args];\n    }\n    return [];\n  }\n\n  private reportDOMActionFailure(\n    effect: DOMActionEffect,\n    reason: string,\n    metadata?: Record<string, unknown>,\n    error?: unknown,\n  ): void {\n    const kind = effect.kind ?? effect.Kind ?? \"\";\n    const refId = (effect.ref ?? effect.Ref ?? \"\") ?? \"\";\n    const message = `DOM action ${kind || \"unknown\"} failed: ${reason}`;\n\n    const detailsMetadata: Record<string, unknown> = {\n      kind,\n      ref: refId,\n    };\n    if (metadata) {\n      Object.assign(detailsMetadata, metadata);\n    }\n    if (error instanceof Error) {\n      detailsMetadata.error = error.message;\n      if (error.stack) {\n        detailsMetadata.stack = error.stack;\n      }\n    } else if (error !== undefined) {\n      detailsMetadata.error = error;\n    }\n\n    console.warn(\"[LiveUI]\", message, { effect, metadata: detailsMetadata });\n\n    const diagnostic: DiagnosticMessage = {\n      t: \"diagnostic\",\n      sid: this.sessionId.get() ?? \"\",\n      code: \"dom_action_failed\",\n      message,\n      details: {\n        phase: \"dom_action\",\n        metadata: detailsMetadata,\n      },\n    };\n\n    this.recordDiagnostic(diagnostic);\n  }\n\n  private sendDOMResponse(payload: DOMResponseMessage): void {\n    if (!this.channel) {\n      this.log(\"Cannot send DOM response without channel\", payload);\n      return;\n    }\n    try {\n      this.channel.sendMessage(\"domres\", payload);\n    } catch (error) {\n      this.log(\"Failed to send DOM response\", error);\n    }\n  }\n\n  private applyScrollEffect(effect: ScrollEffect): void {\n    const behavior = effect.behavior || \"smooth\";\n    const selector = effect.selector;\n\n    if (!selector || effect.type === \"ScrollTop\") {\n      window.scrollTo({ top: 0, behavior });\n      return;\n    }\n\n    const element = document.querySelector(selector);\n    if (element instanceof Element) {\n      element.scrollIntoView({\n        behavior,\n        block: effect.block || \"start\",\n      });\n    }\n  }\n\n  private applyMetadataEffect(effect: MetadataEffect): void {\n    if (typeof document === \"undefined\") {\n      return;\n    }\n\n    if (\n      Object.prototype.hasOwnProperty.call(effect, \"title\") &&\n      effect.title !== undefined\n    ) {\n      document.title = effect.title;\n    }\n\n    const head = document.head;\n    if (!head) {\n      return;\n    }\n\n    const keyAttr = \"data-live-key\";\n    const typeAttr = \"data-live-head\";\n\n    const removeByKeys = (keys?: string[]) => {\n      if (!Array.isArray(keys) || keys.length === 0) {\n        return;\n      }\n      keys.forEach((key) => {\n        head.querySelectorAll(`[${keyAttr}=\"${key}\"]`).forEach((node) => {\n          node.parentNode?.removeChild(node);\n        });\n      });\n    };\n\n    const resetAttributes = (el: Element, preserve: string[]) => {\n      const keep = new Set(preserve);\n      Array.from(el.attributes).forEach((attr) => {\n        if (!keep.has(attr.name)) {\n          el.removeAttribute(attr.name);\n        }\n      });\n    };\n\n    const upsertMeta = (payload: MetadataTagPayload, typeValue: string) => {\n      if (!payload || !payload.key) {\n        return;\n      }\n      let element = head.querySelector(\n        `meta[${keyAttr}=\"${payload.key}\"]`,\n      ) as HTMLMetaElement | null;\n      if (!element) {\n        element = document.createElement(\"meta\");\n        head.appendChild(element);\n      }\n      resetAttributes(element, [keyAttr]);\n      element.setAttribute(keyAttr, payload.key);\n      element.setAttribute(typeAttr, typeValue);\n      if (payload.name !== undefined)\n        element.setAttribute(\"name\", payload.name);\n      if (payload.content !== undefined)\n        element.setAttribute(\"content\", payload.content);\n      if (payload.property !== undefined)\n        element.setAttribute(\"property\", payload.property);\n      if (payload.charset !== undefined)\n        element.setAttribute(\"charset\", payload.charset);\n      if (payload.httpEquiv !== undefined)\n        element.setAttribute(\"http-equiv\", payload.httpEquiv);\n      if (payload.itemProp !== undefined)\n        element.setAttribute(\"itemprop\", payload.itemProp);\n      if (payload.attrs) {\n        for (const [k, v] of Object.entries(payload.attrs)) {\n          if (v != null) {\n            element.setAttribute(k, String(v));\n          }\n        }\n      }\n    };\n\n    const upsertLink = (payload: MetadataLinkPayload) => {\n      if (!payload || !payload.key) {\n        return;\n      }\n      let element = head.querySelector(\n        `link[${keyAttr}=\"${payload.key}\"]`,\n      ) as HTMLLinkElement | null;\n      if (!element) {\n        element = document.createElement(\"link\");\n        head.appendChild(element);\n      }\n      resetAttributes(element, [keyAttr]);\n      element.setAttribute(keyAttr, payload.key);\n      element.setAttribute(typeAttr, \"link\");\n      if (payload.rel !== undefined) element.setAttribute(\"rel\", payload.rel);\n      if (payload.href !== undefined)\n        element.setAttribute(\"href\", payload.href);\n      if (payload.type !== undefined)\n        element.setAttribute(\"type\", payload.type);\n      if (payload.as !== undefined) element.setAttribute(\"as\", payload.as);\n      if (payload.media !== undefined)\n        element.setAttribute(\"media\", payload.media);\n      if (payload.hreflang !== undefined)\n        element.setAttribute(\"hreflang\", payload.hreflang);\n      if (payload.title !== undefined)\n        element.setAttribute(\"title\", payload.title);\n      if (payload.crossorigin !== undefined)\n        element.setAttribute(\"crossorigin\", payload.crossorigin);\n      if (payload.integrity !== undefined)\n        element.setAttribute(\"integrity\", payload.integrity);\n      if (payload.referrerpolicy !== undefined)\n        element.setAttribute(\"referrerpolicy\", payload.referrerpolicy);\n      if (payload.sizes !== undefined)\n        element.setAttribute(\"sizes\", payload.sizes);\n      if (payload.attrs) {\n        for (const [k, v] of Object.entries(payload.attrs)) {\n          if (v != null) {\n            element.setAttribute(k, String(v));\n          }\n        }\n      }\n    };\n\n    const upsertScript = (payload: MetadataScriptPayload) => {\n      if (!payload || !payload.key) {\n        return;\n      }\n      let element = head.querySelector(\n        `script[${keyAttr}=\"${payload.key}\"]`,\n      ) as HTMLScriptElement | null;\n      if (!element) {\n        element = document.createElement(\"script\");\n        head.appendChild(element);\n      }\n      resetAttributes(element, [keyAttr]);\n      element.setAttribute(keyAttr, payload.key);\n      element.setAttribute(typeAttr, \"script\");\n\n      if (payload.module) {\n        element.setAttribute(\"type\", \"module\");\n      } else if (payload.type !== undefined) {\n        element.setAttribute(\"type\", payload.type);\n      }\n      if (payload.src !== undefined) element.setAttribute(\"src\", payload.src);\n      if (payload.async) element.setAttribute(\"async\", \"async\");\n      if (payload.defer) element.setAttribute(\"defer\", \"defer\");\n      if (payload.noModule) element.setAttribute(\"nomodule\", \"nomodule\");\n      if (payload.crossorigin !== undefined)\n        element.setAttribute(\"crossorigin\", payload.crossorigin);\n      if (payload.integrity !== undefined)\n        element.setAttribute(\"integrity\", payload.integrity);\n      if (payload.referrerpolicy !== undefined)\n        element.setAttribute(\"referrerpolicy\", payload.referrerpolicy);\n      if (payload.nonce !== undefined)\n        element.setAttribute(\"nonce\", payload.nonce);\n      if (payload.attrs) {\n        for (const [k, v] of Object.entries(payload.attrs)) {\n          if (v != null) {\n            element.setAttribute(k, String(v));\n          }\n        }\n      }\n      if (payload.inner !== undefined) {\n        element.textContent = payload.inner;\n      }\n    };\n\n    if (effect.clearDescription) {\n      removeByKeys([\"description\"]);\n    }\n    if (\n      Object.prototype.hasOwnProperty.call(effect, \"description\") &&\n      effect.description !== undefined\n    ) {\n      const content = effect.description;\n      if (content.trim().length > 0) {\n        upsertMeta(\n          { key: \"description\", name: \"description\", content },\n          \"description\",\n        );\n      } else {\n        removeByKeys([\"description\"]);\n      }\n    }\n\n    if (Array.isArray(effect.metaRemove)) {\n      removeByKeys(effect.metaRemove);\n    }\n    if (Array.isArray(effect.metaAdd)) {\n      for (const payload of effect.metaAdd) {\n        upsertMeta(payload, \"meta\");\n      }\n    }\n\n    if (Array.isArray(effect.linkRemove)) {\n      removeByKeys(effect.linkRemove);\n    }\n    if (Array.isArray(effect.linkAdd)) {\n      for (const payload of effect.linkAdd) {\n        upsertLink(payload);\n      }\n    }\n\n    if (Array.isArray(effect.scriptRemove)) {\n      removeByKeys(effect.scriptRemove);\n    }\n    if (Array.isArray(effect.scriptAdd)) {\n      for (const payload of effect.scriptAdd) {\n        upsertScript(payload);\n      }\n    }\n  }\n\n  private handleCookieEffect(effect: CookieEffect): void {\n    void this.performCookieSync(effect);\n  }\n\n  private async performCookieSync(effect: CookieEffect): Promise<void> {\n    const token = effect.token ?? effect.Token;\n    if (!token) {\n      this.log(\"Cookie effect missing token\", effect);\n      return;\n    }\n    if (this.cookieRequests.has(token)) {\n      return;\n    }\n\n    const endpoint = effect.endpoint ?? effect.Endpoint ?? DEFAULT_COOKIE_ENDPOINT;\n    if (!endpoint) {\n      this.log(\"Cookie effect missing endpoint\", effect);\n      return;\n    }\n\n    const sid = effect.sid ?? effect.SID ?? this.sessionId.get();\n    if (!sid) {\n      this.log(\"Cookie effect missing session identifier\", effect);\n      return;\n    }\n\n    const method = (effect.method ?? effect.Method ?? \"POST\").toUpperCase();\n\n    this.cookieRequests.add(token);\n    try {\n      const response = await fetch(endpoint, {\n        method,\n        credentials: \"include\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Accept: \"application/json\",\n        },\n        body: JSON.stringify({ sid, token }),\n      });\n\n      if (!response.ok && response.status !== 204) {\n        this.log(\"Cookie negotiation failed\", {\n          endpoint,\n          status: response.status,\n          statusText: response.statusText,\n        });\n      }\n    } catch (error) {\n      this.log(\"Cookie negotiation error\", error);\n      this.emit(\"error\", { error: error as Error, context: \"cookies\" });\n    } finally {\n      this.cookieRequests.delete(token);\n    }\n  }\n\n  private applyFocusEffect(effect: FocusEffect): void {\n    // Support both lowercase and capitalized field names\n    const selector = effect.selector || effect.Selector;\n    if (!selector) return;\n\n    const element = document.querySelector(selector);\n    if (\n      element &&\n      (element instanceof HTMLElement || element instanceof SVGElement) &&\n      typeof element.focus === \"function\"\n    ) {\n      element.focus();\n    }\n  }\n\n  private applyToastEffect(effect: ToastEffect): void {\n    // Support both lowercase and capitalized field names\n    const message = effect.message || effect.Message;\n    const duration = effect.duration || 3000;\n    const variant = effect.variant || \"info\";\n\n    // Emit toast event for custom toast implementations\n    this.emit(\"effect\", {\n      effect: {\n        type: \"toast\",\n        message,\n        duration,\n        variant,\n      },\n    });\n\n    // Fallback to console if no toast handler\n    if (!this.listenerCount(\"effect\")) {\n      console.info(`[Toast ${variant}] ${message}`);\n    }\n  }\n\n  private applyPushEffect(effect: PushEffect): void {\n    // Support both lowercase and capitalized field names\n    const url = effect.url || effect.URL;\n    if (url) {\n      window.history.pushState({}, \"\", url);\n    }\n  }\n\n  private applyReplaceEffect(effect: ReplaceEffect): void {\n    // Support both lowercase and capitalized field names\n    const url = effect.url || effect.URL;\n    if (url) {\n      window.history.replaceState({}, \"\", url);\n    }\n  }\n\n  private applyBootEffect(effect: any): void {\n    const boot = effect?.boot as BootPayload | undefined;\n    if (!boot) {\n      return;\n    }\n    this.applyRootTemplatePayload(boot);\n    this.bootHandler.load(boot);\n  }\n\n  private applyComponentBootEffect(effect: ComponentBootEffect): void {\n    if (typeof document === \"undefined\") return;\n    if (!effect || !effect.componentId) return;\n\n    const { componentId, html, slots, listSlots, bindings, slotPaths, listPaths } = effect;\n    const bounds = this.findComponentRange(componentId);\n    if (!bounds) {\n      if (this.options.debug) {\n        console.warn(`liveui: component ${componentId} bounds not found for componentBoot effect`);\n      }\n      return;\n    }\n\n    if (Array.isArray(slots)) {\n      for (const slot of slots) {\n        dom.unregisterSlot(slot);\n      }\n    }\n    if (Array.isArray(listSlots)) {\n      for (const slot of listSlots) {\n        dom.unregisterList(slot);\n      }\n    }\n\n    // Reset any cached patcher state tied to the replaced component subtree so\n    // future diffs don't reference stale DOM nodes from before the boot\n    // replacement.\n    clearPatcherCaches();\n\n    const template = document.createElement(\"template\");\n    template.innerHTML = html || \"\";\n    const fragment = template.content.cloneNode(true);\n    primeHandlerBindings(fragment);\n\n    const insertedNodes: Node[] = [];\n    for (let child = fragment.firstChild; child; child = child.nextSibling) {\n      insertedNodes.push(child);\n    }\n\n    const container = bounds.container;\n    const afterIndex = bounds.endIndex + 1;\n    const referenceNode =\n      afterIndex < container.childNodes.length ? container.childNodes.item(afterIndex) : null;\n\n    for (let index = bounds.endIndex; index >= bounds.startIndex; index--) {\n      const node = container.childNodes.item(index);\n      if (node) {\n        container.removeChild(node);\n      }\n    }\n\n    container.insertBefore(fragment, referenceNode ?? null);\n\n    const insertedCount = insertedNodes.length;\n    let refreshed: import(\"./componentRanges\").ComponentRange | null = null;\n    if (insertedCount > 0) {\n      const endIndex = bounds.startIndex + insertedCount - 1;\n      refreshed = registerComponentRange(componentId, {\n        container,\n        startIndex: bounds.startIndex,\n        endIndex,\n      });\n    } else {\n      refreshed = registerComponentRange(componentId, {\n        container,\n        startIndex: bounds.startIndex,\n        endIndex: bounds.startIndex - 1,\n      });\n    }\n    if (!refreshed) {\n      refreshed = { container, startIndex: bounds.startIndex, endIndex: bounds.startIndex - 1 };\n    }\n\n    const rangeOverrides = applyComponentRanges(effect.componentPaths, {\n      baseId: componentId,\n      baseRange: refreshed,\n    });\n\n    const slotBindingTable = (bindings as any)?.slots ?? bindings;\n    if (slotBindingTable && typeof slotBindingTable === \"object\") {\n      for (const [slotKey, specs] of Object.entries(slotBindingTable)) {\n        const slotId = Number(slotKey);\n        if (Number.isNaN(slotId)) {\n          continue;\n        }\n        registerBindingsForSlot(slotId, Array.isArray(specs) ? specs : []);\n      }\n    }\n\n    this.registerComponentAnchors(\n      refreshed,\n      Array.isArray(slots) ? slots : [],\n      Array.isArray(listSlots) ? listSlots : [],\n      Array.isArray(slotPaths) ? slotPaths : undefined,\n      Array.isArray(listPaths) ? listPaths : undefined,\n      rangeOverrides,\n    );\n\n    const uploadBindings = (bindings as any)?.uploads ?? bindings?.uploads ?? null;\n    replaceUploadBindingsForComponent(componentId, uploadBindings, rangeOverrides);\n\n    if (Array.isArray(slotPaths) && slotPaths.length > 0) {\n      const anchors = resolveSlotAnchors(slotPaths, rangeOverrides);\n      anchors.forEach((node, slotId) => dom.registerSlot(slotId, node));\n    }\n  }\n\n  private registerTemplateAnchors(\n    range: import(\"./componentRanges\").ComponentRange | null,\n    payload: TemplatePayload,\n    overrides?: Map<string, import(\"./componentRanges\").ComponentRange>,\n  ): void {\n    if (!range) {\n      return;\n    }\n    const slotIds = this.extractSlotIds(payload.slots);\n    const listSlotIds = this.extractListSlotIds(payload.listPaths);\n    this.registerComponentAnchors(\n      range,\n      slotIds,\n      listSlotIds,\n      payload.slotPaths,\n      payload.listPaths,\n      overrides,\n    );\n  }\n\n  private extractSlotIds(slots?: TemplatePayload[\"slots\"] | null): number[] {\n    if (!Array.isArray(slots)) {\n      return [];\n    }\n    const ids: number[] = [];\n    for (const meta of slots) {\n      const id = Number(meta?.anchorId);\n      if (Number.isInteger(id) && id >= 0) {\n        ids.push(id);\n      }\n    }\n    return ids;\n  }\n\n  private extractListSlotIds(\n    descriptors?: TemplatePayload[\"listPaths\"] | null,\n  ): number[] {\n    if (!Array.isArray(descriptors)) {\n      return [];\n    }\n    const seen = new Set<number>();\n    const ids: number[] = [];\n    for (const descriptor of descriptors) {\n      const id = Number(descriptor?.slot);\n      if (!Number.isInteger(id) || id < 0 || seen.has(id)) {\n        continue;\n      }\n      seen.add(id);\n      ids.push(id);\n    }\n    return ids;\n  }\n\n  private getTemplateMarkup(payload: TemplatePayload, scopeKey?: string): string {\n    const scope = scopeKey && scopeKey.length > 0 ? scopeKey : \"__root__\";\n    const templateHash = typeof payload.templateHash === \"string\" ? payload.templateHash : \"\";\n\n    if (typeof payload.html === \"string\") {\n      this.cacheTemplateMarkup(scope, templateHash, payload.html);\n      return payload.html;\n    }\n\n    if (templateHash) {\n      const cached = this.lookupTemplateMarkup(scope, templateHash);\n      if (cached !== null) {\n        return cached;\n      }\n    }\n\n    if (Array.isArray(payload.s) && payload.s.length > 0) {\n      const markup = payload.s.join(\"\");\n      this.cacheTemplateMarkup(scope, templateHash, markup);\n      return markup;\n    }\n\n    this.cacheTemplateMarkup(scope, templateHash, \"\");\n    return \"\";\n  }\n\n  private buildTemplateCacheKey(scope: string, hash: string): string {\n    return `${scope}::${hash}`;\n  }\n\n  private cacheTemplateMarkup(scope: string, hash: string, markup: string): void {\n    if (!hash) {\n      return;\n    }\n    const key = this.buildTemplateCacheKey(scope, hash);\n    if (this.templateCache.has(key)) {\n      this.templateCache.delete(key);\n    }\n    this.templateCache.set(key, markup);\n    if (this.templateCache.size > this.MAX_TEMPLATE_CACHE_SIZE) {\n      const oldest = this.templateCache.keys().next();\n      if (!oldest.done) {\n        this.templateCache.delete(oldest.value);\n      }\n    }\n  }\n\n  private lookupTemplateMarkup(scope: string, hash: string): string | null {\n    if (!hash) {\n      return null;\n    }\n    const key = this.buildTemplateCacheKey(scope, hash);\n    if (!this.templateCache.has(key)) {\n      return null;\n    }\n    const cached = this.templateCache.get(key);\n    return cached !== undefined ? cached : null;\n  }\n\n  private findComponentRange(id: string): import(\"./componentRanges\").ComponentRange | null {\n    if (typeof document === \"undefined\" || !id) return null;\n    return getComponentRange(id);\n  }\n\n  private registerComponentAnchors(\n    range: import(\"./componentRanges\").ComponentRange,\n    slots: number[],\n    listSlots: number[],\n    slotDescriptors?: import(\"./types\").SlotPathDescriptor[],\n    listDescriptors?: import(\"./types\").ListPathDescriptor[],\n    overrides?: Map<string, import(\"./componentRanges\").ComponentRange>,\n  ): void {\n    if (!range || range.endIndex < range.startIndex) {\n      return;\n    }\n    const requestedSlots = Array.isArray(slots)\n      ? slots.filter((value) => Number.isInteger(value) && value >= 0)\n      : [];\n    const requestedLists = Array.isArray(listSlots)\n      ? listSlots.filter((value) => Number.isInteger(value) && value >= 0)\n      : [];\n\n    const pendingSlots = new Set<number>(requestedSlots);\n    const pendingLists = new Set<number>(requestedLists);\n\n    const slotAnchors = resolveSlotAnchors(slotDescriptors, overrides);\n    if (slotAnchors.size > 0) {\n      if (pendingSlots.size > 0) {\n        for (const slotId of Array.from(pendingSlots)) {\n          const node = slotAnchors.get(slotId);\n          if (node) {\n            dom.registerSlot(slotId, node);\n            pendingSlots.delete(slotId);\n          }\n        }\n      } else {\n        for (const [slotId, node] of slotAnchors.entries()) {\n          dom.registerSlot(slotId, node);\n        }\n      }\n    }\n\n    const listAnchors = resolveListContainers(listDescriptors, overrides);\n    if (listAnchors.size > 0) {\n      if (pendingLists.size > 0) {\n        for (const slotId of Array.from(pendingLists)) {\n          const element = listAnchors.get(slotId);\n          if (element) {\n            dom.registerList(slotId, element);\n            pendingLists.delete(slotId);\n          }\n        }\n      } else {\n        for (const [slotId, element] of listAnchors.entries()) {\n          dom.registerList(slotId, element);\n        }\n      }\n    }\n  }\n  private dispatchCustomEvent(eventName: string, detail?: unknown): void {\n    const event = new CustomEvent(eventName, {\n      detail,\n      bubbles: true,\n      cancelable: true,\n    });\n    document.dispatchEvent(event);\n  }\n\n  /**\n   * Schedule a batch to be applied on the next animation frame\n   */\n  private scheduleBatch(): void {\n    if (this.batchScheduled) return;\n\n    this.batchScheduled = true;\n\n    if (typeof requestAnimationFrame === \"function\") {\n      this.rafUsesTimeoutFallback = false;\n      this.rafHandle = requestAnimationFrame(() => {\n        this.rafHandle = null;\n        this.flushBatch();\n      });\n      return;\n    }\n\n    this.rafUsesTimeoutFallback = true;\n    const handle = setTimeout(() => {\n      this.rafHandle = null;\n      this.flushBatch();\n    }, 16);\n    this.rafHandle = handle;\n  }\n\n  /**\n   * Apply all queued patches in a single batch\n   */\n  private flushBatch(): void {\n    if (this.patchQueue.length === 0) {\n      this.batchScheduled = false;\n      this.rafHandle = null;\n      this.rafUsesTimeoutFallback = false;\n      if (this.pendingUploadBindings.length > 0) {\n        this.flushPendingUploadBindings();\n      }\n      return;\n    }\n\n    const startTime = performance.now();\n\n    this.log(\"Applying batched\", this.patchQueue.length, \"operations\");\n    const patches = this.patchQueue;\n    this.patchQueue = [];\n    this.batchScheduled = false;\n    this.rafHandle = null;\n    this.rafUsesTimeoutFallback = false;\n\n    applyOps(patches);\n\n    this.flushPendingUploadBindings();\n\n    const duration = performance.now() - startTime;\n\n    // Update metrics\n    this.metrics.patchesApplied += patches.length;\n    this.patchTimes.push(duration);\n    this.patchTimeTotal += duration;\n    if (this.patchTimes.length > 100) {\n      const removed = this.patchTimes.shift();\n      if (removed !== undefined) {\n        this.patchTimeTotal -= removed;\n      }\n    }\n    const windowLength = this.patchTimes.length;\n    this.metrics.averagePatchTime = windowLength\n      ? this.patchTimeTotal / windowLength\n      : 0;\n\n    this.emit(\"frameApplied\", { operations: patches.length, duration });\n    this.emit(\"metricsUpdated\", this.getMetrics());\n  }\n\n  private cancelScheduledBatch(): void {\n    if (this.rafHandle === null) {\n      return;\n    }\n\n    if (this.rafUsesTimeoutFallback) {\n      clearTimeout(this.rafHandle as ReturnType<typeof setTimeout>);\n    } else if (typeof cancelAnimationFrame === \"function\") {\n      cancelAnimationFrame(this.rafHandle as number);\n    }\n\n    this.rafHandle = null;\n    this.batchScheduled = false;\n    this.rafUsesTimeoutFallback = false;\n  }\n\n  private flushPendingUploadBindings(): void {\n    if (this.pendingUploadBindings.length === 0) {\n      return;\n    }\n\n    const pending = this.pendingUploadBindings;\n    this.pendingUploadBindings = [];\n\n    const descriptors: UploadBindingDescriptor[] = [];\n    for (const group of pending) {\n      if (!Array.isArray(group) || group.length === 0) {\n        continue;\n      }\n      descriptors.push(...group);\n    }\n\n    if (descriptors.length > 0) {\n      applyUploadBindings(descriptors);\n    }\n  }\n\n  private hasStateChanged(\n    oldState: ConnectionState,\n    newState: ConnectionState,\n  ): boolean {\n    if (oldState.status !== newState.status) {\n      return true;\n    }\n\n    switch (newState.status) {\n      case \"connected\":\n        return (\n          oldState.status !== \"connected\" ||\n          oldState.sessionId !== newState.sessionId ||\n          oldState.version !== newState.version\n        );\n      case \"reconnecting\":\n        return (\n          oldState.status !== \"reconnecting\" ||\n          oldState.attempt !== newState.attempt\n        );\n      case \"error\":\n        return oldState.status !== \"error\" || oldState.error !== newState.error;\n      default:\n        return false;\n    }\n  }\n\n  /**\n   * Handle join message\n   */\n  private handleJoin(msg: JoinMessage): void {\n    this.sessionId.set(msg.sid);\n    this.version.set(msg.ver);\n    if (typeof msg.ack === \"number\" && msg.ack > this.lastAck) {\n      this.lastAck = msg.ack;\n    }\n    this.log(\"Joined session:\", msg.sid, \"ack:\", msg.ack);\n  }\n\n  /**\n   * Handle resume message\n   */\n  private handleResume(msg: ResumeMessage): void {\n    this.log(\"Resume from\", msg.from, \"to\", msg.to);\n    const ack = msg.from > 0 ? msg.from - 1 : 0;\n    if (ack > this.lastAck) {\n      this.lastAck = ack;\n    }\n\n    // Reset sequence tracking - expect frames starting from msg.from\n    this.expectedSeq = msg.from;\n    this.frameBuffer.clear();\n\n    if (Array.isArray(msg.errors) && msg.errors.length > 0) {\n      for (const err of msg.errors) {\n        this.recordDiagnostic(err);\n      }\n    }\n    this.emit(\"resumed\", { from: msg.from, to: msg.to });\n    if (this.isReconnecting) {\n      this.flushEventQueue();\n    }\n  }\n\n  /**\n   * Handle error message\n   */\n  private handleError(msg: ErrorMessage): void {\n    const error = new Error(msg.message);\n    console.error(\"LiveUI error:\", msg.code, msg.message);\n    this.emit(\"error\", { error, context: msg.code });\n    this.recordDiagnostic(msg);\n  }\n\n  private handlePubsub(msg: PubsubControlMessage): void {\n    if (!msg.topic) {\n      return;\n    }\n    switch (msg.op) {\n      case \"join\":\n        void this.joinPubsubTopic(msg.topic);\n        break;\n      case \"leave\":\n        void this.leavePubsubTopic(msg.topic);\n        break;\n      default:\n        this.log(\"Unknown pubsub op:\", msg);\n    }\n  }\n\n  private recordDiagnostic(msg: ErrorMessage | DiagnosticMessage): void {\n    if (!this.options.debug) {\n      return;\n    }\n    const key = this.buildDiagnosticKey(msg);\n    const entry: RuntimeDiagnosticEntry = {\n      key,\n      code: msg.code ?? \"runtime_panic\",\n      message: msg.message ?? \"Runtime panic recovered\",\n      details: msg.details,\n      timestamp: Date.now(),\n    };\n    const existingIndex = this.diagnostics.findIndex(\n      (item) => item.key === key,\n    );\n    if (existingIndex >= 0) {\n      this.diagnostics[existingIndex] = entry;\n    } else {\n      this.diagnostics.push(entry);\n      if (this.diagnostics.length > 20) {\n        this.diagnostics.shift();\n      }\n    }\n    if (typeof document !== \"undefined\") {\n      this.renderErrorOverlay();\n    }\n  }\n\n  private buildDiagnosticKey(msg: ErrorMessage | DiagnosticMessage): string {\n    const details = msg.details;\n    const component = details?.componentId ?? details?.componentName ?? \"\";\n    const hook = details?.hook ?? \"\";\n    const phase = details?.phase ?? \"\";\n    const panic = details?.panic ?? \"\";\n    return [\n      msg.code ?? \"\",\n      msg.message ?? \"\",\n      component,\n      hook,\n      phase,\n      panic,\n    ].join(\"|\");\n  }\n\n  private joinPubsubTopic(topic: string): void {\n    if (!topic || !this.client) {\n      return;\n    }\n    if (this.pubsubChannels.has(topic)) {\n      return;\n    }\n\n    const channel = this.client.createChannel<LiveUIEventMap>(\n      `pubsub/${topic}`,\n      {\n        sid: this.sessionId.get() ?? undefined,\n      },\n    );\n\n    const dispose = channel.onLeave(() => {\n      this.pubsubChannels.delete(topic);\n    });\n\n    this.pubsubChannels.set(topic, { channel, dispose });\n\n    try {\n      channel.join();\n      this.log(\"Joined pubsub topic\", topic);\n    } catch (error) {\n      this.pubsubChannels.delete(topic);\n      dispose();\n      this.log(\"Failed to join pubsub topic\", topic, error);\n    }\n  }\n\n  private leavePubsubTopic(topic: string): void {\n    const entry = this.pubsubChannels.get(topic);\n    if (!entry) {\n      return;\n    }\n    this.pubsubChannels.delete(topic);\n    try {\n      entry.dispose();\n      entry.channel.leave();\n      this.log(\"Left pubsub topic\", topic);\n    } catch (error) {\n      this.log(\"Failed to leave pubsub topic\", topic, error);\n    }\n  }\n\n  private ensureErrorOverlayElements(): void {\n    if (!this.options.debug || typeof document === \"undefined\") {\n      return;\n    }\n    if (this.errorOverlay) {\n      return;\n    }\n    const overlay = document.createElement(\"div\");\n    overlay.id = \"live-error-overlay\";\n    overlay.setAttribute(\"role\", \"alertdialog\");\n    overlay.setAttribute(\"aria-live\", \"assertive\");\n    overlay.setAttribute(\"aria-modal\", \"true\");\n    overlay.style.cssText = [\n      \"position:fixed\",\n      \"inset:0\",\n      \"background:rgba(15,23,42,0.82)\",\n      \"color:#e2e8f0\",\n      \"z-index:2147483646\",\n      \"display:none\",\n      \"align-items:flex-start\",\n      \"justify-content:center\",\n      \"overflow-y:auto\",\n      \"padding:48px 24px\",\n      \"box-sizing:border-box\",\n      \"backdrop-filter:blur(6px)\",\n    ].join(\";\");\n    overlay.addEventListener(\"click\", (event) => {\n      if (event.target === overlay) {\n        this.hideErrorOverlay();\n      }\n    });\n\n    const panel = document.createElement(\"div\");\n    panel.style.cssText = [\n      \"width:min(960px,100%)\",\n      \"background:rgba(15,23,42,0.95)\",\n      \"border-radius:16px\",\n      \"border:1px solid rgba(148,163,184,0.35)\",\n      \"box-shadow:0 25px 50px -12px rgba(15,23,42,0.8)\",\n      \"display:flex\",\n      \"flex-direction:column\",\n      \"overflow:hidden\",\n      'font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,\"Segoe UI\",sans-serif',\n    ].join(\";\");\n\n    const header = document.createElement(\"header\");\n    header.style.cssText = [\n      \"display:flex\",\n      \"align-items:center\",\n      \"justify-content:space-between\",\n      \"gap:12px\",\n      \"padding:20px 24px\",\n      \"background:rgba(15,23,42,0.88)\",\n      \"border-bottom:1px solid rgba(148,163,184,0.28)\",\n      \"position:sticky\",\n      \"top:0\",\n      \"z-index:1\",\n    ].join(\";\");\n\n    const title = document.createElement(\"h2\");\n    title.textContent = \"LiveUI Runtime Errors\";\n    title.style.cssText =\n      \"margin:0;font-size:18px;font-weight:700;color:#f8fafc;\";\n\n    const headerMeta = document.createElement(\"div\");\n    headerMeta.style.cssText = \"display:flex;flex-direction:column;gap:4px;\";\n    headerMeta.appendChild(title);\n\n    const hint = document.createElement(\"span\");\n    hint.textContent = \"\u21E7\u2318E / \u21E7Ctrl+E to toggle \u2022 Esc to dismiss\";\n    hint.style.cssText = \"font-size:12px;color:#94a3b8;\";\n    headerMeta.appendChild(hint);\n\n    const controls = document.createElement(\"div\");\n    controls.style.cssText = \"display:flex;align-items:center;gap:8px;\";\n\n    const retryButton = document.createElement(\"button\");\n    retryButton.type = \"button\";\n    retryButton.textContent = \"Retry render\";\n    retryButton.style.cssText = [\n      \"padding:6px 12px\",\n      \"border-radius:6px\",\n      \"border:1px solid rgba(59,130,246,0.4)\",\n      \"background:rgba(37,99,235,0.18)\",\n      \"color:#bfdbfe\",\n      \"font-size:12px\",\n      \"font-weight:600\",\n      \"cursor:pointer\",\n    ].join(\";\");\n    retryButton.addEventListener(\"click\", () => this.requestRecovery());\n\n    const clearButton = document.createElement(\"button\");\n    clearButton.type = \"button\";\n    clearButton.textContent = \"Clear\";\n    clearButton.style.cssText = [\n      \"padding:6px 12px\",\n      \"border-radius:6px\",\n      \"border:1px solid rgba(34,197,94,0.45)\",\n      \"background:rgba(34,197,94,0.18)\",\n      \"color:#bbf7d0\",\n      \"font-size:12px\",\n      \"font-weight:600\",\n      \"cursor:pointer\",\n    ].join(\";\");\n    clearButton.addEventListener(\"click\", () => this.clearDiagnostics());\n\n    const closeButton = document.createElement(\"button\");\n    closeButton.type = \"button\";\n    closeButton.textContent = \"Close\";\n    closeButton.style.cssText = [\n      \"padding:6px 12px\",\n      \"border-radius:6px\",\n      \"border:1px solid rgba(248,113,113,0.4)\",\n      \"background:rgba(248,113,113,0.18)\",\n      \"color:#fecaca\",\n      \"font-size:12px\",\n      \"font-weight:600\",\n      \"cursor:pointer\",\n    ].join(\";\");\n    closeButton.addEventListener(\"click\", () => this.hideErrorOverlay());\n\n    controls.appendChild(retryButton);\n    controls.appendChild(clearButton);\n    controls.appendChild(closeButton);\n\n    header.appendChild(headerMeta);\n    header.appendChild(controls);\n\n    const list = document.createElement(\"div\");\n    list.style.cssText =\n      \"padding:16px 24px 24px;display:flex;flex-direction:column;gap:16px;\";\n\n    panel.appendChild(header);\n    panel.appendChild(list);\n    overlay.appendChild(panel);\n\n    document.body.appendChild(overlay);\n\n    this.errorOverlay = overlay;\n    this.errorListEl = list;\n  }\n\n  private renderErrorOverlay(): void {\n    if (!this.options.debug || typeof document === \"undefined\") {\n      return;\n    }\n    this.ensureErrorOverlayElements();\n    if (!this.errorOverlay || !this.errorListEl) {\n      return;\n    }\n    const list = this.errorListEl;\n    list.innerHTML = \"\";\n    if (this.diagnostics.length === 0) {\n      const empty = document.createElement(\"div\");\n      empty.textContent = \"No runtime errors captured yet.\";\n      empty.style.cssText = \"font-size:14px;color:#94a3b8;\";\n      list.appendChild(empty);\n    } else {\n      const ordered = [...this.diagnostics].sort(\n        (a, b) => b.timestamp - a.timestamp,\n      );\n      for (const entry of ordered) {\n        list.appendChild(this.createDiagnosticElement(entry));\n      }\n    }\n    this.errorOverlay.style.display = \"flex\";\n    this.errorOverlayVisible = true;\n  }\n\n  private createDiagnosticElement(entry: RuntimeDiagnosticEntry): HTMLElement {\n    const container = document.createElement(\"article\");\n    container.style.cssText = [\n      \"background:rgba(15,23,42,0.65)\",\n      \"border:1px solid rgba(148,163,184,0.25)\",\n      \"border-radius:12px\",\n      \"padding:18px 20px\",\n      \"display:flex\",\n      \"flex-direction:column\",\n      \"gap:12px\",\n    ].join(\";\");\n\n    const header = document.createElement(\"div\");\n    header.style.cssText =\n      \"display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;gap:12px;\";\n\n    const title = document.createElement(\"h3\");\n    title.textContent = entry.message || \"Runtime panic recovered\";\n    title.style.cssText =\n      \"margin:0;font-size:16px;font-weight:700;color:#f8fafc;\";\n\n    const badgeGroup = document.createElement(\"div\");\n    badgeGroup.style.cssText = \"display:flex;align-items:center;gap:8px;\";\n\n    const badge = document.createElement(\"span\");\n    badge.textContent = entry.code || \"runtime_panic\";\n    badge.style.cssText = [\n      \"font-size:11px\",\n      \"font-weight:700\",\n      \"letter-spacing:0.08em\",\n      \"text-transform:uppercase\",\n      \"background:rgba(37,99,235,0.18)\",\n      \"color:#bfdbfe\",\n      \"border:1px solid rgba(37,99,235,0.35)\",\n      \"border-radius:9999px\",\n      \"padding:4px 10px\",\n    ].join(\";\");\n\n    const timeEl = document.createElement(\"time\");\n    const captured = entry.details?.capturedAt\n      ? new Date(entry.details.capturedAt)\n      : new Date(entry.timestamp);\n    if (!Number.isNaN(captured.getTime())) {\n      timeEl.dateTime = captured.toISOString();\n      timeEl.textContent = captured.toLocaleString();\n    } else {\n      timeEl.textContent = new Date(entry.timestamp).toLocaleString();\n    }\n    timeEl.style.cssText = \"font-size:12px;color:#94a3b8;\";\n\n    badgeGroup.appendChild(badge);\n    badgeGroup.appendChild(timeEl);\n\n    header.appendChild(title);\n    header.appendChild(badgeGroup);\n    container.appendChild(header);\n\n    const details = entry.details;\n    const metaContainer = document.createElement(\"div\");\n    metaContainer.style.cssText =\n      \"display:flex;flex-direction:column;gap:4px;font-size:12px;color:#cbd5f5;\";\n\n    const componentLabel =\n      details?.componentName && details.componentId\n        ? `${details.componentName} (${details.componentId})`\n        : (details?.componentName ?? details?.componentId ?? \"\");\n    this.appendMeta(metaContainer, \"Component\", componentLabel);\n    this.appendMeta(metaContainer, \"Phase\", details?.phase);\n    if (details?.hook) {\n      const hookInfo =\n        details.hookIndex != null\n          ? `${details.hook} (#${details.hookIndex})`\n          : details.hook;\n      this.appendMeta(metaContainer, \"Hook\", hookInfo);\n    }\n    this.appendMeta(metaContainer, \"Panic\", details?.panic);\n\n    if (metaContainer.childNodes.length > 0) {\n      container.appendChild(metaContainer);\n    }\n\n    if (details?.suggestion) {\n      const suggestion = document.createElement(\"p\");\n      suggestion.textContent = details.suggestion;\n      suggestion.style.cssText =\n        \"margin:0;padding:12px 14px;border-radius:8px;background:rgba(34,197,94,0.12);color:#bbf7d0;font-size:13px;border-left:3px solid rgba(34,197,94,0.45);\";\n      container.appendChild(suggestion);\n    }\n\n    const metadata = details?.metadata;\n    if (metadata && Object.keys(metadata).length > 0) {\n      const dl = document.createElement(\"dl\");\n      dl.style.cssText =\n        \"display:grid;grid-template-columns:max-content 1fr;gap:4px 12px;padding:12px;border-radius:8px;background:rgba(15,23,42,0.5);\";\n      for (const [key, value] of Object.entries(metadata)) {\n        const dt = document.createElement(\"dt\");\n        dt.textContent = key;\n        dt.style.cssText = \"font-weight:600;color:#e2e8f0;\";\n        const dd = document.createElement(\"dd\");\n        dd.textContent = this.formatMetadataValue(value);\n        dd.style.cssText = \"margin:0;white-space:pre-wrap;color:#cbd5f5;\";\n        dl.appendChild(dt);\n        dl.appendChild(dd);\n      }\n      container.appendChild(dl);\n    }\n\n    if (details?.stack) {\n      const stack = document.createElement(\"pre\");\n      stack.textContent = details.stack.trim();\n      stack.style.cssText =\n        \"margin:0;padding:12px;border-radius:8px;background:#020617;color:#f1f5f9;max-height:220px;overflow:auto;font-size:12px;line-height:1.45;\";\n      container.appendChild(stack);\n    }\n\n    return container;\n  }\n\n  private appendMeta(\n    container: HTMLElement,\n    label: string,\n    value?: string | null,\n  ): void {\n    if (!value) {\n      return;\n    }\n    const row = document.createElement(\"div\");\n    row.style.cssText = \"display:flex;gap:6px;align-items:flex-start;\";\n    const strong = document.createElement(\"span\");\n    strong.textContent = `${label}:`;\n    strong.style.cssText = \"font-weight:600;min-width:88px;color:#e2e8f0;\";\n    const span = document.createElement(\"span\");\n    span.textContent = value;\n    span.style.cssText = \"flex:1;\";\n    row.appendChild(strong);\n    row.appendChild(span);\n    container.appendChild(row);\n  }\n\n  private formatMetadataValue(value: unknown): string {\n    if (value === null || value === undefined) {\n      return \"null\";\n    }\n    if (typeof value === \"string\") {\n      return value;\n    }\n    if (typeof value === \"number\" || typeof value === \"boolean\") {\n      return String(value);\n    }\n    try {\n      return JSON.stringify(value, null, 2);\n    } catch {\n      return String(value);\n    }\n  }\n\n  private hideErrorOverlay(): void {\n    if (!this.errorOverlay) {\n      return;\n    }\n    this.errorOverlay.style.display = \"none\";\n    this.errorOverlayVisible = false;\n  }\n\n  private clearDiagnostics(): void {\n    this.diagnostics = [];\n    if (this.errorListEl) {\n      this.errorListEl.innerHTML = \"\";\n    }\n    this.hideErrorOverlay();\n  }\n\n  private requestRecovery(): void {\n    const sid = this.sessionId.get();\n    if (!sid || !this.channel) {\n      this.log(\"Cannot request recovery without active session/channel\");\n      return;\n    }\n    this.log(\"Requesting runtime recovery\");\n    this.channel.sendMessage(\"recover\", { t: \"recover\", sid });\n  }\n\n  private onDebugKeydown(event: KeyboardEvent): void {\n    if (!this.options.debug) {\n      return;\n    }\n    if (event.key === \"Escape\" && this.errorOverlayVisible) {\n      this.hideErrorOverlay();\n      return;\n    }\n    if (\n      (event.key === \"e\" || event.key === \"E\") &&\n      event.shiftKey &&\n      (event.metaKey || event.ctrlKey)\n    ) {\n      event.preventDefault();\n      this.renderErrorOverlay();\n    }\n  }\n\n  /**\n   * Send event to the server\n   */\n  private sendEvent(event: { hid: string; payload: EventPayload }): void {\n    const state = this.connectionState.get();\n    if (state.status !== \"connected\" || !this.channel) {\n      this.log(\"Not connected, queueing event\");\n      this.eventQueue.push(event);\n      return;\n    }\n\n    const msg = {\n      t: \"evt\" as const,\n      sid: this.sessionId.get()!,\n      hid: event.hid,\n      payload: event.payload,\n    };\n\n    this.log(\"Sending event:\", msg);\n    this.channel.sendMessage(\"evt\", msg);\n    this.metrics.eventsProcessed++;\n  }\n\n  private sendUploadMessage(payload: UploadClientMessage): void {\n    const state = this.connectionState.get();\n    if (state.status !== \"connected\" || !this.channel) {\n      this.log(\"Not connected, skipping upload message\");\n      return;\n    }\n\n    this.channel.sendMessage(\"upload\", payload);\n  }\n\n  /**\n   * Send navigation message to the server\n   * Returns true if navigation was sent, false if not connected\n   */\n  private sendNavigation(path: string, query: string, hash: string): boolean {\n    const state = this.connectionState.get();\n    if (state.status !== \"connected\" || !this.channel) {\n      this.log(\"Not connected, cannot navigate\");\n      return false;\n    }\n\n    const msg = {\n      t: \"nav\" as const,\n      sid: this.sessionId.get()!,\n      path: path,\n      q: query,\n      hash: hash,\n    };\n\n    this.log(\"Sending navigation:\", msg);\n    this.channel.sendMessage(\"nav\", msg);\n\n    // Optimistically update the URL\n    const queryPart = query ? `?${query}` : \"\";\n    const hashPart = hash ? `#${hash}` : \"\";\n    window.history.pushState({}, \"\", `${path}${queryPart}${hashPart}`);\n\n    // Track optimistic navigation time to prevent double pushState\n    this.lastOptimisticNavTime = Date.now();\n\n    return true;\n  }\n\n  /**\n   * Handle browser back/forward navigation\n   */\n  private handlePopState = (): void => {\n    const state = this.connectionState.get();\n    if (state.status !== \"connected\" || !this.channel) {\n      this.log(\"Not connected, cannot handle popstate\");\n      return;\n    }\n\n    const path = window.location.pathname;\n    const query = window.location.search.substring(1); // Remove leading '?'\n    const hash = window.location.hash.startsWith(\"#\")\n      ? window.location.hash.substring(1)\n      : window.location.hash;\n\n    const msg = {\n      t: \"pop\" as const,\n      sid: this.sessionId.get()!,\n      path: path,\n      q: query,\n      hash: hash,\n    };\n\n    this.log(\"Sending popstate navigation:\", msg);\n    this.channel.sendMessage(\"pop\", msg);\n  };\n\n  public requestRouterReset(componentId: string): void {\n    const sid = this.sessionId.get();\n    if (!sid || !this.channel) {\n      this.log(\"Cannot request router reset without active session/channel\");\n      return;\n    }\n\n    const trimmed = typeof componentId === \"string\" ? componentId.trim() : \"\";\n    if (!trimmed) {\n      this.log(\"Cannot request router reset without component id\");\n      return;\n    }\n\n    const payload = {\n      t: \"routerReset\" as const,\n      sid,\n      componentId: trimmed,\n    };\n\n    this.log(\"Requesting router reset:\", payload);\n    this.channel.sendMessage(\"routerReset\", payload);\n  }\n\n  /**\n   * Send acknowledgement to the server\n   */\n  private sendAck(seq: number): void {\n    if (!this.channel) return;\n\n    const msg = {\n      t: \"ack\" as const,\n      sid: this.sessionId.get()!,\n      seq: seq,\n    };\n\n    this.channel.sendMessage(\"ack\", msg);\n    if (typeof seq === \"number\" && seq > this.lastAck) {\n      this.lastAck = seq;\n    }\n  }\n\n  /**\n   * Flush queued events\n   */\n  private flushEventQueue(): void {\n    if (this.eventQueue.length === 0) return;\n\n    this.log(\"Flushing\", this.eventQueue.length, \"queued events\");\n    const queue = this.eventQueue;\n    this.eventQueue = [];\n\n    for (const event of queue) {\n      this.sendEvent(event);\n    }\n  }\n\n  /**\n   * Log helper\n   */\n  private log(...args: unknown[]): void {\n    if (this.options.debug) {\n      console.log(\"[LiveUI]\", ...args);\n    }\n  }\n}\n\nexport default LiveUI;\n\nexport {\n  configurePatcher,\n  getPatcherConfig,\n  clearPatcherCaches,\n  getPatcherStats,\n  morphElement,\n  dom,\n  applyOps,\n  Signal,\n  ComputedSignal,\n};\n\nexport {\n  getRefElement,\n  getRefMeta,\n  getRefPayload,\n  getRefPayloads,\n} from \"./refs\";\n\nexport type { BootPayload } from \"./types\";\n", "/**\n * DOM Index\n *\n * Keeps track of dynamic slot anchors and keyed list containers so\n * list operations can insert, remove, and reorder DOM regions without\n * full re-renders.\n */\n\nimport type { ListRecord } from \"./types\";\nimport { onSlotRegistered, onSlotUnregistered } from \"./events\";\n\nconst slotMap = new Map<number, Node>();\nconst listMap = new Map<number, ListRecord>();\n\nfunction collectRows(container: Element | null): Map<string, Element> {\n  const rows = new Map<string, Element>();\n  if (!container) return rows;\n\n  const elements = container.querySelectorAll(\"[data-row-key]\");\n  elements.forEach((el) => {\n    const key = el.getAttribute(\"data-row-key\");\n    if (!key) return;\n    rows.set(key, el as Element);\n  });\n\n  return rows;\n}\n\nexport function registerSlot(index: number, node: Node): void {\n  if (!node) return;\n  slotMap.set(index, node);\n  onSlotRegistered(index, node);\n}\n\nexport function getSlot(index: number): Node | null {\n  return slotMap.get(index) ?? null;\n}\n\nexport function unregisterSlot(index: number): void {\n  onSlotUnregistered(index);\n  slotMap.delete(index);\n}\n\nexport function unregisterList(slotIndex: number): void {\n  listMap.delete(slotIndex);\n}\n\nexport function reset(): void {\n  slotMap.forEach((_node, index) => {\n    onSlotUnregistered(index);\n  });\n  slotMap.clear();\n  listMap.clear();\n}\n\n/**\n * Initialize all list containers upfront.\n * Optionally provide a lookup table to avoid DOM queries.\n */\nexport function initLists(\n  slotIndexes: number[],\n  containers?: Map<number, Element> | Record<number, Element | null | undefined>,\n): void {\n  if (!Array.isArray(slotIndexes)) return;\n  const lookup = (slotIndex: number): Element | null => {\n    if (containers instanceof Map) {\n      const candidate = containers.get(slotIndex);\n      return candidate instanceof Element ? candidate : null;\n    }\n    if (containers && typeof containers === 'object') {\n      const key = String(slotIndex);\n      const candidate = (containers as Record<string, Element | null | undefined>)[key];\n      return candidate instanceof Element ? candidate : null;\n    }\n    return null;\n  };\n\n  for (const slotIndex of slotIndexes) {\n    if (listMap.has(slotIndex) && listMap.get(slotIndex)?.container instanceof Element) {\n      continue;\n    }\n    const container = lookup(slotIndex);\n    if (container) {\n      registerList(slotIndex, container);\n    }\n  }\n}\n\nexport function ensureList(slotIndex: number): ListRecord {\n  const record = listMap.get(slotIndex);\n  if (!record || !record.container) {\n    throw new Error(`liveui: list slot ${slotIndex} not registered`);\n  }\n  return record;\n}\n\nexport function registerList(\n  slotIndex: number,\n  container: Element,\n  rows?: Map<string, Element>,\n): void {\n  if (!container) return;\n  listMap.set(slotIndex, { container, rows: rows ?? collectRows(container) });\n}\n\nexport function setRow(slotIndex: number, key: string, root: Element): void {\n  const list = ensureList(slotIndex);\n  list.rows.set(key, root);\n}\n\nexport function getRow(slotIndex: number, key: string): Element | null {\n  const list = ensureList(slotIndex);\n  return list.rows.get(key) ?? null;\n}\n\nexport function deleteRow(slotIndex: number, key: string): void {\n  const list = ensureList(slotIndex);\n  list.rows.delete(key);\n}\n", "import type { EventPayload, RefMap, RefMeta } from \"./types\";\n\nexport interface RefEventContext {\n  id: string;\n  element: Element;\n  props: string[];\n  notify(payload: EventPayload): void;\n}\n\ninterface RefRecord {\n  id: string;\n  meta: RefMeta;\n  element: Element | null;\n  lastPayloads?: Record<string, EventPayload>;\n}\n\nconst registry = new Map<string, RefRecord>();\n\nfunction escapeAttributeValue(value: string): string {\n  if (typeof value !== \"string\") {\n    return \"\";\n  }\n  if (typeof CSS !== \"undefined\" && typeof CSS.escape === \"function\") {\n    return CSS.escape(value);\n  }\n  return value.replace(/[\"]|\\\\/g, \"\\\\$&\");\n}\n\nfunction queryRefElement(id: string): Element | null {\n  if (typeof document === \"undefined\" || !id) {\n    return null;\n  }\n  const selector = `[data-live-ref=\"${escapeAttributeValue(id)}\"]`;\n  try {\n    return document.querySelector(selector);\n  } catch (_error) {\n    return document.querySelector(`[data-live-ref=\"${id}\"]`);\n  }\n}\n\nfunction ensureRecord(id: string, meta?: RefMeta): RefRecord {\n  let record = registry.get(id);\n  if (!record) {\n    record = {\n      id,\n      meta: meta ?? { tag: \"\" },\n      element: queryRefElement(id),\n    };\n    registry.set(id, record);\n  } else if (meta) {\n    record.meta = meta;\n    if (!record.element) {\n      record.element = queryRefElement(id);\n    }\n  }\n  return record;\n}\n\nfunction collectRefEventProps(meta: RefMeta | null | undefined, eventType: string): string[] {\n  if (!meta || !meta.events) {\n    return [];\n  }\n\n  const selectors: string[] = [];\n  const seen = new Set<string>();\n\n  for (const [primary, eventMeta] of Object.entries(meta.events)) {\n    if (!eventMeta) {\n      continue;\n    }\n\n    const listens = Array.isArray(eventMeta.listen) ? eventMeta.listen : [];\n    if (primary !== eventType && !listens.includes(eventType)) {\n      continue;\n    }\n\n    if (!Array.isArray(eventMeta.props)) {\n      continue;\n    }\n\n    for (const prop of eventMeta.props) {\n      if (typeof prop !== \"string\" || prop.length === 0) {\n        continue;\n      }\n      if (seen.has(prop)) {\n        continue;\n      }\n      seen.add(prop);\n      selectors.push(prop);\n    }\n  }\n\n  return selectors;\n}\n\nexport function resolveRefEventContext(\n  element: Element | null,\n  eventType: string,\n): RefEventContext | null {\n  if (!element || !eventType) {\n    return null;\n  }\n\n  const refElement = findClosestRefElement(element);\n  if (!refElement) {\n    return null;\n  }\n\n  const id = refElement.getAttribute(\"data-live-ref\");\n  if (!id) {\n    return null;\n  }\n\n  const record = ensureRecord(id);\n  record.element = refElement;\n\n  if (!refSupportsEvent(record.meta, eventType)) {\n    return null;\n  }\n\n  const props = collectRefEventProps(record.meta, eventType);\n\n  return {\n    id,\n    element: refElement,\n    props,\n    notify(payload: EventPayload) {\n      if (!record.lastPayloads) {\n        record.lastPayloads = Object.create(null);\n      }\n      record.lastPayloads[eventType] = { ...payload };\n    },\n  };\n}\n\nfunction attachRef(id: string, element: Element): void {\n  if (!id) {\n    return;\n  }\n  const record = ensureRecord(id);\n  record.element = element;\n  if (!record.meta.tag) {\n    record.meta = { ...record.meta, tag: element.tagName.toLowerCase() };\n  }\n}\n\nfunction detachRef(id: string, element: Element | null): void {\n  const record = registry.get(id);\n  if (!record) {\n    return;\n  }\n  if (!element || record.element === element) {\n    record.element = null;\n  }\n}\n\nfunction forEachRefElement(\n  root: ParentNode | Element | DocumentFragment,\n  visit: (el: Element) => void,\n): void {\n  if (root instanceof Element) {\n    visit(root);\n  }\n\n  const selectorAll = (root as ParentNode).querySelectorAll?.bind(root as ParentNode);\n  if (typeof selectorAll !== \"function\") {\n    return;\n  }\n\n  const matches = selectorAll(\"[data-live-ref]\");\n  matches.forEach((node) => {\n    if (node instanceof Element) {\n      visit(node);\n    }\n  });\n}\n\nexport function clearRefs(): void {\n  registry.clear();\n}\n\nexport function registerRefs(refs?: RefMap | null): void {\n  if (!refs) {\n    return;\n  }\n  for (const [id, meta] of Object.entries(refs)) {\n    if (!id) {\n      continue;\n    }\n    ensureRecord(id, meta);\n  }\n}\n\nexport function unregisterRefs(ids?: string[] | null): void {\n  if (!Array.isArray(ids)) {\n    return;\n  }\n  for (const id of ids) {\n    if (!id) {\n      continue;\n    }\n    registry.delete(id);\n  }\n}\n\nexport function bindRefsInTree(\n  root: ParentNode | Element | DocumentFragment | Document | null | undefined,\n): void {\n  if (!root || typeof document === \"undefined\") {\n    return;\n  }\n  forEachRefElement(root as ParentNode, (el) => {\n    const id = el.getAttribute(\"data-live-ref\");\n    if (id) {\n      attachRef(id, el);\n    }\n  });\n}\n\nexport function unbindRefsInTree(\n  root: ParentNode | Element | DocumentFragment | Document | null | undefined,\n): void {\n  if (!root || typeof document === \"undefined\") {\n    return;\n  }\n  forEachRefElement(root as ParentNode, (el) => {\n    const id = el.getAttribute(\"data-live-ref\");\n    if (id) {\n      detachRef(id, el);\n    }\n  });\n}\n\nexport function updateRefBinding(\n  element: Element,\n  previousId: string | null,\n  nextId: string | null,\n): void {\n  if (previousId && (!nextId || previousId !== nextId)) {\n    detachRef(previousId, element);\n  }\n  if (nextId) {\n    attachRef(nextId, element);\n  } else if (previousId && !nextId) {\n    detachRef(previousId, element);\n  }\n}\n\nexport function getRefElement(id: string): Element | null {\n  const record = registry.get(id);\n  return record?.element ?? null;\n}\n\nexport function getRefMeta(id: string): RefMeta | null {\n  const record = registry.get(id);\n  return record?.meta ?? null;\n}\n\nexport function getRegistrySnapshot(): Map<string, RefRecord> {\n  return new Map(registry);\n}\n\nfunction findClosestRefElement(element: Element | null): Element | null {\n  let current: Element | null = element;\n  while (current) {\n    if (typeof current.getAttribute === \"function\") {\n      const id = current.getAttribute(\"data-live-ref\");\n      if (id) {\n        return current;\n      }\n    }\n    current = current.parentElement;\n  }\n  return null;\n}\n\nfunction refSupportsEvent(meta: RefMeta | null | undefined, eventType: string): boolean {\n  if (!meta || !meta.events) {\n    return false;\n  }\n  for (const [primary, eventMeta] of Object.entries(meta.events)) {\n    if (primary === eventType) {\n      return true;\n    }\n    if (eventMeta?.listen && eventMeta.listen.includes(eventType)) {\n      return true;\n    }\n  }\n  return false;\n}\n\nexport function notifyRefEvent(\n  element: Element | null,\n  eventType: string,\n  payload: EventPayload,\n): void {\n  const context = resolveRefEventContext(element, eventType);\n  if (context) {\n    context.notify(payload);\n  }\n}\n", "import { getRefElement } from \"./refs\";\n\nexport interface DOMGetContext {\n  event?: Event | null;\n  target?: Element | null;\n  handlerElement?: Element | null;\n  refElement?: Element | null;\n}\n\nfunction pickSource(scope: string, ctx: DOMGetContext): any {\n  switch (scope) {\n    case \"event\":\n      return ctx.event ?? undefined;\n    case \"target\":\n      return ctx.target ?? undefined;\n    case \"currentTarget\":\n      if (ctx.handlerElement) {\n        return ctx.handlerElement;\n      }\n      return ctx.event && \"currentTarget\" in ctx.event\n        ? (ctx.event as Event).currentTarget ?? undefined\n        : undefined;\n    case \"element\":\n    case \"ref\":\n      return ctx.refElement ?? ctx.handlerElement ?? ctx.target ?? undefined;\n    default:\n      return undefined;\n  }\n}\n\nfunction resolvePath(source: any, parts: string[]): any {\n  let value = source;\n  for (const part of parts) {\n    if (!part) {\n      continue;\n    }\n    if (value == null) {\n      return undefined;\n    }\n    try {\n      value = value[part as keyof typeof value];\n    } catch (_error) {\n      return undefined;\n    }\n  }\n  return value;\n}\n\nexport function resolvePropertySelector(\n  selector: string,\n  ctx: DOMGetContext,\n): any {\n  if (typeof selector !== \"string\") {\n    return undefined;\n  }\n  const trimmed = selector.trim();\n  if (!trimmed) {\n    return undefined;\n  }\n  const parts = trimmed.split(\".\");\n  if (parts.length === 0) {\n    return undefined;\n  }\n  const scope = parts.shift();\n  if (!scope) {\n    return undefined;\n  }\n  const source = pickSource(scope, ctx);\n  if (source === undefined) {\n    return undefined;\n  }\n  return resolvePath(source, parts);\n}\n\nexport function domGetSync(\n  selectors: string[] | null | undefined,\n  ctx: DOMGetContext,\n): Record<string, any> | null {\n  if (!Array.isArray(selectors) || selectors.length === 0) {\n    return null;\n  }\n  const result: Record<string, any> = {};\n  for (const selector of selectors) {\n    if (typeof selector !== \"string\" || selector.length === 0) {\n      continue;\n    }\n    const raw = resolvePropertySelector(selector, ctx);\n    if (raw === undefined) {\n      continue;\n    }\n    const normalized = normalizePropertyValue(raw);\n    if (normalized !== undefined) {\n      result[selector] = normalized;\n    }\n  }\n  return Object.keys(result).length > 0 ? result : null;\n}\n\nexport function normalizePropertyValue(value: any): any {\n  if (value === null) {\n    return null;\n  }\n  const type = typeof value;\n  if (type === \"string\" || type === \"number\" || type === \"boolean\") {\n    return value;\n  }\n  if (value instanceof Date) {\n    return value.toISOString();\n  }\n  if (typeof FileList !== \"undefined\" && value instanceof FileList) {\n    return serializeFileList(value);\n  }\n  if (typeof File !== \"undefined\" && value instanceof File) {\n    return { name: value.name, size: value.size, type: value.type };\n  }\n  if (typeof DOMTokenList !== \"undefined\" && value instanceof DOMTokenList) {\n    return Array.from(value);\n  }\n  if (typeof TimeRanges !== \"undefined\" && value instanceof TimeRanges) {\n    const ranges: Array<{ start: number; end: number }> = [];\n    for (let i = 0; i < value.length; i++) {\n      try {\n        ranges.push({ start: value.start(i), end: value.end(i) });\n      } catch (_error) {\n        // Ignore invalid ranges\n      }\n    }\n    return ranges;\n  }\n  if (Array.isArray(value)) {\n    return value\n      .map((item) => normalizePropertyValue(item))\n      .filter((item) => item !== undefined);\n  }\n  if (value && typeof value === \"object\") {\n    try {\n      return JSON.parse(JSON.stringify(value));\n    } catch (_error) {\n      return undefined;\n    }\n  }\n  return undefined;\n}\n\nfunction serializeFileList(list: FileList): Array<{\n  name: string;\n  size: number;\n  type: string;\n}> {\n  const files: Array<{ name: string; size: number; type: string }> = [];\n  for (let i = 0; i < list.length; i++) {\n    const file = list.item(i);\n    if (file) {\n      files.push({ name: file.name, size: file.size, type: file.type });\n    }\n  }\n  return files;\n}\n\nexport interface DOMCallOptions {\n  allowMissing?: boolean;\n}\n\nexport interface DOMActionResult {\n  ok: boolean;\n  reason?: string;\n  error?: unknown;\n}\n\nexport function callElementMethod(\n  refId: string,\n  method: string,\n  args: any[] = [],\n  options?: DOMCallOptions,\n): DOMActionResult {\n  const element = refId ? getRefElement(refId) : null;\n  if (!element) {\n    if (!options?.allowMissing) {\n      console.warn(\"[LiveUI] DOMCall target missing\", { refId, method });\n    }\n    return { ok: false, reason: \"missing_element\" };\n  }\n  const fn: any = (element as any)[method];\n  if (typeof fn !== \"function\") {\n    console.warn(\"[LiveUI] DOMCall method missing\", { refId, method });\n    return { ok: false, reason: \"missing_method\" };\n  }\n  try {\n    const result = fn.apply(element, Array.isArray(args) ? args : []);\n    if (result && typeof (result as Promise<unknown>).then === \"function\") {\n      (result as Promise<unknown>).catch((error) => {\n        console.warn(\"[LiveUI] DOMCall promise rejected\", {\n          refId,\n          method,\n          error,\n        });\n      });\n    }\n    return { ok: true };\n  } catch (error) {\n    console.error(\"[LiveUI] DOMCall failed\", { refId, method, error });\n    return { ok: false, reason: \"invoke_failed\", error };\n  }\n}\n\nexport function setElementProperty(\n  refId: string,\n  prop: string,\n  value: unknown,\n): DOMActionResult {\n  const element = refId ? getRefElement(refId) : null;\n  if (!element) {\n    console.warn(\"[LiveUI] DOMSet target missing\", { refId, prop });\n    return { ok: false, reason: \"missing_element\" };\n  }\n  const name = typeof prop === \"string\" ? prop.trim() : \"\";\n  if (!name) {\n    return { ok: false, reason: \"missing_property\" };\n  }\n  try {\n    (element as any)[name] = value;\n    return { ok: true };\n  } catch (error) {\n    console.error(\"[LiveUI] DOMSet failed\", { refId, prop: name, error });\n    return { ok: false, reason: \"set_failed\", error };\n  }\n}\n\nexport function setBooleanProperty(\n  refId: string,\n  prop: string,\n  value: boolean,\n): DOMActionResult {\n  if (typeof value !== \"boolean\") {\n    return { ok: false, reason: \"invalid_value\" };\n  }\n  return setElementProperty(refId, prop, value);\n}\n\nexport function toggleElementClass(\n  refId: string,\n  className: string,\n  on?: boolean,\n): DOMActionResult {\n  const element = refId ? getRefElement(refId) : null;\n  if (!element) {\n    console.warn(\"[LiveUI] DOMClass target missing\", { refId, className });\n    return { ok: false, reason: \"missing_element\" };\n  }\n  const token = typeof className === \"string\" ? className.trim() : \"\";\n  if (!token) {\n    return { ok: false, reason: \"missing_class\" };\n  }\n  if (!(\"classList\" in (element as Element))) {\n    return { ok: false, reason: \"classlist_missing\" };\n  }\n  try {\n    if (on === undefined) {\n      (element as Element).classList.toggle(token);\n    } else {\n      (element as Element).classList.toggle(token, on);\n    }\n    return { ok: true };\n  } catch (error) {\n    console.error(\"[LiveUI] DOMClass failed\", {\n      refId,\n      className: token,\n      error,\n    });\n    return { ok: false, reason: \"class_toggle_failed\", error };\n  }\n}\n\nexport function scrollElementIntoView(\n  refId: string,\n  options?: ScrollIntoViewOptions | null,\n): DOMActionResult {\n  const element = refId ? getRefElement(refId) : null;\n  if (!element) {\n    console.warn(\"[LiveUI] DOMScroll target missing\", { refId });\n    return { ok: false, reason: \"missing_element\" };\n  }\n  const scrollFn = (element as Element).scrollIntoView;\n  if (typeof scrollFn !== \"function\") {\n    return { ok: false, reason: \"missing_scroll\" };\n  }\n  try {\n    if (options && Object.keys(options).length > 0) {\n      scrollFn.call(element, options);\n    } else {\n      scrollFn.call(element);\n    }\n    return { ok: true };\n  } catch (error) {\n    console.error(\"[LiveUI] DOMScroll failed\", { refId, error });\n    return { ok: false, reason: \"scroll_failed\", error };\n  }\n}\n", "/**\n * Events\n *\n * Handles event delegation and forwards events to the server via the\n * WebSocket connection.\n */\n\nimport type {\n  BindingTable,\n  EventPayload,\n  HandlerMap,\n  HandlerMeta,\n  SlotBinding,\n} from \"./types\";\nimport { domGetSync } from \"./dom\";\nimport { resolveRefEventContext } from \"./refs\";\n\nconst handlers = new Map<string, HandlerMeta>();\nconst eventUsageCounts = new Map<string, number>();\nconst installedListeners = new Map<string, (e: Event) => void>();\nconst handlerBindings = new WeakMap<Element, Map<string, string>>();\nconst slotBindingSpecs = new Map<number, SlotBinding[]>();\nconst slotElements = new Map<number, Element>();\nconst routerBindings = new WeakMap<Element, RouterMeta>();\n\nconst DATA_EVENT_ATTR_PREFIX = \"data-on\";\nexport const DATA_ROUTER_ATTR_PREFIX = \"data-router-\";\n\nconst ALWAYS_ACTIVE_EVENTS = [\"click\", \"input\", \"change\", \"submit\"];\nconst CAPTURE_EVENTS = new Set([\n  \"blur\",\n  \"focus\",\n  \"mouseenter\",\n  \"mouseleave\",\n  \"pointerenter\",\n  \"pointerleave\",\n]);\n\ninterface RouterMeta {\n  path?: string;\n  query?: string;\n  hash?: string;\n  replace?: string;\n}\n\nfunction setRouterMetaValue(\n  element: Element,\n  field: keyof RouterMeta,\n  value: string | null | undefined,\n): void {\n  let meta = routerBindings.get(element);\n  if (value === null || value === undefined || value === \"\") {\n    if (!meta) {\n      return;\n    }\n    delete meta[field];\n    if (!meta.path && !meta.query && !meta.hash && !meta.replace) {\n      routerBindings.delete(element);\n    }\n    return;\n  }\n  if (!meta) {\n    meta = {};\n    routerBindings.set(element, meta);\n  }\n  meta[field] = value;\n}\n\nexport function applyRouterAttribute(\n  element: Element | null | undefined,\n  key: string,\n  value: string | null | undefined,\n): void {\n  if (!element || typeof key !== \"string\" || key.length === 0) {\n    return;\n  }\n  switch (key) {\n    case \"path\":\n    case \"query\":\n    case \"hash\":\n    case \"replace\":\n      setRouterMetaValue(element, key, value);\n      break;\n    default:\n      break;\n  }\n}\n\nexport function clearRouterAttributes(\n  element: Element | null | undefined,\n): void {\n  if (!element) {\n    return;\n  }\n  routerBindings.delete(element);\n}\n\nfunction cloneSlotBindingList(specs: SlotBinding[] | null | undefined): SlotBinding[] {\n  if (!Array.isArray(specs)) {\n    return [];\n  }\n  return specs.map((spec) => {\n    const clone: SlotBinding = {\n      event: spec?.event || \"\",\n      handler: spec?.handler || \"\",\n    };\n    if (Array.isArray(spec?.listen) && spec.listen.length > 0) {\n      clone.listen = [...spec.listen];\n    }\n    if (Array.isArray(spec?.props) && spec.props.length > 0) {\n      clone.props = [...spec.props];\n    }\n    return clone;\n  });\n}\n\nfunction applySlotBindings(slotId: number): void {\n  const element = slotElements.get(slotId);\n  if (!element) {\n    return;\n  }\n\n  const specs = slotBindingSpecs.get(slotId) ?? [];\n  if (!Array.isArray(specs) || specs.length === 0) {\n    handlerBindings.delete(element);\n    return;\n  }\n\n  const map = new Map<string, string>();\n  for (const spec of specs) {\n    if (!spec || typeof spec.event !== \"string\" || typeof spec.handler !== \"string\") {\n      continue;\n    }\n    const eventName = spec.event.trim();\n    const handlerId = spec.handler.trim();\n    if (eventName.length === 0 || handlerId.length === 0) {\n      continue;\n    }\n    map.set(eventName, handlerId);\n  }\n\n  if (map.size === 0) {\n    handlerBindings.delete(element);\n    return;\n  }\n\n  handlerBindings.set(element, map);\n}\n\nexport function primeSlotBindings(table: BindingTable | null | undefined): void {\n  slotBindingSpecs.clear();\n  if (table && typeof table === \"object\") {\n    for (const [key, value] of Object.entries(table)) {\n      const slotId = Number(key);\n      if (Number.isNaN(slotId)) {\n        continue;\n      }\n      slotBindingSpecs.set(slotId, cloneSlotBindingList(value));\n    }\n  }\n  slotElements.forEach((_element, slotId) => {\n    applySlotBindings(slotId);\n  });\n}\n\nexport function registerBindingsForSlot(\n  slotId: number,\n  specs: SlotBinding[] | null | undefined,\n): void {\n  if (!Number.isFinite(slotId)) {\n    return;\n  }\n  if (!Array.isArray(specs)) {\n    slotBindingSpecs.set(slotId, []);\n  } else {\n    slotBindingSpecs.set(slotId, cloneSlotBindingList(specs));\n  }\n  applySlotBindings(slotId);\n}\n\nexport function getRegisteredSlotBindings(\n  slotId: number,\n): ReadonlyArray<SlotBinding> | undefined {\n  const specs = slotBindingSpecs.get(slotId);\n  if (!specs) {\n    return undefined;\n  }\n  return cloneSlotBindingList(specs);\n}\n\nexport function onSlotRegistered(slotId: number, node: Node | null | undefined): void {\n  if (!Number.isFinite(slotId) || !node) {\n    return;\n  }\n  if (node instanceof Element) {\n    slotElements.set(slotId, node);\n    applySlotBindings(slotId);\n    return;\n  }\n  slotElements.delete(slotId);\n}\n\nexport function onSlotUnregistered(slotId: number): void {\n  const element = slotElements.get(slotId);\n  if (element) {\n    handlerBindings.delete(element);\n    clearRouterAttributes(element);\n  }\n  slotElements.delete(slotId);\n}\n\nfunction mergeSelectorLists(\n  primary?: string[] | null,\n  secondary?: string[] | null,\n): string[] | undefined {\n  const merged: string[] = [];\n  const seen = new Set<string>();\n\n  const add = (list?: string[] | null) => {\n    if (!Array.isArray(list)) {\n      return;\n    }\n    for (const value of list) {\n      if (typeof value !== \"string\" || value.length === 0) {\n        continue;\n      }\n      if (seen.has(value)) {\n        continue;\n      }\n      seen.add(value);\n      merged.push(value);\n    }\n  };\n\n  add(primary);\n  add(secondary);\n\n  return merged.length > 0 ? merged : undefined;\n}\n\nfunction isLiveAnchor(\n  element: Element,\n): element is HTMLAnchorElement | SVGAElement {\n  const hasHref =\n    element.hasAttribute(\"href\") || element.hasAttribute(\"xlink:href\");\n  if (!hasHref) {\n    return false;\n  }\n\n  const isHtmlAnchor = element instanceof HTMLAnchorElement;\n  const isSvgAnchor =\n    element.namespaceURI === \"http://www.w3.org/2000/svg\" &&\n    element.tagName.toLowerCase() === \"a\";\n\n  return isHtmlAnchor || isSvgAnchor;\n}\n\n/**\n * Register event handlers from the server\n * @param handlerMap - Map of handler IDs to handler metadata\n */\nexport function registerHandlers(handlerMap: HandlerMap): void {\n  if (!handlerMap) return;\n  for (const [id, meta] of Object.entries(handlerMap)) {\n    const previous = handlers.get(id);\n    if (previous) {\n      for (const eventName of collectEventTypes(previous)) {\n        decrementEventUsage(eventName);\n      }\n    }\n\n    handlers.set(id, meta);\n\n    for (const eventName of collectEventTypes(meta)) {\n      incrementEventUsage(eventName);\n    }\n  }\n}\n\n/**\n * Unregister event handlers\n * @param handlerIds - Array of handler IDs to remove\n */\nexport function unregisterHandlers(handlerIds: string[]): void {\n  if (!Array.isArray(handlerIds)) return;\n  for (const id of handlerIds) {\n    const handler = handlers.get(id);\n    handlers.delete(id);\n\n    if (handler) {\n      for (const eventName of collectEventTypes(handler)) {\n        decrementEventUsage(eventName);\n      }\n    }\n  }\n}\n\n/**\n * Clear all registered handlers\n */\nexport function clearHandlers(): void {\n  handlers.clear();\n  eventUsageCounts.clear();\n  syncEventListeners();\n}\n\n/** @internal - exposed for tests to introspect cached handler bindings */\nexport function getHandlerBindingSnapshot(\n  element: Element | null | undefined,\n): ReadonlyMap<string, string> | undefined {\n  if (!element) {\n    return undefined;\n  }\n  const bindings = handlerBindings.get(element);\n  return bindings ? new Map(bindings) : undefined;\n}\n\nfunction extractPrimaryEventName(attrName: string): string | null {\n  if (!attrName || !attrName.startsWith(DATA_EVENT_ATTR_PREFIX)) {\n    return null;\n  }\n  const suffix = attrName.slice(DATA_EVENT_ATTR_PREFIX.length);\n  if (suffix.length === 0) {\n    return null;\n  }\n  const normalized = suffix.startsWith(\"-\") ? suffix.slice(1) : suffix;\n  if (normalized.length === 0) {\n    return null;\n  }\n  const separatorIndex = normalized.indexOf(\"-\");\n  const eventName =\n    separatorIndex === -1 ? normalized : normalized.slice(0, separatorIndex);\n  return eventName.length > 0 ? eventName : null;\n}\n\nfunction collectAttributeNames(element: Element): string[] {\n  if (!element) return [];\n  if (typeof element.getAttributeNames === \"function\") {\n    return element.getAttributeNames();\n  }\n  const out: string[] = [];\n  if (element.attributes) {\n    for (let i = 0; i < element.attributes.length; i++) {\n      const attr = element.attributes.item(i);\n      if (!attr) continue;\n      out.push(attr.name);\n    }\n  }\n  return out;\n}\n\n/**\n * Refresh handler bindings for a single element based on its data attributes.\n * Removes the inline metadata from the DOM while caching the binding map.\n */\nexport function refreshHandlerBindings(element: Element | null | undefined): void {\n  if (!element) {\n    return;\n  }\n\n  const attributeNames = collectAttributeNames(element);\n  if (attributeNames.length === 0) {\n    if (handlerBindings.has(element)) {\n      handlerBindings.delete(element);\n    }\n    if (routerBindings.has(element)) {\n      routerBindings.delete(element);\n    }\n    return;\n  }\n\n  let bindings: Map<string, string> | null = null;\n  let sawEventAttr = false;\n  for (const name of attributeNames) {\n    if (!name.startsWith(DATA_EVENT_ATTR_PREFIX)) {\n      if (name.startsWith(DATA_ROUTER_ATTR_PREFIX)) {\n        const key = name.slice(DATA_ROUTER_ATTR_PREFIX.length);\n        const value = element.getAttribute(name);\n        element.removeAttribute(name);\n        applyRouterAttribute(element, key, value ?? \"\");\n      }\n      continue;\n    }\n    const remainder = name.slice(DATA_EVENT_ATTR_PREFIX.length);\n    const value = element.getAttribute(name);\n    element.removeAttribute(name);\n    const isMeta = remainder.includes(\"-\");\n    if (isMeta) {\n      continue;\n    }\n    sawEventAttr = true;\n    const eventName = extractPrimaryEventName(name);\n    if (!eventName || !value) {\n      continue;\n    }\n    if (!bindings) {\n      bindings = new Map<string, string>();\n    }\n    bindings.set(eventName, value);\n  }\n\n  if (bindings && bindings.size > 0) {\n    handlerBindings.set(element, bindings);\n  } else if (sawEventAttr || handlerBindings.has(element)) {\n    handlerBindings.delete(element);\n  }\n}\n\n/**\n * Prime handler bindings for every element in a tree, removing inline metadata.\n */\nexport function primeHandlerBindings(root: ParentNode | null | undefined): void {\n  if (!root) return;\n\n  const doc =\n    root instanceof Document\n      ? root\n      : root.ownerDocument ?? (typeof document !== \"undefined\" ? document : null);\n\n  if (!doc) return;\n\n  const startNode: Node | null =\n    root instanceof Document\n      ? doc.documentElement ?? null\n      : (root as unknown as Node);\n\n  if (!startNode) {\n    return;\n  }\n\n  const walker = doc.createTreeWalker(startNode, NodeFilter.SHOW_ELEMENT);\n\n  if (startNode instanceof Element) {\n    refreshHandlerBindings(startNode);\n  }\n\n  let current = walker.nextNode();\n  while (current) {\n    if (current instanceof Element) {\n      refreshHandlerBindings(current);\n    }\n    current = walker.nextNode();\n  }\n}\n\n/**\n * Event sender callback type\n */\nexport type EventSender = (event: {\n  hid: string;\n  payload: EventPayload;\n}) => void;\n\n/**\n * Navigation handler callback type\n */\nexport type NavigationHandler = (\n  path: string,\n  query: string,\n  hash: string,\n) => boolean;\n\nlet sendEventCallback: EventSender | null = null;\nlet navigationHandler: NavigationHandler | null = null;\nlet uploadDelegate: ((event: Event, eventType: string) => void) | null = null;\n\n/**\n * Set up event delegation for the document\n * Only installs listeners for event types that are actually used\n * @param sendEvent - Callback to send events to the server\n */\nexport function setupEventDelegation(sendEvent: EventSender): void {\n  sendEventCallback = sendEvent;\n\n  // Start with common event types\n  ALWAYS_ACTIVE_EVENTS.forEach((eventType) => {\n    installListener(eventType);\n  });\n}\n\n/**\n * Remove all installed event listeners\n */\nexport function teardownEventDelegation(): void {\n  installedListeners.forEach((listener, eventType) => {\n    const useCapture = eventType === \"blur\" || eventType === \"focus\";\n    document.removeEventListener(eventType, listener, useCapture);\n  });\n\n  installedListeners.clear();\n  sendEventCallback = null;\n  uploadDelegate = null;\n}\n\nexport function registerUploadDelegate(\n  delegate: ((event: Event, eventType: string) => void) | null,\n): void {\n  uploadDelegate = delegate;\n}\n\n/**\n * Register a navigation handler for intercepting link clicks\n * @param handler - Callback to handle navigation\n */\nexport function registerNavigationHandler(handler: NavigationHandler): void {\n  navigationHandler = handler;\n\n  // Ensure click listener is installed for navigation interception to work\n  // Even if setupEventDelegation hasn't been called yet\n  if (!installedListeners.has(\"click\")) {\n    installListener(\"click\");\n  }\n}\n\n/**\n * Unregister the navigation handler\n */\nexport function unregisterNavigationHandler(): void {\n  navigationHandler = null;\n\n  // Note: We keep the click listener installed since it's used for other handlers too\n  // syncEventListeners() will clean it up if no click handlers remain\n}\n\n/**\n * Install a listener for a specific event type (if not already installed)\n */\nfunction shouldUseCapture(eventType: string): boolean {\n  return CAPTURE_EVENTS.has(eventType);\n}\n\nfunction installListener(eventType: string): void {\n  if (installedListeners.has(eventType)) return;\n\n  const useCapture = shouldUseCapture(eventType);\n  const listener = (e: Event) => {\n    if (sendEventCallback) {\n      handleEvent(e, eventType, sendEventCallback);\n    }\n  };\n\n  document.addEventListener(eventType, listener, useCapture);\n  installedListeners.set(eventType, listener);\n}\n\n/**\n * Remove a listener for a specific event type\n */\nfunction removeListener(eventType: string): void {\n  const listener = installedListeners.get(eventType);\n  if (!listener) return;\n\n  const useCapture = shouldUseCapture(eventType);\n  document.removeEventListener(eventType, listener, useCapture);\n  installedListeners.delete(eventType);\n}\n\n/**\n * Sync event listeners based on active handler types\n * Call this after registering/unregistering handlers\n */\nexport function syncEventListeners(): void {\n  // Install listeners for new event types\n  eventUsageCounts.forEach((_, eventType) => {\n    installListener(eventType);\n  });\n\n  // Remove listeners for event types that are no longer used\n  installedListeners.forEach((_, eventType) => {\n    if (\n      !eventUsageCounts.has(eventType) &&\n      !ALWAYS_ACTIVE_EVENTS.includes(eventType)\n    ) {\n      removeListener(eventType);\n    }\n  });\n}\n\nfunction handleEvent(\n  e: Event,\n  eventType: string,\n  sendEvent: EventSender,\n): void {\n  const target = e.target;\n  if (!target || !(target instanceof Element)) return;\n\n  if (uploadDelegate) {\n    try {\n      uploadDelegate(e, eventType);\n    } catch (error) {\n      console.error(\"[LiveUI] upload delegate error\", error);\n    }\n  }\n\n  // Find the handler ID and element from the element or its parents FIRST\n  // This ensures Link components with handlers take precedence over navigation interception\n  const handlerInfo = findHandlerInfo(target, eventType);\n\n  // If there's a LiveUI handler, let it run (Link components use this)\n  if (handlerInfo) {\n    const handler = handlers.get(handlerInfo.id);\n    if (handler && handlerSupportsEvent(handler, eventType)) {\n      // Extract event payload based on event type\n      // Pass the handler element so that \"currentTarget\" in selectors refers to the element with the handler\n      const refContext = resolveRefEventContext(handlerInfo.element, eventType);\n      const combinedProps = mergeSelectorLists(handler.props, refContext?.props);\n      const payload = extractEventPayload(\n        e,\n        target,\n        combinedProps,\n        handlerInfo.element,\n        refContext?.element ?? null,\n      );\n\n      const routerMeta = routerBindings.get(handlerInfo.element);\n      if (routerMeta) {\n        if (\n          routerMeta.path !== undefined &&\n          payload[\"currentTarget.dataset.routerPath\"] === undefined\n        ) {\n          payload[\"currentTarget.dataset.routerPath\"] = routerMeta.path;\n        }\n        if (\n          routerMeta.query !== undefined &&\n          payload[\"currentTarget.dataset.routerQuery\"] === undefined\n        ) {\n          payload[\"currentTarget.dataset.routerQuery\"] = routerMeta.query;\n        }\n        if (\n          routerMeta.hash !== undefined &&\n          payload[\"currentTarget.dataset.routerHash\"] === undefined\n        ) {\n          payload[\"currentTarget.dataset.routerHash\"] = routerMeta.hash;\n        }\n        if (\n          routerMeta.replace !== undefined &&\n          payload[\"currentTarget.dataset.routerReplace\"] === undefined\n        ) {\n          payload[\"currentTarget.dataset.routerReplace\"] = routerMeta.replace;\n        }\n      }\n\n      if (refContext) {\n        refContext.notify(payload);\n      }\n\n      // Prevent default for submit events\n      if (eventType === \"submit\") {\n        e.preventDefault();\n      }\n\n      // Prevent default for click events on anchors with LiveUI handlers\n      if (eventType === \"click\") {\n        const anchor = findAnchorElement(target);\n        if (anchor && shouldInterceptNavigation(e as MouseEvent, anchor)) {\n          e.preventDefault();\n        }\n      }\n\n      // Send event to server - this will trigger runtime.InternalHandleNav for Link components\n      sendEvent({\n        hid: handlerInfo.id,\n        payload: payload,\n      });\n      return;\n    }\n  }\n\n  // No h.On handler found, but check for ref handlers\n  const refContext = resolveRefEventContext(target, eventType);\n  if (refContext) {\n    // Extract payload for ref-only events\n    const payload = extractEventPayload(\n      e,\n      target,\n      refContext.props,\n      refContext.element,\n      refContext.element,\n    );\n\n    refContext.notify(payload);\n\n    // Send ref-only event to server\n    sendEvent({\n      hid: refContext.id, // Use ref ID as handler ID for ref-only events\n      payload: payload,\n    });\n    return;\n  }\n\n  // No LiveUI handler found, try navigation interception for click events\n  // This handles plain <a> tags without LiveUI handlers\n  if (eventType === \"click\" && navigationHandler && e instanceof MouseEvent) {\n    const anchor = findAnchorElement(target);\n    if (anchor && shouldInterceptNavigation(e as MouseEvent, anchor)) {\n      const href =\n        anchor.getAttribute(\"href\") ?? anchor.getAttribute(\"xlink:href\");\n      if (href) {\n        try {\n          const url = new URL(href, window.location.href);\n          const path = url.pathname;\n          const query = url.search.substring(1); // Remove leading '?'\n          const hash = url.hash.startsWith(\"#\")\n            ? url.hash.substring(1)\n            : url.hash;\n\n          // Call navigation handler and prevent default if it returns true\n          if (navigationHandler(path, query, hash)) {\n            e.preventDefault();\n            e.stopPropagation();\n            return;\n          }\n        } catch (err) {\n          // Invalid URL, let browser handle it\n        }\n      }\n    }\n  }\n}\n\nfunction findHandlerInfo(\n  element: Element,\n  eventType: string,\n): { id: string; element: Element } | null {\n  let current: Element | null = element;\n\n  while (current && current !== document.documentElement) {\n    let binding = handlerBindings.get(current);\n\n    if (!binding) {\n      const attributeNames = collectAttributeNames(current);\n      if (attributeNames.some((name) => name.startsWith(DATA_EVENT_ATTR_PREFIX))) {\n        refreshHandlerBindings(current);\n        binding = handlerBindings.get(current);\n      }\n    }\n\n    if (binding && binding.size > 0) {\n      const directId = binding.get(eventType);\n      if (directId) {\n        const meta = handlers.get(directId);\n        if (!meta || handlerSupportsEvent(meta, eventType)) {\n          return { id: directId, element: current };\n        }\n      }\n\n      for (const [registeredEvent, handlerId] of binding.entries()) {\n        if (registeredEvent === eventType) {\n          continue;\n        }\n        const meta = handlers.get(handlerId);\n        if (meta && handlerSupportsEvent(meta, eventType)) {\n          return { id: handlerId, element: current };\n        }\n      }\n    }\n\n    current = current.parentElement;\n  }\n\n  return null;\n}\n\nfunction extractEventPayload(\n  e: Event,\n  target: Element,\n  props?: string[] | null,\n  handlerElement?: Element,\n  refElement?: Element | null,\n): EventPayload {\n  const payload: EventPayload = {\n    type: e.type,\n  };\n\n  // Add value for input elements\n  if (\n    target instanceof HTMLInputElement ||\n    target instanceof HTMLTextAreaElement ||\n    target instanceof HTMLSelectElement\n  ) {\n    payload.value = target.value;\n    if (target instanceof HTMLInputElement) {\n      if (target.type === \"checkbox\" || target.type === \"radio\") {\n        payload.checked = target.checked;\n      }\n    }\n  }\n\n  // Add key information for keyboard events\n  if (e instanceof KeyboardEvent) {\n    payload.key = e.key;\n    payload.keyCode = e.keyCode;\n    payload.altKey = e.altKey;\n    payload.ctrlKey = e.ctrlKey;\n    payload.metaKey = e.metaKey;\n    payload.shiftKey = e.shiftKey;\n  }\n\n  // Add mouse information for mouse events\n  if (e instanceof MouseEvent) {\n    payload.clientX = e.clientX;\n    payload.clientY = e.clientY;\n  }\n\n  if (Array.isArray(props)) {\n    const domValues = domGetSync(props, {\n      event: e,\n      target,\n      handlerElement: handlerElement ?? null,\n      refElement: refElement ?? null,\n    });\n    if (domValues) {\n      for (const [key, value] of Object.entries(domValues)) {\n        payload[key] = value;\n      }\n    }\n  }\n\n  return payload;\n}\n\n/**\n * Walk up the DOM tree to find an anchor element\n */\nfunction findAnchorElement(element: Element): HTMLAnchorElement | SVGAElement | null {\n  let current: Element | null = element;\n\n  while (current && current !== document.documentElement) {\n    if (isLiveAnchor(current)) {\n      return current;\n    }\n    current = current.parentElement;\n  }\n\n  return null;\n}\n\n/**\n * Determine if we should intercept this navigation\n * Returns true if all conditions are met for LiveUI to handle the navigation\n */\nfunction shouldInterceptNavigation(\n  e: MouseEvent,\n  anchor: HTMLAnchorElement | SVGAElement,\n): boolean {\n  // Only intercept primary mouse button (left click)\n  if (e.button !== 0) {\n    return false;\n  }\n\n  // Don't intercept if modifier keys are pressed (allow open in new tab/window)\n  if (e.ctrlKey || e.metaKey || e.altKey || e.shiftKey) {\n    return false;\n  }\n\n  if (!isLiveAnchor(anchor)) {\n    return false;\n  }\n\n  const href =\n    anchor.getAttribute(\"href\") ?? anchor.getAttribute(\"xlink:href\") ?? undefined;\n  if (!href) {\n    return false;\n  }\n\n  // Don't intercept if target is specified (e.g., _blank, _top)\n  const target = anchor.getAttribute(\"target\");\n  if (target && target !== \"_self\") {\n    return false;\n  }\n\n  // Check if it's a same-origin URL\n  try {\n    const url = new URL(href, window.location.href);\n\n    // Don't intercept different origin\n    if (url.origin !== window.location.origin) {\n      return false;\n    }\n\n    // Don't intercept hash-only links (same page navigation)\n    if (\n      url.pathname === window.location.pathname &&\n      url.search === window.location.search &&\n      url.hash\n    ) {\n      return false;\n    }\n\n    return true;\n  } catch (err) {\n    // Invalid URL, don't intercept\n    return false;\n  }\n}\n\nfunction incrementEventUsage(eventType: string): void {\n  const current = eventUsageCounts.get(eventType) ?? 0;\n  eventUsageCounts.set(eventType, current + 1);\n}\n\nfunction decrementEventUsage(eventType: string): void {\n  const current = eventUsageCounts.get(eventType);\n  if (!current) {\n    return;\n  }\n\n  if (current <= 1) {\n    eventUsageCounts.delete(eventType);\n  } else {\n    eventUsageCounts.set(eventType, current - 1);\n  }\n}\n\nfunction collectEventTypes(meta?: HandlerMeta | null): string[] {\n  if (!meta) {\n    return [];\n  }\n  const seen = new Set<string>();\n  const order: string[] = [];\n\n  if (meta.event) {\n    seen.add(meta.event);\n    order.push(meta.event);\n  }\n\n  if (Array.isArray(meta.listen)) {\n    for (const evt of meta.listen) {\n      if (typeof evt !== \"string\" || evt.length === 0) {\n        continue;\n      }\n      if (!seen.has(evt)) {\n        seen.add(evt);\n        order.push(evt);\n      }\n    }\n  }\n\n  return order;\n}\n\nfunction handlerSupportsEvent(meta: HandlerMeta, eventType: string): boolean {\n  if (!meta) {\n    return false;\n  }\n  if (meta.event === eventType) {\n    return true;\n  }\n  if (Array.isArray(meta.listen)) {\n    return meta.listen.includes(eventType);\n  }\n  return false;\n}\n", "export interface ComponentRange {\n  container: ParentNode;\n  startIndex: number;\n  endIndex: number;\n}\n\nconst rangeIndex = new Map<string, ComponentRange>();\n\nexport function resetComponentRanges(): void {\n  rangeIndex.clear();\n}\n\nexport function registerComponentRange(\n  id: string,\n  range: ComponentRange | null | undefined,\n): ComponentRange | null {\n  if (!id || !range || !range.container) return null;\n  const { container } = range;\n  let { startIndex, endIndex } = range;\n  if (!Number.isFinite(startIndex) || !Number.isFinite(endIndex)) {\n    return null;\n  }\n  const normalizedStart = Math.max(0, Math.trunc(startIndex));\n  let normalizedEnd = Math.trunc(endIndex);\n  if (!Number.isFinite(normalizedEnd)) {\n    return null;\n  }\n  if (normalizedEnd < normalizedStart) {\n    normalizedEnd = normalizedStart - 1;\n  }\n  const normalized: ComponentRange = {\n    container,\n    startIndex: normalizedStart,\n    endIndex: normalizedEnd,\n  };\n  rangeIndex.set(id, normalized);\n  return normalized;\n}\n\nexport function registerComponentRanges(\n  descriptors: Record<string, ComponentRange> | Map<string, ComponentRange> | undefined | null,\n): void {\n  if (!descriptors) return;\n  if (descriptors instanceof Map) {\n    for (const [id, range] of Array.from(descriptors.entries())) {\n      const normalized = registerComponentRange(id, range);\n      if (normalized) {\n        descriptors.set(id, normalized);\n      } else {\n        descriptors.delete(id);\n      }\n    }\n    return;\n  }\n  for (const [id, range] of Object.entries(descriptors)) {\n    const normalized = registerComponentRange(id, range);\n    if (normalized) {\n      descriptors[id] = normalized;\n    } else {\n      delete descriptors[id];\n    }\n  }\n}\n\nexport function getComponentRange(id: string): ComponentRange | null {\n  if (!id) return null;\n  return rangeIndex.get(id) ?? null;\n}\n", "import type {\n  SlotPathDescriptor,\n  ListPathDescriptor,\n  ComponentPathDescriptor,\n} from './types';\nimport {\n  ComponentRange,\n  getComponentRange,\n  registerComponentRanges,\n} from './componentRanges';\n\nfunction debugLog(...args: any[]): void {\n  if (typeof console === 'undefined') {\n    return;\n  }\n  console.log('[liveui][manifest]', ...args);\n}\n\nfunction debugWarn(...args: any[]): void {\n  if (typeof console === 'undefined') {\n    return;\n  }\n  console.warn('[liveui][manifest]', ...args);\n}\n\nfunction ensureArray(path?: number[] | null): number[] {\n  if (!Array.isArray(path)) {\n    return [];\n  }\n  return path.filter((index) => Number.isInteger(index));\n}\n\nfunction getRootContainer(root?: ParentNode | null): ParentNode {\n  if (root && root instanceof Document) {\n    return root.body ?? root;\n  }\n  if (root && 'childNodes' in root) {\n    return root;\n  }\n  if (typeof document !== 'undefined') {\n    return document.body ?? document;\n  }\n  throw new Error('liveui: unable to resolve root container for manifest resolution');\n}\n\nfunction clampIndex(container: ParentNode, index: number): number {\n  const maxIndex = container.childNodes.length - 1;\n  if (maxIndex < 0) {\n    return 0;\n  }\n  if (index < 0) {\n    return 0;\n  }\n  if (index > maxIndex) {\n    return maxIndex;\n  }\n  return index;\n}\n\nfunction computeBaseRange(root: ParentNode): ComponentRange {\n  const count = root.childNodes.length;\n  return {\n    container: root,\n    startIndex: 0,\n    endIndex: count > 0 ? count - 1 : -1,\n  };\n}\n\nfunction resolveContainerFromParent(\n  parentRange: ComponentRange,\n  parentPath: number[] | undefined,\n): ParentNode | null {\n  if (!parentRange || parentRange.endIndex < parentRange.startIndex) {\n    return null;\n  }\n  const steps = ensureArray(parentPath);\n  if (steps.length <= 1) {\n    return parentRange.container;\n  }\n  const containerSteps = steps.slice(0, -1);\n  let current: ParentNode = parentRange.container;\n  let node: Node | null = null;\n  for (let i = 0; i < containerSteps.length; i++) {\n    const step = containerSteps[i];\n    const targetIndex = i === 0 ? parentRange.startIndex + step : step;\n    node = current.childNodes.item(targetIndex) ?? null;\n    if (!(node instanceof Element || node instanceof DocumentFragment)) {\n      return null;\n    }\n    current = node;\n  }\n  return current;\n}\n\nfunction deriveRangeFromDescriptor(\n  descriptor: ComponentPathDescriptor,\n  parentRange: ComponentRange,\n): ComponentRange | null {\n  if (!parentRange || parentRange.endIndex < parentRange.startIndex) {\n    return null;\n  }\n  const anchorPath = ensureArray(descriptor.parentPath);\n  const anchor = resolveNodeInRange(parentRange, anchorPath);\n  if (!anchor) {\n    return null;\n  }\n  const container =\n    (anchor.parentNode as ParentNode | null) ?? parentRange.container;\n  const startIndex = getNodeIndex(container, anchor);\n  if (startIndex < 0) {\n    return null;\n  }\n  return {\n    container,\n    startIndex,\n    endIndex: startIndex,\n  };\n}\n\nfunction getNodeIndex(container: ParentNode, target: Node | null): number {\n  if (!container || !target) {\n    return -1;\n  }\n  const nodes = container.childNodes;\n  for (let i = 0; i < nodes.length; i++) {\n    if (nodes.item(i) === target) {\n      return i;\n    }\n  }\n  return -1;\n}\n\nexport function computeComponentRanges(\n  descriptors: ComponentPathDescriptor[] | undefined,\n  options?: {\n    root?: ParentNode | null;\n    baseId?: string | null;\n    baseRange?: ComponentRange | null;\n  },\n): Map<string, ComponentRange> {\n  const ranges = new Map<string, ComponentRange>();\n  if (!Array.isArray(descriptors) || descriptors.length === 0) {\n    return ranges;\n  }\n  const rootContainer = getRootContainer(options?.root ?? null);\n  const defaultRange = options?.baseRange ?? computeBaseRange(rootContainer);\n  const baseId = options?.baseId ?? '';\n  if (options?.baseRange && baseId) {\n    ranges.set(baseId, options.baseRange);\n  }\n  const pending = new Map<string, ComponentPathDescriptor>();\n  for (const descriptor of descriptors) {\n    if (!descriptor || typeof descriptor.componentId !== 'string') continue;\n    pending.set(descriptor.componentId, descriptor);\n  }\n  let progressed = true;\n  while (pending.size > 0 && progressed) {\n    progressed = false;\n    for (const [id, descriptor] of Array.from(pending.entries())) {\n      const parentId = descriptor.parentId ?? '';\n      let parentRange: ComponentRange | null = null;\n      if (parentId) {\n        parentRange = ranges.get(parentId) ?? getComponentRange(parentId);\n      } else {\n        parentRange = baseId ? ranges.get(baseId) ?? null : null;\n        if (!parentRange) {\n          parentRange = defaultRange;\n        }\n      }\n      if (!parentRange) {\n        continue;\n      }\n      const derived = deriveRangeFromDescriptor(descriptor, parentRange);\n      if (!derived) {\n        pending.delete(id);\n        continue;\n      }\n      ranges.set(id, derived);\n      pending.delete(id);\n      progressed = true;\n    }\n  }\n  return ranges;\n}\n\nexport function resolveComponentRanges(\n  descriptors: ComponentPathDescriptor[] | undefined,\n  options?: {\n    root?: ParentNode | null;\n    baseId?: string | null;\n    baseRange?: ComponentRange | null;\n  },\n): void {\n  const ranges = computeComponentRanges(descriptors, options);\n  registerComponentRanges(ranges);\n}\n\nfunction resolveNodeInRange(\n  range: ComponentRange | null,\n  path: number[] | undefined,\n): Node | null {\n  if (!range || range.endIndex < range.startIndex) return null;\n  const steps = ensureArray(path);\n  const rootIndex = clampIndex(range.container, range.startIndex);\n  let current: Node | null = range.container.childNodes.item(rootIndex) ?? null;\n  if (!current) {\n    return null;\n  }\n  if (steps.length === 0) {\n    return current;\n  }\n  for (const step of steps) {\n    if (!(current instanceof Element || current instanceof DocumentFragment)) {\n      return null;\n    }\n    const childIndex = clampIndex(current, step);\n    current = current.childNodes.item(childIndex) ?? null;\n    if (!current) {\n      return null;\n    }\n  }\n  return current;\n}\n\nexport function resolveSlotAnchors(\n  descriptors: SlotPathDescriptor[] | undefined,\n  overrides?: Map<string, ComponentRange>,\n): Map<number, Node> {\n  const anchors = new Map<number, Node>();\n  if (!Array.isArray(descriptors)) {\n    return anchors;\n  }\n  for (const descriptor of descriptors) {\n    if (!descriptor) continue;\n    const slotId = Number(descriptor.slot);\n    if (!Number.isInteger(slotId) || slotId < 0 || anchors.has(slotId)) {\n      continue;\n    }\n    const range =\n      overrides?.get(descriptor.componentId) ??\n      getComponentRange(descriptor.componentId);\n    if (!range) {\n      debugWarn(\n        'slot range missing',\n        descriptor.componentId,\n        descriptor,\n        Array.from(overrides?.keys() ?? []),\n      );\n      continue;\n    }\n    const anchor = resolveNodeInRange(range, descriptor.elementPath);\n    if (!anchor) {\n      debugWarn('slot anchor not found', descriptor, range);\n      continue;\n    }\n    let target: Node | null = anchor;\n    const textIndex = Number(descriptor.textChildIndex);\n    if (Number.isInteger(textIndex) && textIndex >= 0) {\n      if (anchor instanceof Text) {\n        target = anchor;\n      } else if (anchor instanceof Element || anchor instanceof DocumentFragment) {\n        let textNode = anchor.childNodes.item(textIndex) ?? null;\n        if (!textNode && typeof document !== 'undefined') {\n          textNode = document.createTextNode('');\n          const before =\n            textIndex < anchor.childNodes.length\n              ? anchor.childNodes.item(textIndex)\n              : null;\n          anchor.insertBefore(textNode, before);\n        }\n        target = textNode;\n      } else {\n        target = null;\n      }\n    }\n    if (!target) {\n      debugWarn('slot target missing', descriptor, {\n        anchorName:\n          anchor instanceof Element ? anchor.tagName : anchor?.nodeName,\n      });\n      continue;\n    }\n    debugLog('slot resolved', slotId, descriptor.componentId);\n    anchors.set(slotId, target);\n  }\n  return anchors;\n}\n\nexport function resolveListContainers(\n  descriptors: ListPathDescriptor[] | undefined,\n  overrides?: Map<string, ComponentRange>,\n): Map<number, Element> {\n  const lists = new Map<number, Element>();\n  if (!Array.isArray(descriptors)) {\n    return lists;\n  }\n  for (const descriptor of descriptors) {\n    if (!descriptor) continue;\n    const slotId = Number(descriptor.slot);\n    if (!Number.isInteger(slotId) || slotId < 0 || lists.has(slotId)) {\n      continue;\n    }\n    const range =\n      overrides?.get(descriptor.componentId) ??\n      getComponentRange(descriptor.componentId);\n    if (!range) {\n      debugWarn(\n        'list range missing',\n        descriptor.componentId,\n        descriptor,\n        Array.from(overrides?.keys() ?? []),\n      );\n      continue;\n    }\n    const node = resolveNodeInRange(range, descriptor.elementPath);\n    if (!(node instanceof Element)) {\n      debugWarn('list container not found', descriptor, range);\n      continue;\n    }\n    debugLog('list container resolved', slotId, descriptor.componentId);\n    lists.set(slotId, node);\n  }\n  return lists;\n}\n\nexport function applyComponentRanges(\n  descriptors: ComponentPathDescriptor[] | undefined,\n  options?: {\n    root?: ParentNode | null;\n    baseId?: string | null;\n    baseRange?: ComponentRange | null;\n  },\n): Map<string, ComponentRange> {\n  const ranges = computeComponentRanges(descriptors, options);\n  registerComponentRanges(ranges);\n  return ranges;\n}\n\nexport function resolveNodeInComponent(\n  componentId: string,\n  path: number[] | undefined,\n  overrides?: Map<string, ComponentRange>,\n): Node | null {\n  if (typeof componentId !== \"string\" || componentId.length === 0) {\n    return null;\n  }\n  const range = overrides?.get(componentId) ?? getComponentRange(componentId);\n  if (!range) {\n    return null;\n  }\n  return resolveNodeInRange(range, path);\n}\n", "/**\n * Advanced Patcher with Maximum Optimizations\n *\n * Applies diff operations to the DOM with:\n * - Dirty checking (skip unchanged updates)\n * - Smart attribute diffing\n * - Batched DOM operations (prevent layout thrashing)\n * - DocumentFragment pooling\n * - Keyed list optimization\n * - Morphdom-style reconciliation\n * - Patch memoization\n * - Virtual scrolling support\n */\n\nimport * as dom from \"./dom-index\";\nimport {\n  applyRouterAttribute,\n  DATA_ROUTER_ATTR_PREFIX,\n  getRegisteredSlotBindings,\n  primeHandlerBindings,\n  refreshHandlerBindings,\n  registerBindingsForSlot,\n} from \"./events\";\nimport { applyComponentRanges, resolveListContainers, resolveSlotAnchors } from \"./manifest\";\nimport { bindRefsInTree, unbindRefsInTree, updateRefBinding } from \"./refs\";\nimport type { DiffOp, ListChildOp, ListRow, SlotBinding } from \"./types\";\n\n// ============================================================================\n// Configuration\n// ============================================================================\n\ninterface PatcherConfig {\n    enableDirtyChecking: boolean;\n    enableBatching: boolean;\n    enableFragmentPooling: boolean;\n    enableMemoization: boolean;\n    enableVirtualScrolling: boolean;\n    virtualScrollThreshold: number;\n    memoizationCacheSize: number;\n}\n\nconst config: PatcherConfig = {\n    enableDirtyChecking: true,\n    enableBatching: true,\n    enableFragmentPooling: true,\n    enableMemoization: true,\n    enableVirtualScrolling: true,\n    virtualScrollThreshold: 100, // Start virtual scrolling after 100 items\n    memoizationCacheSize: 1000,\n};\n\nconst DATA_EVENT_ATTR_PREFIX = 'data-on';\n\n// ============================================================================\n// Fragment Pooling (for future use)\n// ============================================================================\n\n// class FragmentPool {\n//   private pool: DocumentFragment[] = [];\n//   private maxSize: number = 10;\n//\n//   acquire(): DocumentFragment {\n//     return this.pool.pop() || document.createDocumentFragment();\n//   }\n//\n//   release(fragment: DocumentFragment): void {\n//     if (this.pool.length < this.maxSize) {\n//       // Clear fragment before reusing\n//       while (fragment.firstChild) {\n//         fragment.removeChild(fragment.firstChild);\n//       }\n//       this.pool.push(fragment);\n//     }\n//   }\n// }\n//\n// const fragmentPool = new FragmentPool();\n\n// ============================================================================\n// Template Caching\n// ============================================================================\n\nconst templateCache = document.createElement('template');\nconst htmlCache = new Map<string, DocumentFragment>();\n\nfunction createFragment(html: string): DocumentFragment {\n    if (config.enableFragmentPooling && htmlCache.has(html)) {\n        // Clone cached fragment for reuse\n        return htmlCache.get(html)!.cloneNode(true) as DocumentFragment;\n    }\n\n    templateCache.innerHTML = html;\n    const fragment = templateCache.content.cloneNode(true) as DocumentFragment;\n\n    // Cache popular fragments (limit size)\n    if (config.enableFragmentPooling && htmlCache.size < 50) {\n        htmlCache.set(html, fragment.cloneNode(true) as DocumentFragment);\n    }\n\n    return fragment;\n}\n\n// ============================================================================\n// Patch Memoization\n// ============================================================================\n\nclass PatchMemoizer {\n    private cache = new Map<string, any>();\n    private maxSize: number;\n\n    constructor(maxSize: number) {\n        this.maxSize = maxSize;\n    }\n\n    key(op: string, slotIndex: number, value: any): string {\n        return `${op}:${slotIndex}:${JSON.stringify(value)}`;\n    }\n\n    has(key: string): boolean {\n        return this.cache.has(key);\n    }\n\n    get(key: string): any {\n        return this.cache.get(key);\n    }\n\n    set(key: string, value: any): void {\n        if (this.cache.size >= this.maxSize) {\n            // Simple LRU: delete first entry\n            const firstKey = this.cache.keys().next().value;\n            if (firstKey !== undefined) {\n                this.cache.delete(firstKey);\n            }\n        }\n        this.cache.set(key, value);\n    }\n\n    clear(): void {\n        this.cache.clear();\n    }\n}\n\nconst memoizer = new PatchMemoizer(config.memoizationCacheSize);\n\n// ============================================================================\n// Batched DOM Operations\n// ============================================================================\n\ninterface DOMBatch {\n    reads: Array<() => any>;\n    writes: Array<() => void>;\n}\n\nclass DOMBatcher {\n    private batch: DOMBatch = {reads: [], writes: []};\n    private scheduled = false;\n\n    scheduleRead(fn: () => any): void {\n        this.batch.reads.push(fn);\n        this.schedule();\n    }\n\n    scheduleWrite(fn: () => void): void {\n        this.batch.writes.push(fn);\n        this.schedule();\n    }\n\n    private schedule(): void {\n        if (this.scheduled) return;\n        this.scheduled = true;\n\n        requestAnimationFrame(() => {\n            this.flush();\n        });\n    }\n\n    flush(): void {\n        // Execute all reads first (prevent layout thrashing)\n        this.batch.reads.forEach(fn => fn());\n\n        // Then execute all writes\n        this.batch.writes.forEach(fn => fn());\n\n        // Reset\n        this.batch = {reads: [], writes: []};\n        this.scheduled = false;\n    }\n\n    immediate(): void {\n        if (this.scheduled) {\n            this.flush();\n        }\n    }\n}\n\nconst batcher = new DOMBatcher();\n\n// ============================================================================\n// Virtual Scrolling Support\n// ============================================================================\n\ninterface VirtualScrollState {\n    container: Element;\n    totalItems: number;\n    visibleRange: { start: number; end: number };\n    itemHeight: number;\n    observer?: IntersectionObserver;\n}\n\nconst virtualScrollStates = new Map<number, VirtualScrollState>();\n\nfunction initVirtualScroll(slotIndex: number, container: Element): void {\n    if (!config.enableVirtualScrolling) return;\n\n    const state: VirtualScrollState = {\n        container,\n        totalItems: 0,\n        visibleRange: {start: 0, end: 50},\n        itemHeight: 0,\n    };\n\n    // Set up intersection observer for visibility tracking\n    state.observer = new IntersectionObserver(\n        (entries) => {\n            entries.forEach((entry) => {\n                if (entry.isIntersecting) {\n                    // Item became visible\n                    const target = entry.target;\n                    if (target instanceof HTMLElement || target instanceof SVGElement) {\n                        target.style.display = '';\n                    }\n                }\n            });\n        },\n        {root: container, threshold: 0.1}\n    );\n\n    virtualScrollStates.set(slotIndex, state);\n}\n\nfunction shouldVirtualize(_slotIndex: number, itemCount: number): boolean {\n    return config.enableVirtualScrolling && itemCount > config.virtualScrollThreshold;\n}\n\n// ============================================================================\n// Dirty Checking\n// ============================================================================\n\nfunction ensureTextNode(node: Node | null, slotIndex: number): Node {\n    if (!node) {\n        throw new Error(`liveui: slot ${slotIndex} not registered`);\n    }\n    return node;\n}\n\nfunction applySetText(slotIndex: number, text: string): void {\n    const node = ensureTextNode(dom.getSlot(slotIndex), slotIndex);\n\n    // Dirty checking: skip if unchanged\n    if (config.enableDirtyChecking && node.textContent === text) {\n        return;\n    }\n\n    if (config.enableBatching) {\n        batcher.scheduleWrite(() => {\n            node.textContent = text;\n        });\n    } else {\n        node.textContent = text;\n    }\n}\n\n// ============================================================================\n// Smart Attribute Diffing\n// ============================================================================\n\nfunction applySetAttrs(\n    slotIndex: number,\n    upsert: Record<string, string>,\n    remove: string[]\n): void {\n    const node = dom.getSlot(slotIndex);\n    if (!(node instanceof Element)) {\n        throw new Error(`liveui: slot ${slotIndex} is not an element`);\n    }\n\n    const existingBindings = getRegisteredSlotBindings(slotIndex) ?? [];\n    const bindingMap = new Map<string, { handler?: string; listen?: string[]; props?: string[] }>();\n    for (const spec of existingBindings) {\n        if (!spec || typeof spec.event !== 'string') continue;\n        bindingMap.set(spec.event, {\n            handler: spec.handler,\n            listen: spec.listen ? [...spec.listen] : undefined,\n            props: spec.props ? [...spec.props] : undefined,\n        });\n    }\n\n    const parseTokens = (value: string | null | undefined): string[] | undefined => {\n        if (typeof value !== 'string') {\n            return undefined;\n        }\n        const tokens = value\n            .split(/\\s+/)\n            .map((token) => token.trim())\n            .filter((token) => token.length > 0);\n        return tokens.length > 0 ? tokens : undefined;\n    };\n\n    let bindingChanged = false;\n\n    if (upsert) {\n        for (const key of Object.keys(upsert)) {\n            if (typeof key === 'string' && key.startsWith(DATA_ROUTER_ATTR_PREFIX)) {\n                const routerKey = key.slice(DATA_ROUTER_ATTR_PREFIX.length);\n                applyRouterAttribute(node, routerKey, upsert[key]);\n                delete upsert[key];\n                continue;\n            }\n            if (typeof key !== 'string' || !key.startsWith(DATA_EVENT_ATTR_PREFIX)) {\n                continue;\n            }\n            bindingChanged = true;\n            const value = upsert[key];\n            delete upsert[key];\n\n            let remainder = key.slice(DATA_EVENT_ATTR_PREFIX.length);\n            if (remainder.startsWith('-')) {\n                remainder = remainder.slice(1);\n            }\n            if (remainder.length === 0) {\n                continue;\n            }\n            let metaType = '';\n            const dashIndex = remainder.indexOf('-');\n            if (dashIndex !== -1) {\n                metaType = remainder.slice(dashIndex + 1);\n                remainder = remainder.slice(0, dashIndex);\n            }\n            const eventName = remainder.trim();\n            if (eventName.length === 0) {\n                continue;\n            }\n            const entry = bindingMap.get(eventName) ?? {};\n            if (metaType === 'listen') {\n                entry.listen = parseTokens(value);\n            } else if (metaType === 'props') {\n                entry.props = parseTokens(value);\n            } else {\n                entry.handler = typeof value === 'string' ? value : value != null ? String(value) : '';\n            }\n            bindingMap.set(eventName, entry);\n        }\n    }\n\n    if (Array.isArray(remove) && remove.length > 0) {\n        for (let i = remove.length - 1; i >= 0; i--) {\n            const attrName = remove[i];\n            if (typeof attrName === 'string' && attrName.startsWith(DATA_ROUTER_ATTR_PREFIX)) {\n                const routerKey = attrName.slice(DATA_ROUTER_ATTR_PREFIX.length);\n                applyRouterAttribute(node, routerKey, undefined);\n                remove.splice(i, 1);\n                continue;\n            }\n            if (typeof attrName !== 'string' || !attrName.startsWith(DATA_EVENT_ATTR_PREFIX)) {\n                continue;\n            }\n            bindingChanged = true;\n            remove.splice(i, 1);\n\n            let remainder = attrName.slice(DATA_EVENT_ATTR_PREFIX.length);\n            if (remainder.startsWith('-')) {\n                remainder = remainder.slice(1);\n            }\n            if (remainder.length === 0) {\n                continue;\n            }\n            const dashIndex = remainder.indexOf('-');\n            if (dashIndex !== -1) {\n                remainder = remainder.slice(0, dashIndex);\n            }\n            const eventName = remainder.trim();\n            if (eventName.length === 0) {\n                continue;\n            }\n            bindingMap.delete(eventName);\n        }\n    }\n\n    if (bindingChanged) {\n        const specs: SlotBinding[] = [];\n        bindingMap.forEach((info, eventName) => {\n            const handlerId = info.handler?.trim();\n            if (!handlerId) {\n                return;\n            }\n            const spec: SlotBinding = { event: eventName, handler: handlerId };\n            if (info.listen && info.listen.length > 0) {\n                spec.listen = [...info.listen];\n            }\n            if (info.props && info.props.length > 0) {\n                spec.props = [...info.props];\n            }\n            specs.push(spec);\n        });\n        registerBindingsForSlot(slotIndex, specs);\n    }\n\n    const previousRef = node.getAttribute('data-live-ref');\n    const applyAttrs = () => {\n        if (upsert) {\n            for (const [k, v] of Object.entries(upsert)) {\n                if (v === undefined || v === null) continue;\n\n                if (config.enableDirtyChecking && node.getAttribute(k) === String(v)) {\n                    continue;\n                }\n\n                node.setAttribute(k, String(v));\n            }\n        }\n\n        if (remove) {\n            for (const key of remove) {\n                if (node.hasAttribute(key)) {\n                    node.removeAttribute(key);\n                }\n            }\n        }\n\n        const nextRef = node.getAttribute('data-live-ref');\n        updateRefBinding(node, previousRef, nextRef);\n\n        refreshHandlerBindings(node);\n    };\n\n    if (config.enableBatching) {\n        batcher.scheduleWrite(applyAttrs);\n    } else {\n        applyAttrs();\n    }\n}\n// ============================================================================\n// Morphdom-style DOM Reconciliation (exported for advanced use cases)\n// ============================================================================\n\nexport function morphElement(fromEl: Element, toEl: Element): void {\n    // Sync attributes\n    const fromAttrs = fromEl.attributes;\n    const toAttrs = toEl.attributes;\n\n    // Remove old attributes\n    for (let i = fromAttrs.length - 1; i >= 0; i--) {\n        const attr = fromAttrs[i];\n        if (!toEl.hasAttribute(attr.name)) {\n            fromEl.removeAttribute(attr.name);\n        }\n    }\n\n    // Add/update new attributes\n    for (let i = 0; i < toAttrs.length; i++) {\n        const attr = toAttrs[i];\n        if (fromEl.getAttribute(attr.name) !== attr.value) {\n            fromEl.setAttribute(attr.name, attr.value);\n        }\n    }\n\n    // Sync text content for text nodes\n    if (fromEl.childNodes.length === 1 && fromEl.firstChild?.nodeType === Node.TEXT_NODE) {\n        if (toEl.childNodes.length === 1 && toEl.firstChild?.nodeType === Node.TEXT_NODE) {\n            if (fromEl.firstChild.textContent !== toEl.firstChild.textContent) {\n                fromEl.firstChild.textContent = toEl.firstChild.textContent;\n            }\n        }\n    }\n}\n\n// ============================================================================\n// Slot Registration (optimized)\n// ============================================================================\n\nfunction registerRowSlots(\n    row: ListRow | undefined,\n    fragment: DocumentFragment | Element,\n    overrides?: Map<string, import('./componentRanges').ComponentRange>,\n): void {\n    if (!row) {\n        return;\n    }\n\n    const requestedSlots = Array.isArray(row.slots)\n        ? row.slots.filter((value) => Number.isInteger(value) && value >= 0)\n        : [];\n    const pendingSlots = new Set<number>(requestedSlots);\n\n    const slotAnchors = resolveSlotAnchors(row.slotPaths, overrides);\n    if (slotAnchors.size > 0) {\n        if (pendingSlots.size > 0) {\n            for (const slotId of Array.from(pendingSlots)) {\n                const node = slotAnchors.get(slotId);\n                if (node) {\n                    dom.registerSlot(slotId, node);\n                    pendingSlots.delete(slotId);\n                }\n            }\n        } else {\n            for (const [slotId, node] of slotAnchors.entries()) {\n                dom.registerSlot(slotId, node);\n            }\n        }\n    }\n\n    const listAnchors = resolveListContainers(row.listPaths, overrides);\n    for (const [slotId, element] of listAnchors.entries()) {\n        dom.registerList(slotId, element);\n    }\n\n    // If manifests failed to resolve anchors, log warnings in debug mode\n    if (pendingSlots.size > 0 && requestedSlots.length > 0) {\n        pendingSlots.forEach((idx) => {\n            console.warn(`liveui: slot ${idx} not resolved in inserted row`);\n        });\n    }\n}\n\n// ============================================================================\n// Keyed List Operations with Advanced Optimizations\n// ============================================================================\n\nfunction applyList(slotIndex: number, childOps: ListChildOp[]): void {\n    if (!Array.isArray(childOps) || childOps.length === 0) return;\n\n    const record = dom.ensureList(slotIndex);\n    const container = record.container;\n\n    // Batch DOM reads\n    const children = config.enableBatching ? Array.from(container.children) : null;\n\n    // Track keys for virtual scrolling\n    let itemCount = record.rows.size;\n\n    for (const op of childOps) {\n        if (!op || !op.length) continue;\n        const kind = op[0];\n\n        switch (kind) {\n            case 'del': {\n                const key = op[1];\n                const row = dom.getRow(slotIndex, key);\n\n                if (row && row.parentNode === container) {\n                    const removeNode = () => {\n                        unbindRefsInTree(row);\n                        container.removeChild(row);\n                    };\n\n                    if (config.enableBatching) {\n                        batcher.scheduleWrite(removeNode);\n                    } else {\n                        removeNode();\n                    }\n                }\n\n                dom.deleteRow(slotIndex, key);\n                itemCount--;\n                break;\n            }\n\n            case 'ins': {\n                const pos = op[1];\n                const payload = op[2] || {key: '', html: ''};\n\n                if (payload && typeof payload === 'object' && payload.bindings) {\n                    for (const [slotKey, specs] of Object.entries(payload.bindings)) {\n                        const slotId = Number(slotKey);\n                        if (Number.isNaN(slotId)) {\n                            continue;\n                        }\n                        registerBindingsForSlot(slotId, specs ?? []);\n                    }\n                }\n\n                // Check memoization cache\n                const memoKey = memoizer.key('ins', slotIndex, payload.html);\n                let fragment: DocumentFragment;\n\n                if (config.enableMemoization && memoizer.has(memoKey)) {\n                    fragment = memoizer.get(memoKey).cloneNode(true) as DocumentFragment;\n                } else {\n                    fragment = createFragment(payload.html || '');\n                    if (config.enableMemoization) {\n                        memoizer.set(memoKey, fragment.cloneNode(true));\n                    }\n                }\n\n                primeHandlerBindings(fragment);\n\n                const nodes = Array.from(fragment.childNodes);\n                if (nodes.length === 0) {\n                    console.warn('live: insertion payload missing nodes for key', payload.key);\n                    break;\n                }\n\n                const insertNode = () => {\n                    // Use batched children array if available\n                    const refNode = config.enableBatching\n                        ? children![pos] || null\n                        : container.children[pos] || null;\n\n                    container.insertBefore(fragment, refNode);\n\n                    for (const inserted of nodes) {\n                        if (inserted instanceof Element) {\n                            bindRefsInTree(inserted);\n                        }\n                    }\n\n                    const root = nodes[0];\n                    if (root instanceof Element) {\n                        dom.setRow(slotIndex, payload.key, root);\n                        const rangeOverrides = applyComponentRanges(payload.componentPaths);\n                        registerRowSlots(payload, root, rangeOverrides);\n\n                        // Virtual scrolling: hide items outside viewport\n                        if (shouldVirtualize(slotIndex, itemCount)) {\n                            const state = virtualScrollStates.get(slotIndex);\n                            if (state && (pos < state.visibleRange.start || pos > state.visibleRange.end)) {\n                                if (root instanceof HTMLElement || root instanceof SVGElement) {\n                                    root.style.display = 'none';\n                                }\n                            }\n                        }\n                    } else {\n                        console.warn('live: row root is not an element for key', payload.key);\n                    }\n                };\n\n                if (config.enableBatching) {\n                    batcher.scheduleWrite(insertNode);\n                } else {\n                    insertNode();\n                }\n\n                itemCount++;\n                break;\n            }\n\n            case 'mov': {\n                const from = op[1];\n                const to = op[2];\n\n                if (from === to) break;\n\n                const moveNode = () => {\n                    // Use batched children array if available\n                    const childArray = config.enableBatching ? children! : Array.from(container.children);\n                    const child = childArray[from];\n\n                    if (child) {\n                        const refNode = to < childArray.length ? childArray[to] : null;\n                        container.insertBefore(child, refNode);\n                    }\n                };\n\n                if (config.enableBatching) {\n                    batcher.scheduleWrite(moveNode);\n                } else {\n                    moveNode();\n                }\n                break;\n            }\n\n            default:\n                console.warn('live: unknown list child op', op);\n        }\n    }\n\n    // Update virtual scroll state\n    if (shouldVirtualize(slotIndex, itemCount)) {\n        const state = virtualScrollStates.get(slotIndex);\n        if (state) {\n            state.totalItems = itemCount;\n        } else {\n            initVirtualScroll(slotIndex, container);\n        }\n    }\n}\n\n// ============================================================================\n// Main Apply Function with Batching\n// ============================================================================\n\n/**\n * Apply an array of diff operations to the DOM with advanced optimizations\n * @param ops - Array of operations from the server\n */\nexport function applyOps(ops: DiffOp[]): void {\n    if (!Array.isArray(ops)) return;\n\n    for (const op of ops) {\n        if (!op || op.length === 0) continue;\n        const kind = op[0];\n\n        switch (kind) {\n            case 'setText':\n                applySetText(op[1], op[2]);\n                break;\n            case 'setAttrs':\n                applySetAttrs(op[1], op[2] || {}, op[3] || []);\n                break;\n            case 'list':\n                applyList(op[1], op.slice(2) as ListChildOp[]);\n                break;\n            default:\n                console.warn('live: unknown op', op);\n        }\n    }\n\n    // Flush batched operations if batching is enabled\n    if (config.enableBatching) {\n        batcher.immediate();\n    }\n}\n\n// ============================================================================\n// Public API for Configuration\n// ============================================================================\n\nexport function configurePatcher(options: Partial<PatcherConfig>): void {\n    Object.assign(config, options);\n}\n\nexport function getPatcherConfig(): Readonly<PatcherConfig> {\n    return {...config};\n}\n\nexport function clearPatcherCaches(): void {\n    htmlCache.clear();\n    memoizer.clear();\n    virtualScrollStates.clear();\n}\n\nexport function getPatcherStats() {\n    return {\n        htmlCacheSize: htmlCache.size,\n        memoizerCacheSize: memoizer['cache'].size,\n        virtualScrollCount: virtualScrollStates.size,\n    };\n}\n\n// ============================================================================\n// Inverse Operations (for Optimistic Rollback)\n// ============================================================================\n\n/**\n * Compute inverse operations for a set of patches.\n * These can be applied to rollback optimistic updates.\n */\nexport function computeInverseOps(patches: DiffOp[]): DiffOp[] {\n    const inverseOps: DiffOp[] = [];\n\n    for (const patch of patches) {\n        const [opType, slotId, ...args] = patch;\n\n        if (opType === 'setText') {\n            // Capture current text before it changes\n            const element = dom.getSlot(slotId);\n            if (element) {\n                const currentText = element.textContent || '';\n                inverseOps.push(['setText', slotId, currentText]);\n            }\n        } else if (opType === 'setAttrs') {\n            // Capture current attributes before they change\n            const element = dom.getSlot(slotId);\n            if (element && element instanceof Element) {\n                const [newAttrs, removeKeys] = args as [Record<string, string>, string[]];\n\n                // Store current values of attributes that will be set\n                const oldAttrs: Record<string, string> = {};\n                const keysToRemove: string[] = [];\n\n                for (const key of Object.keys(newAttrs)) {\n                    const currentValue = element.getAttribute(key);\n                    if (currentValue !== null) {\n                        oldAttrs[key] = currentValue;\n                    } else {\n                        // Attribute doesn't exist, so inverse should remove it\n                        keysToRemove.push(key);\n                    }\n                }\n\n                // Store attributes that will be removed (so we can restore them)\n                for (const key of removeKeys) {\n                    const currentValue = element.getAttribute(key);\n                    if (currentValue !== null) {\n                        oldAttrs[key] = currentValue;\n                    }\n                }\n\n                inverseOps.push(['setAttrs', slotId, oldAttrs, keysToRemove]);\n            }\n        } else if (opType === 'list') {\n            // For list operations, compute inverse for each child operation\n            const childOps = args as ListChildOp[];\n            const inverseChildOps: ListChildOp[] = [];\n\n            for (const childOp of childOps) {\n                const [childOpType, ...childArgs] = childOp;\n\n                if (childOpType === 'ins') {\n                    // Insert inverse is delete\n                    const [, {key}] = childArgs as [number, { key: string; html: string; slots?: number[] }];\n                    inverseChildOps.push(['del', key]);\n                } else if (childOpType === 'del') {\n                    // Delete inverse requires capturing the element before deletion\n                    // This is complex - we'd need the HTML and position\n                    // For now, mark as not supported (would need re-render)\n                    // Skip creating inverse for delete operations\n\n                } else if (childOpType === 'mov') {\n                    // Move inverse is move back\n                    const [fromIdx, toIdx] = childArgs as [number, number];\n                    inverseChildOps.push(['mov', toIdx, fromIdx]);\n                }\n            }\n\n            if (inverseChildOps.length > 0) {\n                inverseOps.push(['list', slotId, ...inverseChildOps.reverse()]);\n            }\n        }\n    }\n\n    // Reverse the order of inverse operations\n    return inverseOps.reverse();\n}\n", "import { registerUploadDelegate } from \"./events\";\nimport { resolveNodeInComponent } from \"./manifest\";\nimport type { ComponentRange } from \"./componentRanges\";\nimport type {\n  UploadBindingDescriptor,\n  UploadClientMessage,\n  UploadControlMessage,\n  UploadMeta,\n} from \"./types\";\n\ntype UploadManagerOptions = {\n  getSessionId: () => string | null;\n  getEndpoint: () => string | null;\n  send: (payload: UploadClientMessage) => void;\n  isConnected: () => boolean;\n};\n\ntype ActiveUpload = {\n  xhr: XMLHttpRequest;\n  input: HTMLInputElement | null;\n};\n\ntype UploadBindingMeta = {\n  id: string;\n  accept?: string[];\n  multiple: boolean;\n  maxSize?: number;\n};\n\nconst elementBindings = new WeakMap<Element, UploadBindingMeta>();\nconst idToElement = new Map<string, Element>();\nconst componentUploadIds = new Map<string, Set<string>>();\n\nfunction removeUploadIdFromComponents(uploadId: string): void {\n  for (const [componentId, ids] of componentUploadIds.entries()) {\n    if (ids.delete(uploadId) && ids.size === 0) {\n      componentUploadIds.delete(componentId);\n    }\n  }\n}\n\nfunction detachUploadBinding(uploadId: string): void {\n  if (typeof uploadId !== \"string\" || uploadId.length === 0) {\n    return;\n  }\n  const element = idToElement.get(uploadId);\n  if (element) {\n    elementBindings.delete(element);\n    idToElement.delete(uploadId);\n  }\n  removeUploadIdFromComponents(uploadId);\n}\n\nfunction setInputAttributes(\n  input: HTMLInputElement,\n  descriptor: UploadBindingDescriptor,\n): void {\n  if (Array.isArray(descriptor.accept) && descriptor.accept.length > 0) {\n    input.setAttribute(\"accept\", descriptor.accept.join(\",\"));\n  } else {\n    input.removeAttribute(\"accept\");\n  }\n  if (descriptor.multiple) {\n    input.setAttribute(\"multiple\", \"multiple\");\n  } else {\n    input.removeAttribute(\"multiple\");\n  }\n}\n\nfunction attachUploadDescriptor(\n  descriptor: UploadBindingDescriptor,\n  overrides?: Map<string, ComponentRange>,\n): boolean {\n  if (!descriptor || typeof descriptor.uploadId !== \"string\") {\n    return false;\n  }\n  const node = resolveNodeInComponent(\n    descriptor.componentId,\n    descriptor.path,\n    overrides,\n  );\n  if (!(node instanceof HTMLInputElement)) {\n    return false;\n  }\n  if (node.type && node.type.toLowerCase() !== \"file\") {\n    node.type = \"file\";\n  }\n  detachUploadBinding(descriptor.uploadId);\n  setInputAttributes(node, descriptor);\n  const meta: UploadBindingMeta = {\n    id: descriptor.uploadId,\n    multiple: !!descriptor.multiple,\n  };\n  if (Array.isArray(descriptor.accept) && descriptor.accept.length > 0) {\n    meta.accept = [...descriptor.accept];\n  }\n  if (typeof descriptor.maxSize === \"number\" && !Number.isNaN(descriptor.maxSize)) {\n    meta.maxSize = descriptor.maxSize;\n  }\n  elementBindings.set(node, meta);\n  idToElement.set(descriptor.uploadId, node);\n  return true;\n}\n\nexport function getUploadBinding(\n  element: Element | null | undefined,\n): UploadBindingMeta | undefined {\n  if (!element) {\n    return undefined;\n  }\n  return elementBindings.get(element) ?? undefined;\n}\n\nexport function replaceUploadBindingsForComponent(\n  componentId: string,\n  descriptors: UploadBindingDescriptor[] | null | undefined,\n  overrides?: Map<string, ComponentRange>,\n): void {\n  if (typeof componentId !== \"string\" || componentId.length === 0) {\n    return;\n  }\n  const existing = componentUploadIds.get(componentId);\n  if (existing) {\n    existing.forEach((id) => detachUploadBinding(id));\n    componentUploadIds.delete(componentId);\n  }\n  if (!Array.isArray(descriptors) || descriptors.length === 0) {\n    return;\n  }\n  const next = new Set<string>();\n  for (const descriptor of descriptors) {\n    if (!descriptor || typeof descriptor.uploadId !== \"string\") {\n      continue;\n    }\n    const normalized: UploadBindingDescriptor = {\n      ...descriptor,\n      componentId,\n    };\n    if (attachUploadDescriptor(normalized, overrides)) {\n      next.add(descriptor.uploadId);\n    }\n  }\n  if (next.size > 0) {\n    componentUploadIds.set(componentId, next);\n  }\n}\n\nexport function applyUploadBindings(\n  descriptors: UploadBindingDescriptor[] | null | undefined,\n  overrides?: Map<string, ComponentRange>,\n): void {\n  if (!Array.isArray(descriptors) || descriptors.length === 0) {\n    return;\n  }\n  const grouped = new Map<string, UploadBindingDescriptor[]>();\n  for (const descriptor of descriptors) {\n    if (!descriptor || typeof descriptor.componentId !== \"string\") {\n      continue;\n    }\n    const list = grouped.get(descriptor.componentId) ?? [];\n    list.push(descriptor);\n    grouped.set(descriptor.componentId, list);\n  }\n  for (const [componentId, list] of grouped.entries()) {\n    replaceUploadBindingsForComponent(componentId, list, overrides);\n  }\n}\n\nexport function primeUploadBindings(\n  descriptors: UploadBindingDescriptor[] | null | undefined,\n  overrides?: Map<string, ComponentRange>,\n): void {\n  componentUploadIds.forEach((ids) => {\n    ids.forEach((id) => detachUploadBinding(id));\n  });\n  componentUploadIds.clear();\n  idToElement.clear();\n  if (!Array.isArray(descriptors) || descriptors.length === 0) {\n    return;\n  }\n  applyUploadBindings(descriptors, overrides);\n}\n\nexport function clearUploadBindings(): void {\n  primeUploadBindings(null);\n}\n\nconst enum UploadOps {\n  Change = \"change\",\n  Progress = \"progress\",\n  Error = \"error\",\n  Cancelled = \"cancelled\",\n}\n\nexport class UploadManager {\n  private options: UploadManagerOptions;\n  private uploads: Map<string, ActiveUpload> = new Map();\n\n  constructor(options: UploadManagerOptions) {\n    this.options = options;\n    registerUploadDelegate((event, type) => this.handleDomEvent(event, type));\n  }\n\n  public dispose(): void {\n    registerUploadDelegate(null);\n    this.abortAll();\n  }\n\n  public onDisconnect(): void {\n    this.abortAll();\n  }\n\n  public handleControl(message: UploadControlMessage): void {\n    if (!message || message.op !== \"cancel\") {\n      return;\n    }\n    const active = this.uploads.get(message.id);\n    if (active?.xhr) {\n      active.xhr.abort();\n    }\n  }\n\n  public handleDomEvent(event: Event, eventType: string): void {\n    if (eventType !== \"change\") {\n      return;\n    }\n    const target = event.target as HTMLElement | null;\n    if (!target) {\n      return;\n    }\n    const input = this.resolveInput(target);\n    if (!input) {\n      return;\n    }\n    const binding = getUploadBinding(input);\n    const uploadId = binding?.id;\n    if (!uploadId) {\n      return;\n    }\n    const files = input.files;\n    if (!files || files.length === 0) {\n      return;\n    }\n    const file = files[0];\n    const sessionId = this.options.getSessionId();\n    if (!sessionId || !this.options.isConnected()) {\n      console.warn(\n        \"[LiveUI] upload ignored because the session is not connected\",\n      );\n      if (sessionId) {\n        this.sendMessage({\n          t: \"upload\",\n          sid: sessionId,\n          id: uploadId,\n          op: UploadOps.Error,\n          error: \"not connected\",\n        });\n      }\n      return;\n    }\n    this.sendMessage({\n      t: \"upload\",\n      sid: sessionId,\n      id: uploadId,\n      op: UploadOps.Change,\n      meta: this.buildMeta(file),\n    });\n    this.startUpload(sessionId, uploadId, file, input);\n  }\n\n  private startUpload(\n    sessionId: string,\n    uploadId: string,\n    file: File,\n    input: HTMLInputElement,\n  ): void {\n    const current = this.uploads.get(uploadId);\n    if (current?.xhr) {\n      current.xhr.abort();\n    }\n    const endpoint = this.options.getEndpoint();\n    if (!endpoint) {\n      console.warn(\"[LiveUI] upload endpoint missing; aborting file upload\");\n      this.sendMessage({\n        t: \"upload\",\n        sid: sessionId,\n        id: uploadId,\n        op: UploadOps.Error,\n        error: \"upload endpoint missing\",\n      });\n      return;\n    }\n    const url = this.buildUploadURL(endpoint, sessionId, uploadId);\n    const xhr = new XMLHttpRequest();\n    xhr.open(\"POST\", url, true);\n\n    xhr.upload.onprogress = (evt: ProgressEvent<EventTarget>) => {\n      if (!evt.lengthComputable) {\n        return;\n      }\n      const sid = this.options.getSessionId();\n      if (!sid) {\n        return;\n      }\n      this.sendMessage({\n        t: \"upload\",\n        sid,\n        id: uploadId,\n        op: UploadOps.Progress,\n        loaded: evt.loaded,\n        total: evt.total,\n      });\n    };\n\n    const finalize = () => {\n      const active = this.uploads.get(uploadId);\n      if (active?.xhr === xhr) {\n        this.uploads.delete(uploadId);\n      }\n    };\n\n    xhr.onload = () => {\n      finalize();\n      if (xhr.status >= 200 && xhr.status < 300) {\n        return;\n      }\n      const sid = this.options.getSessionId();\n      if (!sid) {\n        return;\n      }\n      this.sendMessage({\n        t: \"upload\",\n        sid,\n        id: uploadId,\n        op: UploadOps.Error,\n        error: `HTTP ${xhr.status}`,\n      });\n    };\n\n    xhr.onerror = () => {\n      finalize();\n      const sid = this.options.getSessionId();\n      if (!sid) {\n        return;\n      }\n      this.sendMessage({\n        t: \"upload\",\n        sid,\n        id: uploadId,\n        op: UploadOps.Error,\n        error: \"network error\",\n      });\n    };\n\n    xhr.onabort = () => {\n      finalize();\n      const sid = this.options.getSessionId();\n      if (!sid) {\n        return;\n      }\n      this.sendMessage({\n        t: \"upload\",\n        sid,\n        id: uploadId,\n        op: UploadOps.Cancelled,\n      });\n    };\n\n    const data = new FormData();\n    data.append(\"file\", file, file.name);\n    xhr.send(data);\n\n    this.uploads.set(uploadId, { xhr, input });\n    input.value = \"\";\n  }\n\n  private buildUploadURL(base: string, sid: string, uploadId: string): string {\n    const normalized = base.endsWith(\"/\") ? base : `${base}/`;\n    return `${normalized}${encodeURIComponent(sid)}/${encodeURIComponent(uploadId)}`;\n  }\n\n  private buildMeta(file: File): UploadMeta {\n    return {\n      name: file.name,\n      size: file.size,\n      type: file.type || undefined,\n    };\n  }\n\n  private resolveInput(target: HTMLElement): HTMLInputElement | null {\n    if (target instanceof HTMLInputElement) {\n      return target;\n    }\n    if (target.closest) {\n      const match = target.closest('input[type=\"file\"][data-pond-upload]');\n      return match instanceof HTMLInputElement ? match : null;\n    }\n    return null;\n  }\n\n  private sendMessage(payload: UploadClientMessage): void {\n    try {\n      this.options.send(payload);\n    } catch (error) {\n      console.error(\"[LiveUI] failed to send upload message\", error);\n    }\n  }\n\n  private abortAll(): void {\n    for (const [, active] of this.uploads) {\n      try {\n        active.xhr.abort();\n      } catch (error) {\n        console.error(\"[LiveUI] failed to abort upload\", error);\n      }\n    }\n    this.uploads.clear();\n  }\n}\n", "/**\n * Reactive Signal System\n *\n * Lightweight reactive primitives for state management\n */\n\nexport class Signal<T> {\n    private value: T;\n    private subscribers = new Set<(value: T) => void>();\n\n    constructor(initial: T) {\n        this.value = initial;\n    }\n\n    get(): T {\n        return this.value;\n    }\n\n    set(newValue: T): void {\n        if (this.value !== newValue) {\n            this.value = newValue;\n            this.notify();\n        }\n    }\n\n    update(updater: (current: T) => T): void {\n        this.set(updater(this.value));\n    }\n\n    subscribe(fn: (value: T) => void): () => void {\n        this.subscribers.add(fn);\n        // Immediately call with current value\n        fn(this.value);\n        // Return unsubscribe function\n        return () => this.subscribers.delete(fn);\n    }\n\n    private notify(): void {\n        this.subscribers.forEach(fn => fn(this.value));\n    }\n}\n\nexport class ComputedSignal<T> {\n    private value: T;\n    private subscribers = new Set<(value: T) => void>();\n    private unsubscribers: Array<() => void> = [];\n\n    constructor(compute: () => T, dependencies: Signal<any>[]) {\n        this.value = compute();\n\n        // Subscribe to all dependencies\n        dependencies.forEach(dep => {\n            const unsub = dep.subscribe(() => {\n                const newValue = compute();\n                if (this.value !== newValue) {\n                    this.value = newValue;\n                    this.notify();\n                }\n            });\n            this.unsubscribers.push(unsub);\n        });\n    }\n\n    get(): T {\n        return this.value;\n    }\n\n    subscribe(fn: (value: T) => void): () => void {\n        this.subscribers.add(fn);\n        fn(this.value);\n        return () => this.subscribers.delete(fn);\n    }\n\n    destroy(): void {\n        this.unsubscribers.forEach(unsub => unsub());\n        this.unsubscribers = [];\n        this.subscribers.clear();\n    }\n\n    private notify(): void {\n        this.subscribers.forEach(fn => fn(this.value));\n    }\n}\n", "/**\n * Event Emitter\n *\n * Simple type-safe event emitter for lifecycle hooks\n */\n\nexport type EventHandler<T = any> = (data: T) => void;\n\nexport class EventEmitter<EventMap extends Record<string, any>> {\n    private listeners = new Map<keyof EventMap, Set<EventHandler>>();\n\n    on<K extends keyof EventMap>(event: K, handler: EventHandler<EventMap[K]>): () => void {\n        if (!this.listeners.has(event)) {\n            this.listeners.set(event, new Set());\n        }\n        this.listeners.get(event)!.add(handler);\n\n        // Return unsubscribe function\n        return () => this.off(event, handler);\n    }\n\n    off<K extends keyof EventMap>(event: K, handler: EventHandler<EventMap[K]>): void {\n        const handlers = this.listeners.get(event);\n        if (handlers) {\n            handlers.delete(handler);\n            if (handlers.size === 0) {\n                this.listeners.delete(event);\n            }\n        }\n    }\n\n    emit<K extends keyof EventMap>(event: K, data: EventMap[K]): void {\n        const handlers = this.listeners.get(event);\n        if (handlers) {\n            handlers.forEach(handler => {\n                try {\n                    handler(data);\n                } catch (error) {\n                    console.error(`Error in event handler for ${String(event)}:`, error);\n                }\n            });\n        }\n    }\n\n    once<K extends keyof EventMap>(event: K, handler: EventHandler<EventMap[K]>): () => void {\n        const wrappedHandler = (data: EventMap[K]) => {\n            handler(data);\n            this.off(event, wrappedHandler);\n        };\n        return this.on(event, wrappedHandler);\n    }\n\n    removeAllListeners(event?: keyof EventMap): void {\n        if (event) {\n            this.listeners.delete(event);\n        } else {\n            this.listeners.clear();\n        }\n    }\n\n    listenerCount(event: keyof EventMap): number {\n        return this.listeners.get(event)?.size ?? 0;\n    }\n}\n", "/**\n * Optimistic Updates\n *\n * Manages optimistic DOM updates with rollback support.\n */\n\nimport { applyOps, computeInverseOps } from './patcher';\nimport type { DiffOp, OptimisticUpdate } from './types';\n\nexport class OptimisticUpdateManager {\n  private updates = new Map<string, OptimisticUpdate>();\n  private nextId: number = 0;\n  private readonly onRollback?: (id: string, patches: DiffOp[]) => void;\n  private readonly onError?: (error: Error, context: string) => void;\n  private readonly debug: boolean = false;\n\n  constructor(options?: {\n    onRollback?: (id: string, patches: DiffOp[]) => void;\n    onError?: (error: Error, context: string) => void;\n    debug?: boolean;\n  }) {\n    this.onRollback = options?.onRollback;\n    this.onError = options?.onError;\n    this.debug = options?.debug || false;\n  }\n\n  /**\n   * Apply optimistic update\n   */\n  apply(patches: DiffOp[]): string {\n    const id = `opt_${this.nextId++}`;\n\n    // Compute inverse operations BEFORE applying patches\n    // This captures the current DOM state for rollback\n    const inverseOps = computeInverseOps(patches);\n\n    const update: OptimisticUpdate = {\n      id,\n      patches,\n      inverseOps,\n      timestamp: Date.now(),\n    };\n\n    this.updates.set(id, update);\n    applyOps(patches);\n\n    if (this.debug) {\n      console.log('[optimistic] Applied update:', id, 'patches:', patches.length);\n    }\n\n    return id;\n  }\n\n  /**\n   * Commit optimistic update (server confirmed)\n   */\n  commit(id: string): void {\n    if (this.updates.delete(id) && this.debug) {\n      console.log('[optimistic] Committed update:', id);\n    }\n  }\n\n  /**\n   * Rollback optimistic update (server rejected)\n   */\n  rollback(id: string): void {\n    const update = this.updates.get(id);\n    if (!update) return;\n\n    if (this.debug) {\n      console.log('[optimistic] Rolling back update:', id, 'inverse ops:', update.inverseOps.length);\n    }\n\n    try {\n      // Apply inverse operations to restore previous DOM state\n      applyOps(update.inverseOps);\n      this.onRollback?.(id, update.patches);\n    } catch (error) {\n      console.error('[optimistic] Rollback error:', error);\n      this.onError?.(error as Error, 'rollback');\n    }\n\n    this.updates.delete(id);\n  }\n\n  /**\n   * Get pending update count\n   */\n  getPendingCount(): number {\n    return this.updates.size;\n  }\n\n  /**\n   * Clear all pending updates\n   */\n  clear(): void {\n    this.updates.clear();\n  }\n}\n", "/**\n * Boot Payload Handler\n *\n * Handles SSR boot payload detection, parsing, and initial DOM registration.\n */\n\nimport * as dom from './dom-index';\nimport { clearHandlers, primeSlotBindings, registerHandlers, syncEventListeners } from './events';\nimport { applyComponentRanges, resolveListContainers, resolveSlotAnchors } from './manifest';\nimport { resetComponentRanges } from './componentRanges';\nimport type { ComponentRange } from './componentRanges';\nimport { bindRefsInTree, clearRefs, registerRefs } from './refs';\nimport { primeUploadBindings } from './uploads';\nimport type { BootPayload, Location } from './types';\n\nexport class BootHandler {\n  private boot: BootPayload | null = null;\n  private readonly debug: boolean = false;\n\n  constructor(options?: { debug?: boolean }) {\n    this.debug = options?.debug || false;\n  }\n\n  /**\n   * Load boot payload from explicit source or auto-detect\n   */\n  load(explicit?: BootPayload | null): BootPayload | null {\n    const candidate = explicit ?? this.detect();\n    if (!candidate || typeof candidate.sid !== 'string' || candidate.sid.length === 0) {\n      this.log('No boot payload detected or payload invalid');\n      return null;\n    }\n    this.apply(candidate);\n    return candidate;\n  }\n\n  /**\n   * Detect boot payload from window or DOM\n   */\n  private detect(): BootPayload | null {\n    // Try window global first\n    if (typeof window !== 'undefined') {\n      const globalBoot = (window as any).__LIVEUI_BOOT__;\n      if (globalBoot && typeof globalBoot === 'object' && typeof globalBoot.sid === 'string') {\n        return globalBoot as BootPayload;\n      }\n    }\n\n    // Try script tag in DOM\n    if (typeof document !== 'undefined') {\n      const script = document.getElementById('live-boot');\n      const payload = script?.textContent;\n      if (payload) {\n        try {\n          return JSON.parse(payload) as BootPayload;\n        } catch (error) {\n          this.log('Failed to parse boot payload from DOM', error);\n        }\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Apply boot payload: register handlers, slots, and sync location\n   */\n  private apply(boot: BootPayload): void {\n    this.boot = boot;\n\n    // Register event handlers\n    if (boot.handlers) {\n      clearHandlers();\n      registerHandlers(boot.handlers);\n      syncEventListeners();\n    }\n\n    primeSlotBindings(boot.bindings?.slots ?? null);\n\n    // Register element refs and index current DOM\n    clearRefs();\n    registerRefs(boot.refs?.add ?? null);\n    let rangeOverrides: Map<string, ComponentRange> | undefined;\n    if (typeof document !== 'undefined') {\n      bindRefsInTree(document);\n      resetComponentRanges();\n      rangeOverrides = applyComponentRanges(boot.componentPaths, { root: document });\n    }\n\n    // Register DOM slots\n    this.registerInitialDom(boot);\n\n    primeUploadBindings(boot.bindings?.uploads ?? null, rangeOverrides);\n\n    // Sync browser location with boot location\n    if (typeof window !== 'undefined' && boot.location) {\n      const queryPart = boot.location.q ? `?${boot.location.q}` : '';\n      const hashPart = boot.location.hash ? `#${boot.location.hash}` : '';\n      const target = `${boot.location.path}${queryPart}${hashPart}`;\n      const current = `${window.location.pathname}${window.location.search}${window.location.hash}`;\n      if (target && current !== target) {\n        window.history.replaceState({}, '', target);\n      }\n    }\n  }\n\n  /**\n   * Register initial DOM slots from boot payload\n   */\n  private registerInitialDom(boot: BootPayload): void {\n    if (typeof document === 'undefined') {\n      return;\n    }\n\n    dom.reset();\n\n    const slotAnchors = resolveSlotAnchors(boot.slotPaths);\n    if (this.debug) {\n      console.log(\n        '[liveui][boot]',\n        'slotAnchors',\n        slotAnchors.size,\n        'boot slots',\n        Array.isArray(boot.slots) ? boot.slots.length : 0,\n      );\n    }\n    if (Array.isArray(boot.slots) && boot.slots.length > 0) {\n      for (const slot of boot.slots) {\n        if (!slot || typeof slot.anchorId !== 'number') continue;\n        const node = slotAnchors.get(slot.anchorId);\n        if (node) {\n          dom.registerSlot(slot.anchorId, node);\n        } else if (this.debug) {\n          console.warn(\n            '[liveui][boot]',\n            `slot ${slot.anchorId} not registered during boot`,\n            slot,\n            'available anchors',\n            Array.from(slotAnchors.keys()),\n          );\n        }\n      }\n    } else {\n      for (const [slotId, node] of slotAnchors.entries()) {\n        dom.registerSlot(slotId, node);\n      }\n    }\n\n    const listContainers = resolveListContainers(boot.listPaths);\n    for (const [slotId, element] of listContainers.entries()) {\n      dom.registerList(slotId, element);\n    }\n  }\n\n  /**\n   * Get current boot payload\n   */\n  get(): BootPayload | null {\n    return this.boot;\n  }\n\n  /**\n   * Ensure boot payload exists, throw if missing\n   */\n  ensure(): BootPayload {\n    if (!this.boot || !this.boot.sid) {\n      throw new Error('LiveUI: boot payload is required before connecting');\n    }\n    return this.boot;\n  }\n\n  /**\n   * Get join location from browser or boot fallback\n   */\n  getJoinLocation(): Location {\n    const fallback = this.boot?.location ?? { path: '/', q: '', hash: '' };\n    if (typeof window === 'undefined') {\n      return fallback;\n    }\n    const path = window.location.pathname || fallback.path || '/';\n    const rawQuery = window.location.search ?? '';\n    const query = rawQuery.startsWith('?') ? rawQuery.substring(1) : rawQuery;\n    const rawHash = window.location.hash ?? '';\n    const hash = rawHash.startsWith('#') ? rawHash.substring(1) : rawHash;\n    return {\n      path,\n      q: query,\n      hash,\n    };\n  }\n\n  private log(...args: any[]): void {\n    if (this.debug) {\n      console.log('[boot]', ...args);\n    }\n  }\n}\n"],
  "mappings": "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",
  "names": ["exports", "PresenceEventTypes", "ServerActions", "ClientActions", "ChannelState", "ErrorTypes", "SystemSender", "ChannelReceiver", "Events", "PubSubEvents", "exports", "exports", "message", "_Channel_emptyQueue", "_Channel_init", "_Channel_onMessage", "_Channel_publish", "_Channel_subscribeToPresence", "PondClient", "_PondClient_createPublisher", "_PondClient_handleAcknowledge", "_PondClient_init", "WebSocket", "PondClient", "PondClient", "value", "refContext", "DATA_EVENT_ATTR_PREFIX", "handlers"]
}
