// LiveUI Client v1.0.0
"use strict";(()=>{function e(r,n,o){let s=!r.tag&&!r.text&&!r.comment&&r.children||r.fragment,a={...r,el:s?null:n,children:void 0};if(s||(n.i=a),r.refId&&o&&o.set(r.refId,a),r.tag)if(n.nodeType!==Node.ELEMENT_NODE)V.warn("Hydration","Type mismatch: expected element",{jsonTag:r.tag,domType:n.nodeType});else{let e=n;e.tagName.toLowerCase()!==r.tag.toLowerCase()&&V.warn("Hydration","Tag mismatch",{jsonTag:r.tag,domTag:e.tagName})}else void 0!==r.text&&""!==r.text&&n.nodeType!==Node.TEXT_NODE&&V.warn("Hydration","Type mismatch: expected text",{domType:n.nodeType});if(r.children&&r.children.length>0){a.children=[];let s=Array.from(n.childNodes).filter(i);!function(i,r,n,o,s){let a=0;for(let h=0;r.length>h;h++){let l=r[h];if(!l.tag&&!l.text&&!l.comment&&l.children||l.fragment){let e={...l,el:null,children:[]};l.refId&&s&&s.set(l.refId,e),l.children&&(a+=t(e.children,l.children,n,a,o,s)),i.push(e);continue}if(""===l.text){let e=document.createTextNode(""),t=o;n.length>a?t.insertBefore(e,n[a]):t.appendChild(e);let r={...l,el:e,children:void 0};i.push(r);continue}let c=n[a];if(!c){V.warn("Hydration","Missing DOM node for child",{index:h,childJson:l});continue}let f=e(l,c,s);i.push(f),a++}}(a.children,r.children,s,n,o)}return a}function t(i,r,n,o,s,a){let h=o;for(let o=0;r.length>o;o++){let l=r[o];if(!l.tag&&!l.text&&!l.comment&&l.children||l.fragment){let e={...l,el:null,children:[]};l.refId&&a&&a.set(l.refId,e),l.children&&(h+=t(e.children,l.children,n,h,s,a)),i.push(e);continue}if(""===l.text){let e=document.createTextNode(""),t=s;n.length>h?t.insertBefore(e,n[h]):t.appendChild(e);let r={...l,el:e,children:void 0};i.push(r);continue}let c=n[h];if(!c){V.warn("Hydration","Missing DOM node for child",{index:o,childJson:l});continue}let f=e(l,c,a);i.push(f),h++}return h-o}function i(){return 1}function r(e){if("object"!=typeof e)return e;if(null===e)return null;if(Array.isArray(e))return e.map(r);if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp)return function(e){var t;let i=/^\/(.*)\/([gimyu]*)$/.exec(""+e);if(!i)throw Error("Invalid RegExp");return RegExp(null!==(t=i[1])&&void 0!==t?t:"",i[2])}(e);let t={};for(let i in e)({}).hasOwnProperty.call(e,i)&&(t[i]=r(e[i]));return t}function n(e){if(null==e)return null;let t=typeof e;if("string"===t||"number"===t||"boolean"===t)return e;if(Array.isArray(e)){let t=e.map(n).filter(e=>void 0!==e);return t.length>0?t:null}if(e instanceof Date)return e.toISOString();if(e instanceof DOMTokenList)return Array.from(e);if(!(e instanceof Node))try{return JSON.parse(JSON.stringify(e))}catch{return}}var o,s,a,h,l,c,f,d,u,p,w,b,m,v,y,g,E,O,N,M=Object.create,j=Object.defineProperty,k=Object.getOwnPropertyDescriptor,S=Object.getOwnPropertyNames,x=Object.getPrototypeOf,R={}.hasOwnProperty,T=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),C=T(e=>{var t,i,r=e&&e.o||function(e,t,i,r,n){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?n.call(e,i):n?n.value=i:t.set(e,i),i},n=e&&e.h||function(e,t,i,r){if("a"===i&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?r:"a"===i?r.call(e):r?r.value:t.get(e)};Object.defineProperty(e,"l",{value:1}),e.Subject=void 0,e.Subject=class{constructor(){t.set(this,void 0),i.set(this,void 0),r(this,t,0,"f"),r(this,i,new Set,"f")}get size(){return n(this,i,"f").size}subscribe(e){if(n(this,t,"f"))throw Error("Cannot subscribe to a closed subject");return n(this,i,"f").add(e),()=>n(this,i,"f").delete(e)}publish(e){n(this,i,"f").forEach(t=>t(e))}close(){n(this,i,"f").clear(),r(this,t,1,"f")}},t=new WeakMap,i=new WeakMap}),_=T(e=>{var t,i,r=e&&e.o||function(e,t,i,r,n){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?n.call(e,i):n?n.value=i:t.set(e,i),i},n=e&&e.h||function(e,t,i,r){if("a"===i&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?r:"a"===i?r.call(e):r?r.value:t.get(e)};Object.defineProperty(e,"l",{value:1}),e.BehaviorSubject=void 0,i=C(),e.BehaviorSubject=class extends i.Subject{constructor(e){super(),t.set(this,void 0),r(this,t,e,"f")}get value(){return n(this,t,"f")}publish(e){r(this,t,e,"f"),super.publish(e)}subscribe(e){return n(this,t,"f")&&e(n(this,t,"f")),super.subscribe(e)}},t=new WeakMap}),A=T(e=>{var t=e&&e.u||(Object.create?function(e,t,i,r){void 0===r&&(r=i);var n=Object.getOwnPropertyDescriptor(t,i);(!n||("get"in n?!t.l:n.writable||n.configurable))&&(n={enumerable:1,get:function(){return t[i]}}),Object.defineProperty(e,r,n)}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),i=e&&e.p||function(e,i){for(var r in e)"default"!==r&&!{}.hasOwnProperty.call(i,r)&&t(i,e,r)};Object.defineProperty(e,"l",{value:1}),i(_(),e),i(C(),e)}),I=T(e=>{var t,i,r,n,o,s,a,h,l,c;Object.defineProperty(e,"l",{value:1}),e.PubSubEvents=e.Events=e.ChannelReceiver=e.SystemSender=e.ErrorTypes=e.ChannelState=e.ClientActions=e.ServerActions=e.PresenceEventTypes=void 0,(c=t||(e.PresenceEventTypes=t={})).JOIN="JOIN",c.LEAVE="LEAVE",c.UPDATE="UPDATE",function(e){e.PRESENCE="PRESENCE",e.SYSTEM="SYSTEM",e.BROADCAST="BROADCAST",e.ERROR="ERROR",e.CONNECT="CONNECT"}(i||(e.ServerActions=i={})),function(e){e.JOIN_CHANNEL="JOIN_CHANNEL",e.LEAVE_CHANNEL="LEAVE_CHANNEL",e.BROADCAST="BROADCAST"}(r||(e.ClientActions=r={})),function(e){e.IDLE="IDLE",e.JOINING="JOINING",e.JOINED="JOINED",e.STALLED="STALLED",e.CLOSED="CLOSED"}(n||(e.ChannelState=n={})),function(e){e.UNAUTHORIZED_CONNECTION="UNAUTHORIZED_CONNECTION",e.UNAUTHORIZED_JOIN_REQUEST="UNAUTHORIZED_JOIN_REQUEST",e.UNAUTHORIZED_BROADCAST="UNAUTHORIZED_BROADCAST",e.INVALID_MESSAGE="INVALID_MESSAGE",e.HANDLER_NOT_FOUND="HANDLER_NOT_FOUND",e.PRESENCE_ERROR="PRESENCE_ERROR",e.CHANNEL_ERROR="CHANNEL_ERROR",e.ENDPOINT_ERROR="ENDPOINT_ERROR",e.INTERNAL_SERVER_ERROR="INTERNAL_SERVER_ERROR"}(o||(e.ErrorTypes=o={})),function(e){e.ENDPOINT="ENDPOINT",e.CHANNEL="CHANNEL"}(s||(e.SystemSender=s={})),function(e){e.ALL_USERS="ALL_USERS",e.ALL_EXCEPT_SENDER="ALL_EXCEPT_SENDER"}(a||(e.ChannelReceiver=a={})),function(e){e.ACKNOWLEDGE="ACKNOWLEDGE",e.CONNECTION="CONNECTION"}(h||(e.Events=h={})),function(e){e.MESSAGE="MESSAGE",e.PRESENCE="PRESENCE",e.GET_PRESENCE="GET_PRESENCE"}(l||(e.PubSubEvents=l={}))}),q=T(e=>{Object.defineProperty(e,"l",{value:1}),e.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}}),$=T(e=>{Object.defineProperty(e,"l",{value:1})}),P=T(e=>{var t=e&&e.u||(Object.create?function(e,t,i,r){void 0===r&&(r=i);var n=Object.getOwnPropertyDescriptor(t,i);(!n||("get"in n?!t.l:n.writable||n.configurable))&&(n={enumerable:1,get:function(){return t[i]}}),Object.defineProperty(e,r,n)}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),i=e&&e.p||function(e,i){for(var r in e)"default"!==r&&!{}.hasOwnProperty.call(i,r)&&t(i,e,r)};Object.defineProperty(e,"l",{value:1}),i(q(),e),i($(),e)}),J=T(e=>{function t(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function i(e,t){if(!function(e){return"string"==typeof e}(e))throw new a("Expected string, got "+typeof e,t)}function r(e,i){if(!t(e))throw new a("Expected object, got "+typeof e,i)}function n(e,i){if(!function(e){return t(e)?Object.keys(e).every(e=>"string"==typeof e):0}(e))throw new a("Expected record with string keys, got "+typeof e,i)}function o(e,t,i){let r=Object.values(t);if(!r.includes(e))throw new a(`Expected one of [${r.join(", ")}], got ${JSON.stringify(e)}`,i)}Object.defineProperty(e,"l",{value:1}),e.channelEventSchema=e.serverMessageSchema=e.presenceMessageSchema=e.clientMessageSchema=e.ValidationError=void 0;var s=I(),a=class extends Error{constructor(e,t){super(t?`${t}: ${e}`:e),this.path=t,this.name="ValidationError"}};e.ValidationError=a,e.clientMessageSchema={parse(e){r(e,"clientMessage");let t=e;if(!("event"in t))throw new a("Missing required field","event");if(!("requestId"in t))throw new a("Missing required field","requestId");if(!("channelName"in t))throw new a("Missing required field","channelName");if(!("payload"in t))throw new a("Missing required field","payload");if(!("action"in t))throw new a("Missing required field","action");return i(t.event,"event"),i(t.requestId,"requestId"),i(t.channelName,"channelName"),n(t.payload,"payload"),o(t.action,s.ClientActions,"action"),{event:t.event,requestId:t.requestId,channelName:t.channelName,payload:t.payload,action:t.action}}},e.presenceMessageSchema={parse(e){r(e,"presenceMessage");let t=e;if(!("requestId"in t))throw new a("Missing required field","requestId");if(!("channelName"in t))throw new a("Missing required field","channelName");if(!("event"in t))throw new a("Missing required field","event");if(!("action"in t))throw new a("Missing required field","action");if(!("payload"in t))throw new a("Missing required field","payload");if(i(t.requestId,"requestId"),i(t.channelName,"channelName"),o(t.event,s.PresenceEventTypes,"event"),t.action!==s.ServerActions.PRESENCE)throw new a(`Expected ${s.ServerActions.PRESENCE}, got ${JSON.stringify(t.action)}`,"action");r(t.payload,"payload");let h=t.payload;if(!("presence"in h))throw new a("Missing required field","payload.presence");if(!("changed"in h))throw new a("Missing required field","payload.changed");return function(e){if(!function(e){return Array.isArray(e)}(e))throw new a("Expected array, got "+typeof e,"payload.presence")}(h.presence),h.presence.forEach((e,t)=>{n(e,`payload.presence[${t}]`)}),n(h.changed,"payload.changed"),{requestId:t.requestId,channelName:t.channelName,event:t.event,action:s.ServerActions.PRESENCE,payload:{presence:h.presence,changed:h.changed}}}},e.serverMessageSchema={parse(e){r(e,"serverMessage");let t=e;if(!("event"in t))throw new a("Missing required field","event");if(!("requestId"in t))throw new a("Missing required field","requestId");if(!("channelName"in t))throw new a("Missing required field","channelName");if(!("payload"in t))throw new a("Missing required field","payload");if(!("action"in t))throw new a("Missing required field","action");i(t.event,"event"),i(t.requestId,"requestId"),i(t.channelName,"channelName"),n(t.payload,"payload");let o=[s.ServerActions.BROADCAST,s.ServerActions.CONNECT,s.ServerActions.ERROR,s.ServerActions.SYSTEM];if(!o.includes(t.action))throw new a(`Expected one of [${o.join(", ")}], got ${JSON.stringify(t.action)}`,"action");return{event:t.event,requestId:t.requestId,channelName:t.channelName,payload:t.payload,action:t.action}}},e.channelEventSchema={parse(t){r(t,"channelEvent");let i=t;if(!("action"in i))throw new a("Missing required field","action");return i.action===s.ServerActions.PRESENCE?e.presenceMessageSchema.parse(t):e.serverMessageSchema.parse(t)}}}),D=T(e=>{var t=e&&e.u||(Object.create?function(e,t,i,r){void 0===r&&(r=i);var n=Object.getOwnPropertyDescriptor(t,i);(!n||("get"in n?!t.l:n.writable||n.configurable))&&(n={enumerable:1,get:function(){return t[i]}}),Object.defineProperty(e,r,n)}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),i=e&&e.p||function(e,i){for(var r in e)"default"!==r&&!{}.hasOwnProperty.call(i,r)&&t(i,e,r)};Object.defineProperty(e,"l",{value:1}),i(A(),e),i(I(),e),i(P(),e),i(J(),e)}),L=T(e=>{var t,i,r,n,o,s,a,h,l,c,f,d,u,p,w,b,m=e&&e.o||function(e,t,i,r,n){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?n.call(e,i):n?n.value=i:t.set(e,i),i},v=e&&e.h||function(e,t,i,r){if("a"===i&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?r:"a"===i?r.call(e):r?r.value:t.get(e)};Object.defineProperty(e,"l",{value:1}),e.Channel=void 0,b=D(),e.Channel=class{constructor(e,f,d,u){t.add(this),i.set(this,void 0),r.set(this,void 0),n.set(this,void 0),o.set(this,void 0),s.set(this,void 0),a.set(this,void 0),h.set(this,void 0),l.set(this,void 0),c.set(this,void 0),m(this,i,d,"f"),m(this,r,[],"f"),m(this,n,[],"f"),m(this,a,u,"f"),m(this,s,e,"f"),m(this,l,f,"f"),m(this,h,new b.Subject,"f"),m(this,c,new b.BehaviorSubject(b.ChannelState.IDLE),"f"),m(this,o,()=>{},"f")}get channelState(){return v(this,c,"f").value}get presence(){return v(this,n,"f")}acknowledge(e){v(this,c,"f").publish(b.ChannelState.JOINED),v(this,t,"m",d).call(this,e),v(this,t,"m",f).call(this)}join(){let e={action:b.ClientActions.JOIN_CHANNEL,event:b.ClientActions.JOIN_CHANNEL,payload:v(this,a,"f"),channelName:v(this,i,"f"),requestId:(0,b.uuid)()};if(v(this,c,"f").value!==b.ChannelState.JOINED)if(v(this,c,"f").publish(b.ChannelState.JOINING),v(this,l,"f").value)v(this,s,"f").call(this,e);else{let t=v(this,l,"f").subscribe(i=>{i&&(t(),v(this,c,"f").value===b.ChannelState.JOINING&&v(this,s,"f").call(this,e))})}}leave(){let e={action:b.ClientActions.LEAVE_CHANNEL,event:b.ClientActions.LEAVE_CHANNEL,channelName:v(this,i,"f"),requestId:(0,b.uuid)(),payload:{}};v(this,t,"m",p).call(this,e),v(this,c,"f").publish(b.ChannelState.CLOSED),v(this,o,"f").call(this)}onChannelStateChange(e){return v(this,c,"f").subscribe(t=>{e(t)})}onJoin(e){return v(this,t,"m",w).call(this,(t,i)=>{if(t===b.PresenceEventTypes.JOIN)return e(i.changed)})}onLeave(e){return v(this,t,"m",w).call(this,(t,i)=>{if(t===b.PresenceEventTypes.LEAVE)return e(i.changed)})}onMessage(e){return v(this,t,"m",u).call(this,(t,i)=>{e(t,i)})}onMessageEvent(e,t){return this.onMessage((i,r)=>{if(i===e)return t(r)})}onPresenceChange(e){return v(this,t,"m",w).call(this,(t,i)=>{if(t===b.PresenceEventTypes.UPDATE)return e(i)})}onUsersChange(e){return v(this,t,"m",w).call(this,(t,i)=>e(i.presence))}sendMessage(e,r){let n=(0,b.uuid)(),o={action:b.ClientActions.BROADCAST,channelName:v(this,i,"f"),requestId:n,event:e,payload:r};v(this,t,"m",p).call(this,o)}sendForResponse(e,r){let n=(0,b.uuid)();return new Promise(o=>{let s=v(this,t,"m",u).call(this,(e,t,i)=>{n===i&&(o(t),s())}),a={action:b.ClientActions.BROADCAST,channelName:v(this,i,"f"),requestId:n,event:e,payload:r};v(this,t,"m",p).call(this,a)})}},i=new WeakMap,r=new WeakMap,n=new WeakMap,o=new WeakMap,s=new WeakMap,a=new WeakMap,h=new WeakMap,l=new WeakMap,c=new WeakMap,t=new WeakSet,f=function(){v(this,r,"f").forEach(e=>v(this,s,"f").call(this,e)),m(this,r,[],"f")},d=function(e){v(this,o,"f").call(this);let r=e.subscribe(e=>{e.channelName===v(this,i,"f")&&this.channelState===b.ChannelState.JOINED&&v(this,h,"f").publish(e)}),f=v(this,l,"f").subscribe(e=>{if(e&&v(this,c,"f").value===b.ChannelState.STALLED){let e={action:b.ClientActions.JOIN_CHANNEL,event:b.ClientActions.JOIN_CHANNEL,payload:v(this,a,"f"),channelName:v(this,i,"f"),requestId:(0,b.uuid)()};v(this,s,"f").call(this,e)}else!e&&v(this,c,"f").value===b.ChannelState.JOINED&&v(this,c,"f").publish(b.ChannelState.STALLED)}),d=v(this,t,"m",w).call(this,(e,t)=>{m(this,n,t.presence,"f")});m(this,o,()=>{r(),f(),d()},"f")},u=function(e){return v(this,h,"f").subscribe(t=>{if(t.action!==b.ServerActions.PRESENCE)return e(t.event,t.payload,t.requestId)})},p=function(e){if(v(this,c,"f").value===b.ChannelState.JOINED)return v(this,s,"f").call(this,e);v(this,r,"f").push(e)},w=function(e){return v(this,h,"f").subscribe(t=>{if(t.action===b.ServerActions.PRESENCE)return e(t.event,t.payload)})}}),U=T(e=>{var t,i,r,n,o,s,a,h=e&&e.o||function(e,t,i,r,n){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?n.call(e,i):n?n.value=i:t.set(e,i),i},l=e&&e.h||function(e,t,i,r){if("a"===i&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?r:"a"===i?r.call(e):r?r.value:t.get(e)};Object.defineProperty(e,"l",{value:1}),e.PondClient=void 0,s=D(),a=L(),e.PondClient=class{constructor(e,r={}){let n;t.add(this),i.set(this,void 0);try{n=new URL(e)}catch{n=new URL(""+window.location),n.pathname=e}this.m=0;let a=new URLSearchParams(r);n.search=""+a,"wss:"!==n.protocol&&"ws:"!==n.protocol&&(n.protocol="https:"===n.protocol?"wss:":"ws:"),this.v=n,h(this,i,new Map,"f"),this.O=new s.Subject,this.N=new s.BehaviorSubject(0),l(this,t,"m",o).call(this)}connect(){this.m=0;let e=new WebSocket(""+this.v);e.onmessage=e=>{let t=e.data.trim().split("\n");for(let e of t)if(e.trim()){let t=JSON.parse(e),i=s.channelEventSchema.parse(t);this.O.publish(i)}},e.onerror=()=>e.close(),e.onclose=()=>{this.N.publish(0),!this.m&&setTimeout(()=>{this.connect()},1e3)},this.M=e}getState(){return this.N.value}disconnect(){var e;this.N.publish(0),this.m=1,null===(e=this.M)||void 0===e||e.close(),l(this,i,"f").clear()}createChannel(e,n){let o=l(this,i,"f").get(e);if(o&&o.channelState!==s.ChannelState.CLOSED)return o;let h=l(this,t,"m",r).call(this),c=new a.Channel(h,this.N,e,n||{});return l(this,i,"f").set(e,c),c}onConnectionChange(e){return this.N.subscribe(e)}},i=new WeakMap,t=new WeakSet,r=function(){return e=>{this.N.value&&this.M.send(JSON.stringify(e))}},n=function(e){var n;let o=null!==(n=l(this,i,"f").get(e.channelName))&&void 0!==n?n:new a.Channel(l(this,t,"m",r).call(this),this.N,e.channelName,{});l(this,i,"f").set(e.channelName,o),o.acknowledge(this.O)},o=function(){this.O.subscribe(e=>{e.event===s.Events.ACKNOWLEDGE?l(this,t,"m",n).call(this,e):e.event===s.Events.CONNECTION&&e.action===s.ServerActions.CONNECT&&this.N.publish(1)})}}),W=T((e,t)=>{var i=function(){if("object"==typeof self&&self)return self;if("object"==typeof window&&window)return window;throw Error("Unable to resolve global `this`")};t.exports=function(){if(this)return this;if("object"==typeof globalThis&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"j",{get:function(){return this},configurable:1})}catch{return i()}try{return __global__||i()}finally{delete Object.prototype.j}}()}),H=T((e,t)=>{t.exports={name:"websocket",description:"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.",keywords:["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],author:"Brian McKelvey <theturtle32@gmail.com> (https://github.com/theturtle32)",contributors:["IÃ±aki Baz Castillo <ibc@aliax.net> (http://dev.sipdoc.net)"],version:"1.0.35",repository:{type:"git",url:"https://github.com/theturtle32/WebSocket-Node.git"},homepage:"https://github.com/theturtle32/WebSocket-Node",engines:{node:">=4.0.0"},dependencies:{bufferutil:"^4.0.1",debug:"^2.2.0","es5-ext":"^0.10.63","typedarray-to-buffer":"^3.1.5","utf-8-validate":"^5.0.2",yaeti:"^0.0.6"},devDependencies:{"buffer-equal":"^1.0.0",gulp:"^4.0.2","gulp-jshint":"^2.0.4","jshint-stylish":"^2.2.1",jshint:"^2.0.0",tape:"^4.9.1"},config:{verbose:0},scripts:{test:"tape test/unit/*.js",gulp:"gulp"},main:"index",directories:{lib:"./lib"},browser:"lib/browser.js",license:"Apache-2.0"}}),B=T((e,t)=>{t.exports=H().version}),F=T((e,t)=>{function i(e,t){return t?new n(e,t):new n(e)}var r,n,o;if("object"==typeof globalThis)r=globalThis;else try{r=W()}catch{}finally{if(!r&&"u">typeof window&&(r=window),!r)throw Error("Could not determine global this")}n=r.WebSocket||r.MozWebSocket,o=B(),n&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(e){Object.defineProperty(i,e,{get:function(){return n[e]}})}),t.exports={w3cwebsocket:n?i:null,version:o}}),z=T(e=>{Object.defineProperty(e,"l",{value:1}),e.PondClient=void 0;var t=D(),i=U(),r=F().w3cwebsocket;e.PondClient=class extends i.PondClient{connect(e=1){this.m=0;let i=new r(""+this.v);i.onopen=()=>this.N.publish(1),i.onmessage=e=>{let i=e.data.trim().split("\n");for(let e of i)if(e.trim()){let i=JSON.parse(e),r=t.channelEventSchema.parse(i);this.O.publish(r)}},i.onerror=()=>i.close(),i.onclose=()=>{this.N.publish(0),!this.m&&setTimeout(()=>{this.connect()},1e3)}}}}),G=(N=null!=(O=T(e=>{var t,i,r,n;Object.defineProperty(e,"l",{value:1}),e.PondClient=e.ChannelState=void 0,t=D(),Object.defineProperty(e,"ChannelState",{enumerable:1,get:function(){return t.ChannelState}}),i=U(),r=z(),n=typeof window>"u"?r.PondClient:i.PondClient,e.PondClient=n})())?M(x(O)):{},((e,t,i,r)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let i of S(t))!R.call(e,i)&&undefined!==i&&j(e,i,{get:()=>t[i],enumerable:!(r=k(t,i))||r.enumerable});return e})(j(N,"default",{value:O,enumerable:1}),O)),V=class{static configure(e){this.debugMode=e.debug??0}static debug(e,t,i){}static warn(e,t,i){}static error(e,t,i){}};V.debugMode=0,o=(e,t)=>{let i=[];for(let r of t)try{switch(r.op){case"add":i.push({result:l(e,r.path,r.value),op:r});break;case"remove":i.push({result:c(e,r.path),op:r});break;case"replace":i.push({result:d(e,r.path,r.value),op:r});break;case"move":i.push({result:u(e,r.path,r.from),op:r});break;case"copy":i.push({result:p(e,r.path,r.from),op:r});break;case"test":i.push({result:w(e,r.path,r.value),op:r});break;default:throw Error("operation not recognized: "+JSON.stringify(r))}}catch(t){throw s(e,i,t instanceof Error?t:Error(t+"")),t}},s=(e,t,i)=>{try{for(let{op:i,result:r}of t.reverse())switch(i.op){case"add":f(e,i.path,r);break;case"remove":l(e,i.path,r);break;case"replace":d(e,i.path,r);break;case"move":c(e,i.path);try{l(e,i.from,r)}catch(t){throw l(e,i.path,r),t}break;case"copy":c(e,i.path);break;case"test":break;default:throw Error("operation not recognized: "+JSON.stringify(i))}}catch(e){throw Error(`patch failed (${i.message}), and rollback failed too (${(e instanceof Error?e:Error(e+"")).message}), target might be in an inconsistent state`)}},a=e=>{if("string"!=typeof e)return e;if("/"!==e.substring(0,1))throw Error("JSONPatch paths must start with '/'");return e.slice(1).split("/").map(e=>-1===e.indexOf("~")?e:e.replace(/~1/g,"/").replace(/~0/g,"~"))},h=(e,t)=>{let i=Array.isArray(t)?t:a(t);return i.reduce((t,r)=>{if(Array.isArray(t)){let n=Number.parseInt(r,10);if(0>n||n>t.length-1)throw Error(`cannot find /${i.join("/")} in ${JSON.stringify(e)} (index out of bounds)`);return t[n]}if("object"!=typeof t||null===t||!(r in t))throw Error(`cannot find /${i.join("/")} in ${JSON.stringify(e)}`);if(r in t)return t[r]},e)},l=(e,t,i)=>{let n=a(t),o=n.pop(),s=h(e,n);if(Array.isArray(s)){let t=Number.parseInt(o,10);if(0>t||t>s.length)throw Error(`cannot set /${n.concat([o]).join("/")} in ${JSON.stringify(e)} (index out of bounds)`);return void s.splice(t,0,r(i))}if("object"!=typeof s||null===s)throw Error(`cannot set /${n.concat([o]).join("/")} in ${JSON.stringify(e)}`);let l=s[o];return s[o]=r(i),l},c=(e,t)=>{let i=a(t),r=i.pop(),n=h(e,i);if(Array.isArray(n)){let t=Number.parseInt(r,10);if(0>t||t>n.length-1)throw Error(`cannot delete /${i.concat([r]).join("/")} from ${JSON.stringify(e)} (index out of bounds)`);return n.splice(t,1)[0]}if("object"!=typeof n||null===n)throw Error(`cannot delete /${i.concat([r]).join("/")} from ${JSON.stringify(e)}`);let o=n[r];return delete n[r],o},f=(e,t,i)=>{let r=a(t),n=r.pop(),o=h(e,r);if(Array.isArray(o)){let t=Number.parseInt(n,10);if(0>t||t>o.length-1)throw Error(`cannot un-add (rollback) /${r.concat([n]).join("/")} from ${JSON.stringify(e)} (index out of bounds)`);o.splice(t,1)}if("object"!=typeof o||null===o)throw Error(`cannot un-add (rollback) /${r.concat([n]).join("/")} from ${JSON.stringify(e)}`);delete o[n],void 0!==i&&(o[n]=i)},d=(e,t,i)=>{let n=a(t),o=n.pop(),s=h(e,n);if(Array.isArray(s)){let t=Number.parseInt(o,10);if(0>t||t>s.length-1)throw Error(`cannot replace /${n.concat([o]).join("/")} in ${JSON.stringify(e)} (index out of bounds)`);let a=s[t];return s[t]=r(i),a}if("object"!=typeof s||null===s)throw Error(`cannot replace /${n.concat([o]).join("/")} in ${JSON.stringify(e)}`);let l=s[o];return s[o]=r(i),l},u=(e,t,i)=>{let r=c(e,i);try{l(e,t,r)}catch(t){throw l(e,i,r),t}},p=(e,t,i)=>{let n=h(e,i);return l(e,t,r(n))},w=(e,t,i)=>{let r=h(e,t);if(JSON.stringify(i)!==JSON.stringify(r))throw Error(`test failed for /${t} in ${JSON.stringify(e)} (expected: ${JSON.stringify(i)}, found: ${JSON.stringify(r)})`)},b=class{constructor(e,t,i,r,n){this.root=e,this.events=t,this.router=i,this.uploads=r,this.refs=n,this.tree=this.extractTree(e)}apply(e){V.debug("Patcher","Applying RFC 6902 patches",{count:e.length,patches:e});try{o(this.tree,e),V.debug("Patcher","Patches applied to tree"),this.rebuild(),V.debug("Patcher","DOM rebuilt from patched tree")}catch(t){V.error("Patcher","Failed to apply patches",{error:t,message:t instanceof Error?t.message:t+"",stack:t instanceof Error?t.stack:void 0,patches:e})}}syncTreeToRoot(e,t){if(t.componentId=e.componentId,t.tag=e.tag,t.text=e.text,t.comment=e.comment,t.fragment=e.fragment,t.key=e.key,t.unsafeHtml=e.unsafeHtml,t.attrs=e.attrs,t.style=e.style,t.styles=e.styles,t.refId=e.refId,t.handlers=e.handlers,t.router=e.router,t.upload=e.upload,t.el)if(void 0!==t.text&&t.el.nodeType===Node.TEXT_NODE)t.el.textContent=t.text;else if(t.el instanceof Element){if(e.attrs){for(;t.el.attributes.length>0;)t.el.removeAttribute(t.el.attributes[0].name);for(let[i,r]of Object.entries(e.attrs))t.el.setAttribute(i,r.join(" "))}if(t.el instanceof HTMLElement&&e.style){t.el.removeAttribute("style");for(let[i,r]of Object.entries(e.style))t.el.style.setProperty(i,r)}}if(e.children&&t.children){if(e.children.length!==t.children.length)return V.debug("Patcher","Children length mismatch detected",{treeLength:e.children.length,nodeLength:t.children.length}),0;for(let i=0;e.children.length>i;i++)if(!this.syncTreeToRoot(e.children[i],t.children[i]))return 0}return e.handlers!==t.handlers&&(this.events.detach(t),this.events.attach(t)),e.router!==t.router&&(this.router.detach(t),this.router.attach(t)),1}syncMetadata(e,t){if(t.componentId=e.componentId,t.tag=e.tag,t.text=e.text,t.comment=e.comment,t.fragment=e.fragment,t.key=e.key,t.unsafeHtml=e.unsafeHtml,t.attrs=e.attrs,t.style=e.style,t.styles=e.styles,t.refId=e.refId,t.handlers=e.handlers,t.router=e.router,t.upload=e.upload,e.children&&t.children&&e.children.length===t.children.length)for(let i=0;e.children.length>i;i++)this.syncMetadata(e.children[i],t.children[i])}rebuild(){if(this.detachAll(this.root),this.refs.clear(),this.root.el){for(;this.root.el.firstChild;)this.root.el.removeChild(this.root.el.firstChild);if(this.tree.attrs&&this.root.el instanceof Element){let e=this.root.el.attributes;for(let t=e.length-1;t>=0;t--)this.root.el.removeAttribute(e[t].name);for(let[e,t]of Object.entries(this.tree.attrs))this.root.el.setAttribute(e,t.join(" "))}if(this.tree.style&&this.root.el instanceof HTMLElement){this.root.el.removeAttribute("style");for(let[e,t]of Object.entries(this.tree.style))this.root.el.style.setProperty(e,t)}if(this.tree.children)for(let e of this.tree.children){let t=this.render(e);this.root.el.appendChild(t)}this.root.componentId=this.tree.componentId,this.root.refId=this.tree.refId,this.root.handlers=this.tree.handlers,this.root.router=this.tree.router,this.root.upload=this.tree.upload,this.tree.children&&this.root.el.childNodes&&(this.root.children=[],this.tree.children.forEach((t,i)=>{let r=e(t,this.root.el.childNodes[i],this.refs);this.root.children.push(r)})),this.attachAll(this.root)}else this.rebuildVirtualRoot()}extractTree(e){let t={};return e.componentId&&(t.componentId=e.componentId),e.tag&&(t.tag=e.tag),void 0!==e.text&&(t.text=e.text),void 0!==e.comment&&(t.comment=e.comment),e.fragment&&(t.fragment=e.fragment),e.key&&(t.key=e.key),e.unsafeHtml&&(t.unsafeHtml=e.unsafeHtml),e.attrs&&(t.attrs=e.attrs),e.style&&(t.style=e.style),e.styles&&(t.styles=e.styles),e.refId&&(t.refId=e.refId),e.handlers&&(t.handlers=e.handlers),e.router&&(t.router=e.router),e.upload&&(t.upload=e.upload),e.children&&(t.children=e.children.map(e=>this.extractTree(e))),t}render(e){if(void 0!==e.text)return document.createTextNode(e.text);if(e.tag){let t=document.createElement(e.tag);if(e.attrs)for(let[i,r]of Object.entries(e.attrs))t.setAttribute(i,r.join(" "));if(e.style)for(let[i,r]of Object.entries(e.style))t.style.setProperty(i,r);if(e.children)for(let i of e.children)t.appendChild(this.render(i));return t}if(e.children&&e.children.length>0){let t=document.createDocumentFragment();for(let i of e.children)t.appendChild(this.render(i));return t}return document.createComment(e.comment||"")}rebuildVirtualRoot(){if(V.debug("Patcher","Rebuilding virtual root",{treeChildrenCount:this.tree.children?.length,rootChildrenCount:this.root.children?.length}),this.root.componentId=this.tree.componentId,this.root.handlers=this.tree.handlers,this.root.router=this.tree.router,this.tree.children&&this.root.children){for(let e=0;this.tree.children.length>e&&this.root.children.length>e;e++){let t=this.tree.children[e],i=this.root.children[e];V.debug("Patcher","Rebuilding child",{index:e,hasEl:!!i.el,hasParent:!!i.el?.parentNode}),this.rebuildNode(t,i,e)}V.debug("Patcher","Virtual root rebuild complete")}else V.warn("Patcher","No children to rebuild")}rebuildNode(t,i,r){if(i.el&&i.el.parentNode){this.detachAll(i);let n=this.render(t);i.el.parentNode.replaceChild(n,i.el);let o=e(t,n,this.refs),s=this.findParent(this.root,i);s&&s.children&&(s.children[r]=o),this.attachAll(o)}else if(t.children&&i.children){i.componentId=t.componentId,i.handlers=t.handlers,i.router=t.router;for(let e=0;t.children.length>e&&i.children.length>e;e++)this.rebuildNode(t.children[e],i.children[e],e)}}findParent(e,t){if(e.children)for(let i of e.children){if(i===t)return e;let r=this.findParent(i,t);if(r)return r}return null}detachAll(e){if(this.events.detach(e),this.router.detach(e),this.uploads.unbind(e),e.refId&&this.refs.delete(e.refId),e.children)for(let t of e.children)this.detachAll(t)}attachAll(e){if(this.events.attach(e),this.router.attach(e),e.upload&&this.uploads.bind(e,e.upload),e.children)for(let t of e.children)this.attachAll(t)}},m=class{constructor(e,t){this.channel=e,this.sid=t,this.listeners=new WeakMap}attach(e){if(e&&(e.el&&e.handlers&&e.handlers.length>0&&this.bindEvents(e),e.children))for(let t of e.children)this.attach(t)}detach(e){if(e&&(e.el&&this.unbindEvents(e.el),e.children))for(let t of e.children)this.detach(t)}bindEvents(e){if(!e.el||!e.handlers)return;let t=e.el,i=this.listeners.get(t);i||(i=new Map,this.listeners.set(t,i));for(let r of e.handlers){if(i.has(r.event))continue;let n=t=>{t.preventDefault(),this.triggerHandler(r,t,e),(!r.listen||!r.listen.includes("bubble"))&&t.stopPropagation()};t.addEventListener(r.event,n),i.set(r.event,n),V.debug("Events","Attached listener",{event:r.event,handler:r.handler})}}unbindEvents(e){let t=this.listeners.get(e);if(t){for(let[i,r]of t.entries())e.removeEventListener(i,r);this.listeners.delete(e)}}triggerHandler(e,t,i){V.debug("Events","Triggering handler",{handlerId:e.handler,type:t.type});let r=i.el instanceof Element?i.el:void 0,o=function(e,t,i){if(!Array.isArray(t)||0===t.length)return;let r={};return t.forEach(t=>{if("string"!=typeof t||0===t.length)return;let o=function(e,t,i){let r,o=e.split(".").map(e=>e.trim()).filter(Boolean);if(0!==o.length){switch(o.shift()){case"event":r=t;break;case"target":r=t.target??null;break;case"currentTarget":r=t.currentTarget??null;break;case"element":case"ref":r=i?.refElement??(t.currentTarget instanceof Element?t.currentTarget:null);break;default:return}for(let e of o){if(null==r)return;try{r=r[e]}catch{return}}return n(r)}}(t,e,i);void 0!==o&&(r[t]=o)}),Object.keys(r).length>0?r:void 0}(t,e.props,{refElement:r}),s={name:t.type};void 0!==o&&(s.detail=o),this.channel.sendMessage("evt",{t:"evt",sid:this.sid,hid:e.handler,payload:s})}},v=class{constructor(e,t){this.channel=e,this.sessionId=t,this.listeners=new WeakMap,window.addEventListener("popstate",e=>this.onPopState(e))}attach(e){if(!e||!e.router||!e.el)return;let t=e.el;if(this.listeners.has(t))return;let i=t=>{t.preventDefault(),this.navigate(e.router)};t.addEventListener("click",i),this.listeners.set(t,i)}detach(e){if(!e||!e.el)return;let t=e.el,i=this.listeners.get(t);i&&(t.removeEventListener("click",i),this.listeners.delete(t))}navigate(e){let t=e.path||window.location.pathname,i=void 0!==e.query?e.query:window.location.search,r=void 0!==e.hash?e.hash:window.location.hash,n=i.startsWith("?")?i.substring(1):i,o=t+(n?"?"+n:"")+(r?"#"+r:"");e.replace?window.history.replaceState({},"",o):window.history.pushState({},"",o),this.sendNav("nav",t,n,r)}onPopState(e){let t=window.location.pathname,i=window.location.search,r=window.location.hash;this.sendNav("pop",t,i,r)}sendNav(e,t,i,r){V.debug("Router","Sending "+e,{path:t,query:i,hash:r});let n=i.startsWith("?")?i.substring(1):i;this.channel.sendMessage(e,{sid:this.sessionId,path:t,q:n,hash:r})}},y=class{constructor(e){this.refs=e}execute(e){if(e&&0!==e.length)for(let t of e)this.executeOne(t)}executeOne(e){let t=this.refs.get(e.ref);if(!t||!t.el)return void V.warn("DOMAction","Ref not found",{ref:e.ref});let i=t.el;try{switch(e.kind){case"dom.call":e.method&&"function"==typeof i[e.method]?i[e.method](...e.args||[]):V.warn("DOMAction","Method not found",{method:e.method});break;case"dom.set":e.prop&&(i[e.prop]=e.value);break;case"dom.toggle":e.prop&&(i[e.prop]=!i[e.prop]);break;case"dom.class":e.class&&(1==e.on?i.classList.add(e.class):0==e.on?i.classList.remove(e.class):i.classList.toggle(e.class));break;case"dom.scroll":if(i.scrollIntoView){let t={};e.behavior&&(t.behavior=e.behavior),e.block&&(t.block=e.block),e.inline&&(t.inline=e.inline),i.scrollIntoView(t)}break;default:V.warn("DOMAction","Unknown action kind",{kind:e.kind})}}catch(e){V.error("DOMAction","Execution failed",e)}}},g=class{constructor(e){this.runtime=e,this.bindings=new Map,this.active=new Map}bind(e,t){if(!(e.el&&e.el instanceof HTMLInputElement))return void V.warn("Uploads","Upload binding requires an input element",e);let i=e.el,r=t.uploadId;this.unbind(e);let n=()=>this.handleInputChange(r,i,t);i.addEventListener("change",n),t.accept&&t.accept.length>0?i.setAttribute("accept",t.accept.join(",")):i.removeAttribute("accept"),t.multiple?i.multiple=1:i.removeAttribute("multiple"),this.bindings.set(r,{node:e,element:i,meta:t,changeHandler:n}),V.debug("Uploads","Bound upload",r)}unbind(e){for(let[t,i]of this.bindings.entries())if(i.node===e)return void this.detachBinding(t)}detachBinding(e){let t=this.bindings.get(e);t&&(t.element.removeEventListener("change",t.changeHandler),this.bindings.delete(e),this.abortUpload(e,0),V.debug("Uploads","Unbound upload",e))}handleControl(e){!e||!e.id||(V.debug("Uploads","Control message",e),("cancel"===e.op||"error"===e.op)&&this.abortUpload(e.id,1))}handleInputChange(e,t,i){let r=t.files;if(!r||0===r.length)return this.sendMessage({op:"cancelled",id:e}),void this.abortUpload(e,1);let n=r[0];if(n)return i.maxSize&&i.maxSize>0&&n.size>i.maxSize?(this.sendMessage({op:"error",id:e,error:`File exceeds maximum size (${i.maxSize} bytes)`}),void(t.value="")):(this.sendMessage({op:"change",id:e,meta:{name:n.name,size:n.size,type:n.type}}),void this.startUpload(e,n,t));this.sendMessage({op:"cancelled",id:e})}startUpload(e,t,i){let r=this.runtime.getSessionId();if(!r)return;let n=`${this.runtime.getUploadEndpoint().replace(/\/+$/,"")}/${encodeURIComponent(r)}/${encodeURIComponent(e)}`;this.abortUpload(e,0);let o=new XMLHttpRequest;o.upload.onprogress=i=>{this.sendMessage({op:"progress",id:e,loaded:i.loaded,total:i.lengthComputable?i.total:t.size})},o.onerror=()=>{this.active.delete(e),this.sendMessage({op:"error",id:e,error:"Upload failed"})},o.onabort=()=>{this.active.delete(e),this.sendMessage({op:"cancelled",id:e})},o.onload=()=>{this.active.delete(e),200>o.status||o.status>=300?this.sendMessage({op:"error",id:e,error:`Upload failed (${o.status})`}):(this.sendMessage({op:"progress",id:e,loaded:t.size,total:t.size}),i.value="")};let s=new FormData;s.append("file",t),o.open("POST",n,1),o.send(s),this.active.set(e,{xhr:o,element:i}),V.debug("Uploads","Started upload",{uploadId:e,target:n})}abortUpload(e,t){let i=this.active.get(e);i&&(i.xhr.abort(),t&&(i.element.value=""),this.active.delete(e))}sendMessage(e){this.runtime.sendUploadMessage(e)}},E=class{constructor(){this.config={},this.root=null,this.refs=new Map,this.sessionId="";let e=this.getBootPayload();e?(this.sessionId=e.sid,this.config=e.client||{},V.configure({debug:e.client?.debug}),V.debug("Runtime","Booting...",e),this.connect(e),this.hydrate(e)):V.error("Runtime","No boot payload found")}getBootPayload(){if(typeof window>"u")return null;let e=document.getElementById("live-boot");if(e&&e.textContent)try{return JSON.parse(e.textContent)}catch(e){V.error("Runtime","Failed to parse boot payload",e)}return window.__LIVEUI_BOOT__||null}hydrate(e){try{let t=function(e){if("html"===e.tag)return document.documentElement;if(e.children)for(let i of e.children){let e=t(i);if(e)return e}return null},i=JSON.parse(e.json),r=t(i);if(!r)return void V.error("Runtime","Could not find <html> element in JSON tree");this.root=this.hydrateWithComponentWrappers(i,r),this.eventManager&&this.root&&this.eventManager.attach(this.root),this.router&&this.root&&this.attachRouterRecursively(this.root),this.eventManager&&this.router&&this.uploadManager&&(this.patcher=new b(this.root,this.eventManager,this.router,this.uploadManager,this.refs)),V.debug("Runtime","Hydration complete")}catch(e){V.error("Runtime","Hydration failed",e)}}hydrateWithComponentWrappers(t,i){if("html"===t.tag)return e(t,i,this.refs);let r={...t,el:null,children:void 0};if(t.componentId&&(r.componentId=t.componentId),t.children&&t.children.length>0){r.children=[];for(let e of t.children){let t=this.hydrateWithComponentWrappers(e,i);r.children.push(t)}}return r}connect(e){this.client=new G.PondClient(e.client?.endpoint||"/live"),this.channel=this.client.createChannel("live/"+e.sid,{sid:e.sid,ver:e.ver,ack:e.seq,loc:e.location}),this.eventManager=new m(this.channel,e.sid),this.router=new v(this.channel,e.sid),this.uploadManager=new g(this),this.domActions=new y(this.refs),this.channel.onChannelStateChange(e=>{V.debug("Runtime","Channel state:",e)}),this.channel.onMessage((e,t)=>{this.handleMessage(t)}),this.client.connect(),this.channel.join()}getSessionId(){return this.sessionId}getUploadEndpoint(){return this.config.upload||"/pondlive/upload"}sendUploadMessage(e){this.channel.sendMessage({t:"upload",...e})}handleMessage(e){switch(e.t){case"frame":this.handleFrame(e);break;case"init":this.handleInit(e);break;case"domreq":this.handleDOMRequest(e);break;case"upload":this.uploadManager.handleControl(e);break;default:V.debug("Runtime","Unknown message type",e.t)}}handleFrame(e){V.debug("Runtime","Received frame",{seq:e.seq,ops:e.patch.length}),this.patcher&&e.patch&&e.patch.length>0&&this.patcher.apply(e.patch),e.effects&&this.domActions.execute(e.effects)}handleInit(e){V.debug("Runtime","Re-initialized",e)}handleDOMRequest(e){let{id:t,ref:i,props:r,method:n,args:o}=e,s=this.refs.get(i);if(!s||!s.el)return void this.sendDOMResponse({t:"domres",id:t,error:"ref not found"});let a=s.el;try{let e,i;if(r&&Array.isArray(r)){i={};for(let e of r)i[e]=a[e]}n&&"function"==typeof a[n]&&(e=a[n](...o||[])),this.sendDOMResponse({t:"domres",id:t,result:e,values:i})}catch(e){this.sendDOMResponse({t:"domres",id:t,error:e.message||"unknown error"})}}sendDOMResponse(e){this.channel.sendMessage("domres",{...e,sid:this.sessionId})}attachRouterRecursively(e){if(this.router&&this.router.attach(e),e.children)for(let t of e.children)this.attachRouterRecursively(t)}},"u">typeof window&&window.addEventListener("DOMContentLoaded",()=>{let e=new E;window.__LIVEUI__=e})})();